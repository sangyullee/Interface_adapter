<!DOCTYPE html>
<html dir="ltr" lang="ru-RU"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">



<script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/force.js" async="" charset="utf-8" type="text/javascript"></script><script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/ga.js" async="" type="text/javascript"></script><script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/gpt.js" type="text/javascript" async=""></script><script type="text/javascript">
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>
<script type="text/javascript">
googletag.cmd.push(function() {
googletag.defineSlot('/1234152/easyelectronics-220x250', [220, 250], 'div-gpt-ad-1376913278738-0').addService(googletag.pubads());
googletag.pubads().enableSingleRequest();
googletag.enableServices();
});
</script>




<meta charset="UTF-8">
<title>AVR. Учебный Курс. Использование AVR TWI для работы с шиной IIC (i2c) | Электроника для всех</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="stylesheet" type="text/css" media="all" href="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/style.css">
<link rel="pingback" href="http://easyelectronics.ru/wordpress/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="Электроника для всех » Лента" href="http://easyelectronics.ru/feed">
<link rel="alternate" type="application/rss+xml" title="Электроника для всех » Лента комментариев" href="http://easyelectronics.ru/comments/feed">
				
	<script type="text/javascript">//<![CDATA[
	// Google Analytics for WordPress by Yoast v4.2.2 | http://yoast.com/wordpress/google-analytics/
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount','UA-4236757-2']);
	_gaq.push(['_trackPageview'],['_trackPageLoadTime']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
	//]]></script><script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/pubads_impl_32.js" type="text/javascript" async=""></script>
<link rel="alternate" type="application/rss+xml" title="Электроника для всех » Лента комментариев к «AVR. Учебный Курс. Использование AVR TWI для работы с шиной IIC (i2c)»" href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html/feed">
<link rel="stylesheet" id="openid-css" href="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/openid.css" type="text/css" media="all">
<link rel="stylesheet" id="adv-spoiler-css" href="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/advanced-spoiler.css" type="text/css" media="all">
<script type="text/javascript" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/jquery.js"></script>
<script type="text/javascript" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/openid.js"></script>
<script type="text/javascript" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/comment-reply.js"></script>
<script type="text/javascript" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/jquery-spoiler.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://easyelectronics.ru/wordpress/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://easyelectronics.ru/wordpress/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Использование интерфейса USI  в режиме мастера TWI" href="http://easyelectronics.ru/ispolzovanie-interfejsa-usi-v-rezhime-mastera-twi.html">
<link rel="next" title="Переезд" href="http://easyelectronics.ru/pereezd.html">
<link rel="canonical" href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">
<link rel="shortlink" href="http://easyelectronics.ru/?p=354">

<link rel="stylesheet" href="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/wp-syntax.css" type="text/css" media="screen">
<script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/watch.js" charset="utf-8"></script><style type="text/css">body .ya-partner .ya-partner__hidden {
    display: none !important;
}
 .ya-partner {
    font-size: 100% !important;
    position: relative !important;
    display: block !important;
    overflow: hidden !important;
    text-align: left !important;
    line-height: normal !important;
    border-radius: 4px !important;
    -webkit-box-sizing: border-box !important;
    -moz-box-sizing: border-box !important;
    box-sizing: border-box !important;
    white-space: normal !important;
}
 .ya-partner__l-table, .ya-partner__l-tr, .ya-partner__l-td {
    background: transparent none no-repeat scroll 0 0 !important;
    border: none !important;
    border-radius: none !important;
    border-spacing: 0 !important;
    border-collapse: collapse !important;
    -moz-box-sizing: content-box !important;
    box-sizing: content-box !important;
    clear: none !important;
    clip: auto !important;
    color: inherit !important;
    cursor: auto !important;
    empty-cells: show !important;
    float: none !important;
    font: inherit !important;
    font-variant: normal !important;
    font-weight: normal !important;
    height: auto !important;
    letter-spacing: normal !important;
    line-height: normal !important;
    margin: 0 !important;
    max-height: none !important;
    max-width: none !important;
    min-height: 0 !important;
    min-width: 0 !important;
    outline: none !important;
    overflow: visible !important;
    padding: 0 !important;
    position: static !important;
    table-layout: auto !important;
    text-align: left !important;
    text-decoration: none !important;
    text-indent: 0 !important;
    text-transform: none !important;
    vertical-align: middle !important;
    visibility: visible !important;
    white-space: normal !important;
    width: auto !important;
    word-spacing: normal !important;
    z-index: auto !important;
}
 .ya-partner__domain-link {
    text-decoration: none !important;
}
 .ya-partner__domain-link:hover {
    text-decoration: underline !important;
}
 .ya-partner, .ya-partner__ads-l, .ya-partner__ads-l em, .ya-partner__item, .ya-partner__title-link-text, .ya-partner__text, .ya-partner__domain-link, .ya-partner__region, ya-partner__pic-container, ya-partner__pic, .ya-partner__list tbody, .ya-partner__list tr, .ya-partner__list td {
    font-size: inherit !important;
    font-style: normal !important;
    text-indent: 0 !important;
}
 .ya-partner_text_clickable a.ya-partner__text-link {
    text-decoration: none !important;
    cursor: pointer !important;
}
 .ya-partner_text_clickable a.ya-partner__text-link:hover {
    text-decoration: underline !important;
}
 .ya-partner__pic-container {
    display: block !important;
    margin: 3px 0 !important;
}
 .ya-partner__item_piclayout_left .ya-partner__pic-container {
    margin: 0 0.4em 0 0 !important;
}
 .ya-partner__item_piclayout_float .ya-partner__pic-container {
    margin: 0.4em 0.4em 0 0 !important;
    float: left !important;
}
 .ya-partner__item_piclayout_float .ya-partner__address, .ya-partner__item_piclayout_float .ya-partner__domain-link, .ya-partner__item_piclayout_float .ya-partner__region {
    white-space: nowrap !important;
}
 .ya-partner__clearfix {
    background: transparent none no-repeat scroll 0 0 !important;
    border: none !important;
    border-radius: none !important;
    border-spacing: 0 !important;
    border-collapse: collapse !important;
    -moz-box-sizing: content-box !important;
    box-sizing: content-box !important;
    clear: both !important;
    clip: auto !important;
    color: inherit !important;
    cursor: auto !important;
    empty-cells: show !important;
    float: none !important;
    font: inherit !important;
    font-variant: normal !important;
    font-weight: normal !important;
    height: 0 !important;
    letter-spacing: normal !important;
    line-height: 0 !important;
    margin: 0 !important;
    max-height: none !important;
    max-width: none !important;
    min-height: 0 !important;
    min-width: 0 !important;
    outline: none !important;
    overflow: visible !important;
    padding: 0 !important;
    position: static !important;
    table-layout: auto !important;
    text-align: left !important;
    text-decoration: none !important;
    text-indent: 0 !important;
    text-transform: none !important;
    vertical-align: baseline !important;
    visibility: visible !important;
    white-space: normal !important;
    width: auto !important;
    word-spacing: normal !important;
    z-index: auto !important;
    font-size: 0 !important;
    display: block !important;
}
 .ya-partner__pic, .ya-partner__pic:link, .ya-partner__pic:hover, .ya-partner__pic:visited {
    background: transparent 0 0 no-repeat scroll !important;
    border: none !important;
    border-radius: none !important;
    border-spacing: 0 !important;
    border-collapse: collapse !important;
    -moz-box-sizing: content-box !important;
    box-sizing: content-box !important;
    clear: none !important;
    clip: auto !important;
    color: inherit !important;
    cursor: pointer !important;
    empty-cells: show !important;
    float: none !important;
    font: inherit !important;
    font-variant: normal !important;
    font-weight: normal !important;
    height: auto !important;
    letter-spacing: normal !important;
    line-height: normal !important;
    margin: 0 !important;
    max-height: none !important;
    max-width: none !important;
    min-height: 0 !important;
    min-width: 0 !important;
    outline: none !important;
    overflow: visible !important;
    padding: 0 !important;
    position: static !important;
    table-layout: auto !important;
    text-align: left !important;
    text-decoration: none !important;
    text-indent: 0 !important;
    text-transform: none !important;
    vertical-align: baseline !important;
    visibility: visible !important;
    white-space: normal !important;
    width: auto !important;
    word-spacing: normal !important;
    z-index: auto !important;
    display: block !important;
}
 .ya-partner yatag {
    text-align: left !important;
    font-family: inherit !important;
}
 .ya-partner__list {
    display: block !important;
    line-height: normal !important;
    font-size: inherit !important;
    text-indent: 0 !important;
}
 .ya-partner__title-link, .ya-partner__address, .ya-partner__ads-link {
    background: transparent none no-repeat scroll 0 0 !important;
    border: none !important;
    border-radius: none !important;
    border-spacing: 0 !important;
    border-collapse: collapse !important;
    -moz-box-sizing: content-box !important;
    box-sizing: content-box !important;
    clear: none !important;
    clip: auto !important;
    color: inherit !important;
    cursor: pointer !important;
    empty-cells: show !important;
    float: none !important;
    font: inherit !important;
    font-variant: normal !important;
    font-weight: normal !important;
    height: auto !important;
    letter-spacing: normal !important;
    line-height: normal !important;
    margin: 0 !important;
    max-height: none !important;
    max-width: none !important;
    min-height: 0 !important;
    min-width: 0 !important;
    outline: none !important;
    overflow: visible !important;
    padding: 0 !important;
    position: static !important;
    table-layout: auto !important;
    text-align: left !important;
    text-decoration: none !important;
    text-indent: 0 !important;
    text-transform: none !important;
    vertical-align: baseline !important;
    visibility: visible !important;
    white-space: normal !important;
    width: auto !important;
    word-spacing: normal !important;
    z-index: auto !important;
    font-size: inherit !important;
    font-style: normal !important;
    display: inline !important;
}
 a.ya-partner__address:hover {
    text-decoration: underline !important;
}
 .ya-partner__address {
    margin-right: 0.3em !important;
}
 a.ya-partner__ads-link:link, a.ya-partner__ads-link:hover, a.ya-partner__ads-link:visited {
    text-decoration: none !important;
    font-weight: normal !important;
}
 .ya-partner__ads-link em {
    font-style: normal !important;
    font-weight: normal !important;
    background: none repeat scroll 0 0 transparent !important;
}
 .ya-partner__item {
    border-radius: 4px !important;
    border: none !important;
    padding: 0.2em 0.3em !important;
    line-height: normal !important;
}
 body .ya-partner__item_pos_last {
    margin-bottom: 0 !important;
}
 .ya-partner__sitelinks {
    display: block !important;
    padding: 0 0 0.3em !important;
    margin-top: -0.1em !important;
}
 .ya-partner__sitelink {
    padding: 0.08em 0 0.08em 0 !important;
    vertical-align: middle !important;
    display: inline-block !important;
}
 .ya-partner__sitelinks wbr {
    display: none !important;
}
 .ya-partner__sitelinks-text {
    text-decoration: underline !important;
}
 .ya-partner_text_clickable a.ya-partner__sitelinks-text {
    text-decoration: none !important;
}
 .ya-partner_text_clickable a.ya-partner__sitelinks-text:hover {
    text-decoration: underline !important;
}
 .ya-partner__sitelinks-inline-delim {
    display: inline !important;
    padding: 0 0.8em !important;
}
 .ya-partner__url {
    font-size: 87% !important;
    display: block !important;
}
 body .ya-partner__hide-urls .ya-partner__url {
    display: none !important;
}
 body .ya-partner__overflow-hide-urls .ya-partner__url {
    display: none !important;
}
 .ya-partner__warn {
    font-size: 70% !important;
    border-radius: 2px !important;
    padding: 0.25em 0.3em 0.25em !important;
    line-height: 1.1em !important;
}
 .ya-partner__agewarn-cont {
    display: inline-block !important;
}
 yatag.ya-partner__agewarn {
    font: normal normal 11px Tahoma, Arial, sans-serif !important;
    border-radius: 4px !important;
    padding: 0 1px !important;
}
 .ya-partner__ads {
    position: relative !important;
    display: block !important;
    white-space: nowrap !important;
    font-size: 87% !important;
}
 .ya-partner__icon {
    font: 0/0 a !important;
    margin: 0 4px -2px 0 !important;
    vertical-align: baseline !important;
    border: 0 !important;
    display: inline !important;
    width: 16px !important;
    height: 16px !important;
    float: none !important;
}
 .ya-partner__ads-link {
    position: relative !important;
    z-index: 10 !important;
    margin-left: 5px !important;
    line-height: normal !important;
    white-space: nowrap !important;
}
 .ya-partner__ads-l {
    border-radius: 4px 0 0 0 !important;
    display: inline-block !important;
    position: relative !important;
    background: none repeat scroll 0 0 transparent !important;
    padding: 0 .75em 1px 0 !important;
}
 * html .ya-partner__ads-l {
    display: inline !important;
    zoom: 1 !important;
}
 a.ya-partner__ads-link-l,a.ya-partner__ads-link-l:link,a.ya-partner__ads-link-l:hover,a.ya-partner__ads-link-l:visited,a.ya-partner__ads-link-l:active,a.ya-partner__ads-link-l:focus {
    font-weight: normal !important;
}
 a.ya-partner__title-link,a.ya-partner__title-link:link,a.ya-partner__title-link:hover,a.ya-partner__title-link:visited,a.ya-partner__title-link:active,a.ya-partner__title-link:focus {
    font-weight: normal !important;
    line-height: normal !important;
    text-decoration: none !important;
}
 a.ya-partner__title-link .ya-partner__title-link-text,a.ya-partner__title-link .ya-partner__title-link-text:link,a.ya-partner__title-link .ya-partner__title-link-text:hover,a.ya-partner__title-link .ya-partner__title-link-text:visited,a.ya-partner__title-link .ya-partner__title-link-text:active,a.ya-partner__title-link .ya-partner__title-link-text:focus {
    display: inline !important;
    text-decoration: underline !important;
}
 .ya-partner_text_clickable a.ya-partner__title-link .ya-partner__title-link-text {
    text-decoration: none !important;
}
 .ya-partner_text_clickable a.ya-partner__title-link:hover .ya-partner__title-link-text {
    text-decoration: underline !important;
}
 .ya-partner_margin_yes .ya-partner__icon {
    margin-left: -20px !important;
}
 .ya-partner_margin_yes .ya-partner__item {
    padding-left: 20px !important;
}
 .ya-partner__wrap-fit {
    display: block !important;
    zoom: 1 !important;
    position: relative !important;
    padding-bottom: 1px !important;
    font-size: inherit !important;
    border-radius: 4px 4px 4px 4px !important;
}
 .ya-partner__item .ya-partner__adtune-positioning-wrapper {
    display: block !important;
    position: relative !important;
    margin: 0 !important;
    padding: 0 !important;
}
 .ya-partner__item .ya-partner__adtune-arrow {
    display: none !important;
}
 .ya-partner__item-ad_tune__yes .ya-partner__adtune-arrow {
    z-index: 1 !important;
    display: block !important;
    cursor: pointer !important;
    position: absolute !important;
    top: 4px !important;
    right: 4px !important;
    width: 16px !important;
    height: 16px !important;
    background-position: 0px 0px !important;
    background-repeat: no-repeat !important;
    background-image: url(//an.yandex.ru/resource/arrow-sprite-01.png) !important;
}
 .ya-partner__item-ad_tune__yes .ya-partner__adtune-arrow:hover {
    background-position: 0px -16px !important;
}
 .ya-partner_type_horiz {
    display: inline-block !important;
    width: 100% !important;
    -moz-box-sizing: border-box !important;
    -webkit-box-sizing: border-box !important;
    box-sizing: border-box !important;
}
 :root .ya-partner_type_horiz {
    display: table\0/IE9 !important;
    width: 100%\0/IE9 !important;
}
 .ya-partner_type_horiz:before,.ya-partner_type_horiz:after {
    content: "" !important;
    display: table !important;
    border-spacing: 0 !important;
    border: 0 !important;
}
 .ya-partner_type_horiz .ya-partner__list {
    display: table !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    border-spacing: 0 !important;
    font-size: inherit !important;
}
 body .ya-partner_type_horiz .ya-partner__item {
    position: static !important;
}
 .ya-partner_type_horiz .ya-partner__tr {
    font-size: inherit !important;
}
 .ya-partner_type_horiz .ya-partner__item {
    padding: 0.5em !important;
    vertical-align: top !important;
    border-spacing: 0 !important;
    font-size: inherit !important;
    border-collapse: separate !important;
}
 .ya-partner_type_horiz .ya-partner__gap {
    font-size: 10px !important;
    width: 0.5em !important;
    margin: 0 !important;
    border: none !important;
    background: none !important;
}
 .ya-partner_type_horiz table.ya-partner__list, .ya-partner_type_horiz td.ya-partner__item,.ya-partner_type_horiz td.ya-partner__gap {
    border-collapse: separate !important;
}
 .ya-partner_type_horiz .ya-partner__warn,.ya-partner_type_horiz .ya-partner__inner,.ya-partner_type_horiz .ya-partner__text,.ya-partner_type_horiz .ya-partner__url {
    display: block !important;
}
 .ya-partner_type_horiz .ya-partner__item_pos_last {
    margin-right: 0 !important;
}
 .ya-partner_type_horiz .ya-partner__text, .ya-partner_type_horiz .ya-partner__warn {
    margin: 0.4em 0 !important;
}</style><style type="text/css">#ya_partner_Ya_sync_0-horizontal .ya-partner__title-link-text:visited {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__title-link-text:link {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__title-link-text:hover {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__sitelinks-text:visited {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__sitelinks-text:link {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__sitelinks-text:hover {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__title-link-text {
    color: #000000 !important;
    font-size: 130% !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__region {
    color: #990000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__domain-link {
    color: #990000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__address {
    color: #990000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner {
    font-family: inherit !important;
    color: #000000 !important;
    font-size: 1em !important;
    background: undefined !important;
    border-radius: 0 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__text {
    font-family: inherit !important;
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__text-link {
    font-family: inherit !important;
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__sitelinks {
    color: #000000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__wrap-fit {
    border-radius: 0 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__item {
    border-radius: 0 !important;
    width: 21.7391% !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__ads-l {
    border-radius: 0 !important;
    background: url("data:image/gif,GIF89a%C8%00)%00%80%01%00%F8%F8%F8%FF%FF%FF!%F9%04%01%00%00%01%00%2C%00%00%00%00%C8%00)%00%00%02%AB%84%8F%A9%CB%ED%0F%A3%9C%B4%DA%1B%B2%DE%B7%FB%0F%86%E2%E8lf%40%A6%EA%CA%B6%D2%A9%B9%F2L%D7%14%9C%D9%FA%CE%CBx%0F%0C%0A-%BF%A1%F1%884%C0%92%CC%E6n%E9%8CJY%A7%A9%F5%0A%AAb%B7%DC%17%A7%0B%0E'L%E2%B2%F8kNc%D1%EA%B64%E6%8E%3B%E1%F2%3A2g%CF%0F%F1%FA~%0F%E5%17%A8%03(XhxhF%88%B8(%A2%C8%F8%88%E1%089%E9Ei%E9%25y%A9%89%40%B7%E9%A9%D4%F9%B9%C9%26zIV%3AJ%8A%0A%A9%B5J%D9%EA%FA%08%15%2B%0BK%7BXt%8B%98%AB%5B%88%93%D9%AB%F7%1B%EC%3BL%1C%F8%1BP%00%00%3B") 100% 50% no-repeat scroll transparent !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__warn {
    border: 1px solid #D8D8D8 !important;
    background-color: #FFFFFF !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner__agewarn {
    border: 1px solid #D8D8D8 !important;
    background-color: #FFFFFF !important;
}
 #ya_partner_Ya_sync_0-horizontal a.ya-partner__ads-link-l:link {
    text-decoration:  !important;
    color: #000 !important;
}
 #ya_partner_Ya_sync_0-horizontal a.ya-partner__ads-link-l:hover {
    text-decoration:  !important;
    color: #000 !important;
}
 #ya_partner_Ya_sync_0-horizontal a.ya-partner__ads-link-l:visited {
    text-decoration:  !important;
    color: #000 !important;
}
 #ya_partner_Ya_sync_0-horizontal .ya-partner_is-quasi-flat_yes .ya-partner__item {
    width: 25% !important;
}
 #ya_partner_Ya_sync_0-horizontal table td.ya-partner__item_pic_yes {
    width: 26.0870% !important;
}
 #ya_partner_Ya_sync_0-horizontal table .ya-partner__item_sitelinks_yes {
    width: 23.9130% !important;
}</style><script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/osd.js" type="text/javascript"></script></head>

<body class="single single-post postid-354 single-format-standard">

<script type="text/javascript">
   (function (d, w) {
     var t = "?t=1";
     var n = d.getElementsByTagName("script")[0],
     s = d.createElement("script"),
     f = function () { n.parentNode.insertBefore(s, n); };
     s.type = "text/javascript";
     s.charset = "utf-8";
     s.async = true;
     s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//showalert.org/force.js" + t;
     if (w.opera == "[object Opera]") {
      d.addEventListener("DOMContentLoaded", f, false);
     } else { f(); }
   })(document, window);
</script>

<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">
			<div style="cursor: pointer;" onclick="location.href='http://easyelectronics.ru';" id="headerleft">
			</div>
			<div id="access" role="navigation">
			  				<div class="skip-link screen-reader-text"><a href="#content" title="Перейти к содержимому">Перейти к содержимому</a></div>
				 
				<div class="menu-header"><ul id="menu-verxnee" class="menu"><li id="menu-item-453" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-453"><a href="http://forum.easyelectronics.ru/">Форум</a></li>
<li id="menu-item-456" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-456"><a href="http://we.easyelectronics.ru/">Сообщество</a></li>
<li id="menu-item-460" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-460"><a href="http://easyelectronics.ru/chat">Чат</a></li>
<li id="menu-item-455" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-455"><a href="http://shop.easyelectronics.ru/">Магазин</a></li>
<li id="menu-item-458" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-458"><a href="http://easyelectronics.ru/links">Ссылки</a></li>
<li id="menu-item-459" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-459"><a href="http://easyelectronics.ru/file">Справочная</a>
<ul class="sub-menu">
	<li id="menu-item-464" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-464"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik">Язык программирования С</a>
	<ul class="sub-menu">
		<li id="menu-item-488" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-488"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/111-2">1.1.1. Используемые символы</a></li>
		<li id="menu-item-489" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-489"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/112-2">1.1.2. Константы</a></li>
		<li id="menu-item-490" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-490"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/113-2">1.1.3. Идентификатор</a></li>
		<li id="menu-item-491" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-491"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/114-2">1.1.4. Ключевые слова</a></li>
		<li id="menu-item-492" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-492"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/115-2">1.1.5. Использование  комментариев в тексте программы</a></li>
		<li id="menu-item-493" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-493"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/121-2">1.2.1 Типы Данных</a></li>
		<li id="menu-item-498" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-498"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/122-2">1.2.2. Целый тип данных</a></li>
		<li id="menu-item-499" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-499"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/123-2">1.2.3. Данные плавающего типа</a></li>
		<li id="menu-item-500" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-500"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/124-2">1.2.4. Указатели</a></li>
		<li id="menu-item-501" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-501"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/125-2">1.2.5. Переменные перечислимого типа</a></li>
		<li id="menu-item-502" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-502"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/126-2">1.2.6. Массивы</a></li>
		<li id="menu-item-503" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-503"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/127-2">1.2.7. Структуры</a></li>
		<li id="menu-item-504" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-504"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/128-2">1.2.8. Объединения (смеси)</a></li>
		<li id="menu-item-505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-505"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/129-2">1.2.9. Поля битов</a></li>
		<li id="menu-item-495" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-495"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1210-2">1.2.10. Переменные с изменяемой структурой</a></li>
		<li id="menu-item-496" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-496"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1211-2">1.2.11. Определение объектов и типов</a></li>
		<li id="menu-item-497" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-497"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1212-2">1.2.12. Инициализация данных</a></li>
		<li id="menu-item-506" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-506"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/131-2">1.3.1. Операнды и операции</a></li>
		<li id="menu-item-511" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-511"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/132-2">1.3.2. Преобразования при вычислении выражений</a></li>
		<li id="menu-item-512" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-512"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/133-2">1.3.3. Операции отрицания и дополнения</a></li>
		<li id="menu-item-513" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-513"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/134-2">1.3.4. Операции разадресации и адреса</a></li>
		<li id="menu-item-514" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-514"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/135-2">1.3.5. Операция sizeof</a></li>
		<li id="menu-item-515" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-515"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/136-2">1.3.6. Мультипликативные операции</a></li>
		<li id="menu-item-516" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-516"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/137-2">1.3.7. Аддитивные операции</a></li>
		<li id="menu-item-517" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-517"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/138-2">1.3.8. Операции сдвига</a></li>
		<li id="menu-item-518" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-518"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/139-2">1.3.9-1.3.11 Операции (поразрядные, логические, последовательного вычисления)</a></li>
		<li id="menu-item-507" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-507"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1312-2">1.3.12. Условная операция</a></li>
		<li id="menu-item-508" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-508"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1313-2">1.3.13. Операции увеличения и уменьшения</a></li>
		<li id="menu-item-509" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-509"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1314-2">1.3.14. Простое присваивание</a></li>
		<li id="menu-item-510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-510"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1318-2">1.3.18. Преобразование типов</a></li>
		<li id="menu-item-519" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-519"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/141-2">1.4.1-1.4.4 Операторы (пустой, составной, if)</a></li>
		<li id="menu-item-522" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-522"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/145-2">1.4.5. Оператор switch</a></li>
		<li id="menu-item-523" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-523"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/147-2">1.4.7. Оператор for</a></li>
		<li id="menu-item-524" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-524"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/148-2">1.4.8. Оператор while</a></li>
		<li id="menu-item-525" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-525"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/149-2">1.4.9. Оператор do while</a></li>
		<li id="menu-item-588" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-588"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1410-2">1.4.10. Оператор continue</a></li>
		<li id="menu-item-520" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-520"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1411-2">1.4.11. Оператор return</a></li>
		<li id="menu-item-521" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-521"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1412-2">1.4.12. Оператор goto</a></li>
		<li id="menu-item-589" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-589"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/151-2">1.5.1. Определение и вызов функций</a></li>
		<li id="menu-item-590" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-590"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/152-2">1.5.2. Вызов функции с переменным числом параметров</a></li>
		<li id="menu-item-591" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-591"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/153-2">1.5.3. Передача параметров функции main</a></li>
		<li id="menu-item-592" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-592"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/161-2">1.6.1. Исходные файлы и объявление переменных</a></li>
		<li id="menu-item-593" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-593"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/162-2">1.6.2. Объявления функций</a></li>
		<li id="menu-item-594" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-594"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/163-2">1.6.3. Время жизни и область видимости программных объектов</a></li>
		<li id="menu-item-595" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-595"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/164-2">1.6.4. Инициализация глобальных и локальных переменных</a></li>
		<li id="menu-item-596" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-596"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/171-2">1.7.1. Методы доступа к элементам массивов</a></li>
		<li id="menu-item-597" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-597"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/172-2">1.7.2. Указатели на многомерные массивы</a></li>
		<li id="menu-item-598" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-598"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/173-2">1.7.3. Операции с указателями</a></li>
		<li id="menu-item-599" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-599"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/174-2">1.7.4. Массивы указателей</a></li>
		<li id="menu-item-600" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-600"><a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/175-2">1.7.5. Динамическое размещение массивов</a></li>
	</ul>
</li>
</ul>
</li>
<li id="menu-item-457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-457"><a href="http://easyelectronics.ru/about">О проекте</a>
<ul class="sub-menu">
	<li id="menu-item-463" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-463"><a href="http://easyelectronics.ru/about/donate">Donate</a></li>
</ul>
</li>
</ul></div>			</div><!-- #access -->
			<div id="branding" role="banner">
				
			</div><!-- #branding -->

			
		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">
		<div id="container">
			<div id="content" role="main">


				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="http://easyelectronics.ru/ispolzovanie-interfejsa-usi-v-rezhime-mastera-twi.html" rel="prev"><span class="meta-nav">←</span> Использование интерфейса USI  в режиме мастера TWI</a></div>
					<div class="nav-next"><a href="http://easyelectronics.ru/pereezd.html" rel="next">Переезд <span class="meta-nav">→</span></a></div>
				</div><!-- #nav-above -->

				<div id="post-354" class="post-354 post type-post status-publish format-standard hentry category-avr-uchebnyj-kurs tag-avr tag-i2c tag-iic tag-pinboard tag-twi">
					<h1 class="entry-title">AVR. Учебный Курс. Использование AVR TWI для работы с шиной IIC (i2c)</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Опубликовано</span> <a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html" title="0:10" rel="bookmark"><span class="entry-date">25 Февраль 2010</span></a> <span class="meta-sep">автором</span> <span class="author vcard"><a class="url fn n" href="http://easyelectronics.ru/author/di-halt" title="Посмотреть все записи автора DI HALT">DI HALT</a></span>					</div><!-- .entry-meta -->
<a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html/print/" title="Распечатать" rel="nofollow"><img class="WP-PrintIcon" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/print.gif" alt="Распечатать" title="Распечатать" style="border: 0px none;"></a>
					<div class="entry-content">
						<table align="left" border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
<td><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/i2c-logo.gif" alt=""></td>
</tr>
</tbody></table>
<p>Про шину IIC я писал уже неоднократно. Вначале было <a href="http://easyelectronics.ru/interface-bus-iic-i2c.html">описание протокола</a>, потом пример <a href="http://easyelectronics.ru/chasy-realnogo-vremeni-pcf8583.html">работы в лоб</a>, а недавно камрад Ultrin выложил <a href="http://easyelectronics.ru/ispolzovanie-interfejsa-usi-v-rezhime-mastera-twi.html">пример работы</a> с i<sup>2</sup>c на базе блока <abbr title="Это своеобразный полуфабрикат. Огрызок от полноценного интерфейса. Где аппаратно ловятся только старт-стопы и принимаются байты, а вся логика сделана программно. Часто встречается в AVR Tiny контроллерах. ">USI</abbr>.
 Да и в интернете полно статей по использованию этой шины в своих целях.
 Одно плохо — все они какие то однобокие. В подавляющем большинстве 
случаев используется конфигурация «Контроллер-Master &amp; 
EEPROM-Slave». Да еще и на программном мастере. И ни разу я не встречал 
материала, чтобы кто то сделал Контроллер-Slave или описал 
многомастерную систему, когда несколько контроллеров сидят на шине и 
решают арбитражем конфликты передачи. Пустоту пора заполнять, решил я и 
завязал узелок на память… Да только веревочку пролюбил :) </p>
<p>Обещаного три года ждут, вот я таки пересилил лень, выкроил время и 
сообразил полноценную библиотеку для работы с аппаратным модулем TWI, 
встроенным во все контроллеры серии MegaAVR. Давно грозился. </p>
<p><b>Кошмар на крыльях ночи</b><br>
Во-первых, я сразу же отказался от концепции тупого последовательного 
кода. Когда у нас есть некоторая функция SendByte(Address,Byte) которая 
шлет данные по шине, а потом возвращает 1 или 0 в зависимости от 
успешности или неуспешности операции. Метод прост, дубов, но медленный. 
Т.е. пока мы байт не пошлем мы не узнаем ушло ли оно, а значит будем 
вынуждены тупить и ждать. Да, шина i2c может быть очень быстрой. До 
100кбит ЕМНИП, но даже это время, а я все же за высокоскоростное 
выполнение кода, без тормозных выдержек. Наш выбор — диспетчеризация и 
работа на прерываниях. </p>
<p>Суть в том, что мы подготавливаем данные которые нужно отослать. 
Дальше запускаем аппаратуру передачи и возвращаемся к своим делам. А 
зверский конечный автомат, что висит на прерывании TWI передатчика сам 
передает данные, отвлекая основную программу только тогда, когда нужен 
какой-либо экшн (например сунуть очередной байт в буфер передачи). Когда
 же все будет передано, то он генерит событие, которое оповещает 
головную программу, что мол задание выполнено.<br>
Как? Ну это уже от конкретной реализации событий программы зависит. 
Может флажок выставить или байт состояния конечного автомата подправить,
 а может и задачу на конвейер диспетчера набросить или Event в почтовый 
ящик задачи скинуть. Если юзается RTOS.<br>
<span id="more-354"></span><br>
<b>Что у нас есть?</b><br>
А у TWI всего один вектор прерываний (в отличии от USART, где на каждое 
событие по прерыванию). Впрочем, это не страшно. Т.к. к нему в нагрузку 
идет регистр TWSR в котором записывается код причины по которой мы 
оказались в прерывании. Т.е. у нас, без лишних проблем, образуется 
конечный автомат. </p>
<p>Вот перечень кодов выдаваемых этим регистром<br>
<b>Коды состояний для режима Master</b><br>
</p><ul><br>
<li><b>0×00 Bus Fail</b> Автобус сломался… эээ в смысле аппаратная ошибка шины. Например, внезапный старт посреди передачи бита.<br>
</li><li><b>0×08 Start</b> Был сделан старт. Теперь мы решаем что делать дальше, например послать адрес ведомого<br>
</li><li><b>0×10 ReStart</b> Был обнаружен повторный старт. Можно переключиться с записи на чтение или наоборот. От логики зависит.<br>
</li><li><b>0×18 SLA+W+ACK</b> Мы отправили адрес с битом записи, а в ответ получили ACK от ведомого. Значит можно продолжать.<br>
</li><li><b>0×20 SLA+W+NACK</b> Мы отправили адрес с битом записи, а нас послали NACK. Обидно, сгенерим ошибку или повторим еще раз.<br>
</li><li><b>0×28 Byte+ACK</b> Мы послали байт и получили подтверждение, что ведомый его принял. Продолжаем.<br>
</li><li><b>0×30 Byte+NACK</b> Мы послали байт, но подтверждение не 
получили. Видимо ведомый уже сыт по горло нашими подачками или он 
захлебнулся в данных. Либо его ВНЕЗАПНО посреди передачи данных украли 
инопланетяне.<br>
</li><li><b>0×38 Collision</b> А у нас тут клановые разборки — пришел 
другой мастер, по хамски нас перебил, да так, что мы от возмущения аж 
заткнулись. Ничего I’l be back! До встречи через n тактов!<br>
</li><li><b>0×40 SLA+R+ACK</b> Послали адрес с битом на чтение, а ведомый отозвался. Хорошо! Будем читать.<br>
</li><li><b>0×48 SLA+R+NACK</b> Крикнули в шину «Эй ты, с адресом ХХХ, 
почитай нам сказки» А в ответ «Иди NACK!» В смысле на запрос адреса с 
битом чтения никто не откликнулся. Видимо не хотят или заняты. Также 
может быть никого нет дома.<br>
</li><li><b>0×50 Receive Byte</b> Мы приняли байт. И думаем что бы ответить ведомому. ACK или NACK.<br>
</li><li><b>0×58 Receive Byte+NACK</b> Мы приняли байт от ведомого и сказали ему «иди NACK!» И он обиженый ушел, освободив шину.<br>
</li></ul><br>
Коды состояний для режима Slave:<br>
<ul><br>
<li><b>0×68 Receive SLA+W LP</b> Мы были мастером, трепались с 
подчиненными по шине. И тут появляется на шине другой, более равный, 
мастер, перебивает нас и молвит «Уважаемый ХХ, а не возьмете ли вы вот 
эти байтики…» Чтож, он круче. Придется бросать передачу и брать его 
байты себе.<br>
</li><li><b>0×78 Receive SLA+W LP Broadcast</b> Были мы, как нам 
казалось, самыми крутыми мастерами на шине. Пока не появился другой 
мастер и перебив нас прогундосил на всю шину «Эй, слышь тыыы. Слушай 
сюда» Девайсы-лохи, с неотключенными широковещательными запросами 
подчиняются. Остальные отмораживаются и всякое Broadcast-быдло 
игнорируют.<br>
</li><li><b>0×60 Receive SLA+W</b> Сидим на шине, никого не трогаем, ни с кем не общаемся. А тут нас по имени… Конечно отзовемся :)<br>
</li><li><b>0×70 Receive SLA+W Broadcast</b> Ситуация повторяется, но на
 этот раз слышим уже знакомое нам «Слышь, тыыыы». Кто? К кому? 
Игнорируем Broadcast запросы? Или нет? Зависит от моральных качеств 
программы.<br>
</li><li><b>0×80 Receive Byte &amp; 0×90 Receive Byte Broadcast</b> 
Принимаем байты. От кого и в каком виде не важно. Решаем что сказать 
Давай еще (ACK) или «Иди NACK». Тут уже по обстоятельствам.<br>
</li><li><b>0×88 Receive Last Byte &amp; 0×98 Receive Last Byte Broadcast</b> Приняли последний байт и распихиваем по карманам.<br>
</li><li><b>0xA0 Receive ReStart</b> Ой у нас Повторный старт. Видимо то что пришло в первый раз был таки адрес страницы. А сейчас пойдут данные…<br>
</li><li><b>0xB0 Receive SLA+R LP</b> Слали мы что то слали, а тут нас 
перебивает другой мастер, обращается по имени и говорит «А ну ХХ зачитай
 нам что нибудь из Пушкина» Что делать, приходится читать.<br>
</li><li><b>0xA8 Receive SLA+R</b> Либо просто к нам какой то другой мастер по имени обращается и просить ему передать байтиков.<br>
</li><li><b>0xB8 Send Byte Receive ACK</b> Ну дали мы ему байт. Он нам 
ACK. А мы тем временем думаем слать ему еще один (последний) и говорить 
«иди NACK». Или же у нас дофига их и можно еще пообщаться.<br>
</li><li><b>0xC0 Send Last Byte Receive NACK</b> Дали мастеру последний имеющийся байт, а он нам «иди NACK». Хамло. Ну и хрен с ним. Уходим с шины.<br>
</li><li><b>0xC8 Send Last Byte Receive ACK</b> Дали мастеру последний 
имеющийся байт, а он требует еще. Но у нас нету, так что разворачиваемся
 и уходим с шины. А он пусть карманы воздухом наполняет (в этот момент 
мастер начнет получать якобы от slave 0xFF байты, на самом деле это 
просто чтение висящей шины).<br>
</li></ul><p></p>
<p>Из каждого состояния можно выйти по фиксированному для каждого 
состояния пути. Как и куда выходить зависит от того, что нам нужно 
сделать. Какие данные послать.  </p>
<p>Путь определяется битами регистра TWCR и управляется он только вручную!<br>
</p><table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>TWINT</td><td>TWEA</td><td>TWSTA</td><td>TWSTO</td><td>TWWC</td><td>TWEN</td><td>—-</td><td>TWIE</td></tr><tr><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr></tbody></table><p></p>
<ul>
<li> TWINT — флаг прерывания. Сброс его означает что конечный автомат провернется дальше, а прерывание будет снова уловлено. </li>
<li> TWEA — Enable ACK. Разрешение ответа ACK. Если его включить, то 
автомат TWI будет отзываться на свой адрес, а также давать ACK во всех 
случаях когда этого требует протокол. Скажем, после прием байта. Если 
нам надо послать NACK то бит не ставим.  </li>
<li> TWSTA — Сформировать старт. Причем не факт, что прямо сейчас. От 
текущего состояния зависит. Например, если этот бит поставить в 0х38 
состоянии, то старт будет сформирован когда шина освободится. Контроллер
 TWI умный и сам все хорошо знает.  </li>
<li> TWSTO — сделать Stop. Опять же аналогично. После записи в этот бит 
модуль отваливается от сессии передачи. МК становится неадресованным 
ведомым.  </li>
<li> TWWC — конфликт записи. Сигнализирует о том, что кто то из 
прикладной программы записал в TWDR данные. Тогда как в TWDR полагается 
писать только при поднятом TWINT (в нашем случае это будет толкьо в 
обработчике прерывания).  </li>
<li> TWEN — блок TWI включен. Только и всего. </li>
<li> TWIE — прерывания от TWI разрешены. </li>
</ul>
<p>Простой пример — оптправка данных в EEPROM. По правилам шины i2c она должна выглядеть так:<br>
</p><table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>Master</td><td>Start</td><td>SLA+W</td><td></td><td>Byte</td><td></td><td>Byte</td><td></td><td>Stop</td></tr><tr><td>Slave</td><td></td><td></td><td>ACK</td><td></td><td>ACK</td><td></td><td>ACK</td><td></td></tr></tbody></table><br>
Какова последовательность действий? Ну первым делом мы все подготовим, 
запишем в нужные места данные, чтобы контроллер знал потом откуда все 
хватать. Считаем что это уже сделано. <p></p>
<p><b>Start</b><br>
В прикладной программе инициируем обмен по шине. Для этого всего то надо установить в TWCR биты:</p>
<ul>
<li> TWSTA — сказав, что мы формируем старт. </li>
<li> TWINT — иначе ничего не завертится. </li>
<li> TWEN — понятно зачем. Включить обязательно </li>
<li> TWIE — прерывания тоже нам нужны. </li>
</ul>
<p><b>0×08</b><br>
А дальше, как только блок TWI родит на шине Start, мы окажемся в 
прерывании TWI с кодом 0х08 и тут смотрим что надо сделать дальше. А 
дальше нам надо отправить SLA+W.   SLA+W мы записываем в TWDR и даем 
приказ заслать это в шину, поставив биты<br>
TWEN, TWIE, TWINT остальные не нужны. Т.к. это не старт, не стоп, и, для
 простоты, ведомым мы не являемся в принципе, а значит нам ACK никому 
слать не надо.  Запуливаем эту комбинацию в TWCR и выходим из 
прерывания.</p>
<p><b>0×18</b><br>
  Спустя какое то время, когда блок TWI срыгнет адрес на шину, мы вновь 
окажемся в прерывании. Но уже с кодом 0х18 (или 0х20 если нам никто не 
ответил). Теперь надо решать что дальше делать. Надо послать байт 
данных. Суем данные в TWDR из условленного места. И снова проворачиваем 
механизм, выставив флаги. На этот раз нужен тоже только TWEN, TWIE и 
TWINT.<br>
Блок TWI начнет отправлять данные по шине. Как закончит опять сгенерит прерывание, но уже с кодом 0х28</p>
<p><b>0х28</b><br>
Мы послали байт и попали сюда. Код 0х28 (или код 0х20 если ведомый 
послал нас NACK). Теперь надо решать что делать дальше. У нас там по 
плану еще один байт послать. Суем его в TWDR и шлем (TWEN, TWIE и 
TWINT).</p>
<p><b>0х28</b><br>
Опять в прерывании, опять  с кодом 0х28. А байты то кончились. Больше 
ничего слать не надо. Значит пошлем СТОП и прекратим обмен. Не проблема 
(TWEN, TWIE, TWINT и, главное, TWSTO). Теперь где нибудь выставим флажок
 или пошлем событие о том, что передача успешно завершена, а затем, с 
чистой совестью, выйдем из прерывания в фоновую программу. </p>
<p>Сложно? Вот и я думаю, что не очень. Особенно когда все по полочкам разложишь.<br>
А вот я рисовал когда то диаграмму движения по автомату с кодами ошибок и
 событий. Правда это не полный автомат, а только лишь режим Master и без
 арбитража</p>
<table align="center" border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
<td><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/IIC-State.GIF" alt=""></td>
</tr>
</tbody></table>
<div style="text-align: center;"><a href="http://easyelectronics.ru/img/starters/IIC/IIC-state-diagramm.GIF"><b>Покрупней</b></a></div>
<p>Синии линии — косяки и сбои. Красные — спокойная работа когда все говоря ACK и не перечат. </p>
<p>А сам обработчик прерывания TWI пишется очень просто. Берешь и 
делаешь CASE в который забиваешь все возможные коды входа  и варианты 
реакции на них. Получается чертовски много кода, но кусочки сами по себе
 простые. И за раз выполняется всего одна ветвь, а значит работает это 
ОЧЕНЬ быстро. </p>
<p>Причем не обязательно реализовывать все-все-все коды. Например, если у
 нас только Master то вся группа кодов для Slave не имеет смысла. Если 
мастер один, то вариантов развития с перехватом шины другим мастером 
тоже не будет. Или если проц работает только Slave то оставляем лишь 
Slave функции. Которые тоже можно почикать, убрав, например, прием байта
 если нам байты только отсылать. В общем,  кромсай@отрезай.  Главное 
затерминировать через Break или через Default остальные пути развития 
сценария. На всякий пожарный. </p>
<p> Я же, выполнил полностью весь автомат. С возможностями как Slave, 
так и Master. C возможностью перехвата обмена другим мастером. Не 
заморачивался только с широковещательными пакетами и повторным стартом 
для Slave режима. </p>
<p><b>Процесс</b><br>
Итак, как происходит обмен. Так как у меня в проекте поднят диспетчер, 
то вся обработка начальных/конечных событий сделана через него. </p>
<p><b>Обмен для мастера состоит из пунктов:</b></p>
<ul>
<li> 1. Подготовка данных и формирование первичного старта.  Т.е. все 
данные загружаются в нужные буферы, все индексы буферов выставляются на 
нули, записываются нужные адреса Slave и, если нужно, адреса страниц 
памяти, число передаваемых байт, число байт в адресе страницы. Требуемый
 режим обмена и тыды.   В общем всю необходимую инфу для передачи 
данных. А также задаю адрес точки выхода из автомата. И запускаю 
конечный автомат. </li>
<li> 2. Конечный автомат отрабатывает в соответстветствии с выбранным режимом передачи и на излете запускает выходную задачу. </li>
<li> 3. Выходная задача (мы еще в прерывании TWI, поэтому действуем 
быстро-быстро, не тупим), считывая коды ошибок, проверяет успешность 
передачи, если что не так делает перезапуск посредством заброса функции 
первичного старта через службу таймеров на повторное исполнение. Скажем 
через 50мс.  Если все хорошо, то ставим на конвейер диспетчера задачу 
следующую по алгоритму работы всей проги. </li>
</ul>
<p><b>Обмен для слейва попроще:</b></p>
<ul>
<li> 1. Инициализируем Slave, заполняем мастер-адреса. Заполняем буфера 
выходными данными (если такие могут быть). Включаем ACK, включаем 
прерывания TWI, включаем сам TWI. Задаем точку выхода из конечного 
автомата. Ждем когда к нам соизвоят постучаться. </li>
<li> 2. Если обращение произошло, то автомат его обрабатывает, 
заливает/сливает данные с выходных буферов. А по окончании обмена 
выполняет выходную задачу.  </li>
<li> 3. Выходная задача (мы еще в прерывании TWI, поэтому действуем 
быстро-быстро, не тупим) обрабатывает сгребает данные из входящих 
буферов, сигнализирует фоновой программе или запускает через диспетчер 
задачу исходя из пришедших данных. </li>
</ul>
<p>Причем во время работы мастера может произойти вызов его как слейва и
 тогда возникнет переход от одного обмена к другому. Туда и обратно. С 
повторной попыткой обмена. </p>
<p><b>Крутилки, ручки и кнопочки</b><br>
Опишу вначале все барахло что у меня там есть. Тут кратко. Подробней в исходниках, в комментариях.<br>
<b>Опции</b></p>
<ul>
<li> <b>i2c_PORT &amp; i2c_DDR</b> — Порт где сидит нога TWI </li>
<li> <b>i2c_SCL &amp;  i2c_SDA</b> —  Биты соответствующих выводов </li>
<li> <b>i2c_MasterAddress</b> — Адрес на который будем отзываться в роли Slave </li>
<li> <b>i2c_i_am_slave</b> — Если мы еще и слейвом работаем то 1. Если только мастером то 0. </li>
<li> <b>i2c_MasterBytesRX</b>	— Величина принимающего буфера режима Slave, т.е. сколько байт жрем. </li>
<li> <b>i2c_MasterBytesTX</b>	— Величина Передающего буфера режима Slave , т.е. сколько байт отдаем за сессию. </li>
<li>  <b>i2c_MaxBuffer</b> — Величина буфера Master режима RX-TX. Зависит от того какой длины строки мы будем гонять </li>
<li> <b>i2c_MaxPageAddrLgth</b> — Максимальная величина адреса страницы.
 Обычно адрес страницы это один или два байта. Зависит от типа ЕЕПРОМ 
или другой микросхемы. </li>
</ul>
<p><b>Стартовые данные</b></p>
<ul>
<li> <b>i2c_Do</b> — основная переменная состояния. Она флаговая. В нее вписываем флаги режима работы, из нее берем коды ошибок </li>
<li> <b>i2c_InBuff</b> — буфер приема в режиме Slave. Т.е. если мы 
работаем как ведомыми и нас вызвал мастер, то он впишет свои байтики 
сюда. Причем впишет не больше чем указано. Т.к. на последнем байте мы 
его пошлем NACK и откажемся принимать мастерские подачки. </li>
<li> <b>i2c_OutBuff</b> — а это выходной буфер ведомого. Когда мастер 
нас позовет и скажет «Есть чо?», то мы ему выгрузим данные отсюда. Таким
 образом, общение в качестве ведомого ведется через эти буфера. 
Например, в мультироцессорной робо системе, где есть голова, а есть 
ведомое шасси, то контроллер шасси может хранить в InBuff значения 
требуемой скорости и текущую команду. А в OutBuff показания датчиков и, 
например, показания с АЦП висящем на блоке аккумуляторов. И при обмене 
данными с головным контроллером он сливает ему OutBuff, а от него 
принимает InBuff  </li>
<li> <b>i2c_Buffer</b>— Это выходной буфер мастера. Если наш контроллер в
 качестве мастера ломанется куда-нибудь, то он сюда загрузит всю 
необходимую инфу и пнет ее слейву.  </li>
<li> <b>i2c_ByteCount</b> — важный параметр. Число передаваемых байт 
мастером. Можно сделать константой (проще, но не гибче) я сделал 
переменной, чтобы гонять данные туды сюды.  </li>
<li> <b>i2c_SlaveAddress</b> — Адрес подчиненного. То куда мы будем обращаться в режиме мастера.  </li>
<li> <b>i2c_PageAddress</b> — Буфер адреса страниц. Если вы помните 
режим обмена со всякими ЕЕПРОМ, то для чтения произвольного байта мы 
должны сначала записать в ЕЕПРОМ адрес этого байта, потом, вызвав 
ReStart считать данные. Вот тут у нас буфер где хранится адрес страницы 
для чтения ЕЕПРОМ. Сделан он буфером для универсальности. Т.к. у 
некоторых ЕЕПРОМ адрес страницы двухбайтный, а у некоторых однобайтный. 
Более того, есть куча устройств которые выглядят с точки зрения мастера 
как EEPROM, но не являются ими. Например часы RTC или цифровые 
акселерометры. У них, обычно, адрес страницы однобайтный.  </li>
<li> <b>i2c_PageAddrCount</b> — Число байт в адресе страницы для текущего Slave </li>
</ul>
<p>Указатели выхода из автомата. У меня выход из автомата сделан на 
функцию, адрес которой передается при вызове Master обмена или при 
включении Slave ожидания. Их три вида. </p>
<ul>
<li> <b>IIC_F MasterOutFunc</b>  — выход из автомата для мастера </li>
<li> <b>IIC_F ErrorOutFunc</b>  — выход из автомата в резултате ошибки в режиме Master </li>
<li> <b>IIC_F SlaveOutFunc</b>  — выход из автомата в режиме Slave </li>
</ul>
<p>Обычно я первые два обьединяю под одну функцию, а там уже проверяю на
 ошибки. Но, для оптимальности, можно и разделить их.  Причем сам выход 
записан в исходнике в форме макроса. Что позволяет, не лазая в дебрях 
автомата подправить в хидере этот макрос на что угодно. Например, на 
выставление флажка, если у вас не диспетчер, а флаговый автомат. </p>
<p><b>Режимы</b></p>
<ul>
<li> <strong>i2c_sarp</strong> (Start-Addr_R-Read-Stop) Это режим простого чтения. Например из слейва или из епрома с текущего адреса </li>
<li> <strong>i2c_sawp</strong>	(Start-Addr_W-Write-Stop) Это режим простой записи. В том числе и запись с адресом страницы.  </li>
<li> <strong>i2c_sawsarp</strong> ( 
Start-Addr_W-WrPageAdr-rStart-Addr_R-Read-Stop) 	Это режим с 
предварительной записью текущего адреса страницы. Например, через нее из
 EEPROM читают данные. </li>
</ul>
<p><b>Коды ошибок</b></p>
<ul>
<li> <b>i2c_Err_NO</b> All Right! — Все окей, передача успешна.  </li>
<li> <b>i2c_ERR_NA</b> — Device No Answer Слейв не отвечает. Т.к. либо занят, либо его нет на линии. </li>
<li> <b>i2c_ERR_LP</b> — Low Priority нас перехватили собственным адресом, либо мы проиграли арбитраж </li>
<li> <b>i2c_ERR_NK</b> — Received NACK. End Transmittion. Был получен NACK. Бывает и так. </li>
<li> <b>i2c_ERR_BF</b> — BUS FAIL Автобус сломался. И этим все сказано. Можно попробовать сделать переинициализацию шины </li>
</ul>
<p><b>Также есть флаги состояний</b></p>
<ul>
<li> <strong>i2c_Interrupted</strong> — передачу мастера прервали запросом собственного адреса от другого мастера </li>
<li> <strong>i2c_Busy</strong>	— Передатчик занят другим процессом отправки/приема, руками не трогать. </li>
</ul>
<p>…<br>
 — А есть любовь к доминированию или, наоборот, подчинению. Это называется садомазохизм.<br>
 — Слайды давай, слайды!<br>
… </p>
<p><b>Слайды</b><br>
А сейчас, дабы не быть голословным, я покажу вам извращенную групповую 
садомазо оргию с участием одного мазохиста и двух садо-мазохистов. </p>
<p>Итак, у нас есть одна большая крова… эмм шина IIC. На ней висят два контроллера и одна EEPROM.  </p>
<table align="center" border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
<td><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/i2c_bdsm_m.gif" alt=""></td>
</tr>
</tbody></table>
<div style="text-align: center;"><a href="http://easyelectronics.ru/img/AVR_kurs/i2c/i2c_bdsm.gif"><b>Посмотреть крупней</b></a></div>
<p>Контроллер1 получет из космоса бредовую мысль (байт по UART) и жестко
 домогась(master)  до EEPROM(slave)  забивает эту мысль ей в башку по 
адресу 0x00FF.  Но его не отпускает. Он решает поделиться мыслью и с 
Контроллером2. Но не просто так, а с подвывертом, будто это не ему в 
голову пришла бредовая мысль. Контроллер1(Master) ломится к 
Контроллеру2(Slave) и говорит ему — чувак, там у EEPROM по адресу 0x00FF
 в бошке засела умная мысль. Нуко достань!  Контроллер2, получив адрес 
(0x00FF) жесто домогается (Master) до EEPROM(slave) вбивает ей в мозги 
адрес, потом вытягивает бредовую мысль (тот самый байт). Додумывает к 
ней подробностей (прибавляет 1) и ломится(Master) со своей находкой к 
Контроллеру1(slave).  Контроллер1, внемлет  второму, принимает его 
бредовые идеи, и отправляет их обратно в космос (по UART). Все 
успокаиваются до новой посылки из космоса. </p>
<p>Причем все, кроме забитой еепромки, страдают манией и если кто то не 
отвечает — начинают настойчиво до него долбиться до тех пор, пока 
получат желаемое. Епромка же отличается тормознутостью. Умная мысль 
вгоняет ее в такой ступор (а шо ви хотели, flash медленная штука), что 
она целых 20мс не отвечает на домогания контроллера2. А он же ломится до
 тех пор, пока не ответят. </p>
<p><b>Код</b><br>
Инициализация Master режима заключается лишь в настройке скорости передачи, да включении.</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> Init_i2c<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>			<span style="color: #666666; font-style: italic;">// Настройка режима мастера</span>
<span style="color: #009900;">{</span>
i2c_PORT <span style="color: #339933;">|=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>i2c_SCL<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>i2c_SDA<span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Включим подтяжку на ноги, вдруг юзер на резисторы пожмотился</span>
i2c_DDR <span style="color: #339933;">&amp;=</span>~<span style="color: #009900;">(</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>i2c_SCL<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>i2c_SDA<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
TWBR <span style="color: #339933;">=</span> <span style="color: #208080;">0x80</span><span style="color: #339933;">;</span>         			<span style="color: #666666; font-style: italic;">// Настроим битрейт</span>
TWSR <span style="color: #339933;">=</span> <span style="color: #208080;">0x00</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Для Slave режима надо задать параметры ведомого. Адреса, а также 
точки выхода. Ну и включить передатчик соответствующим образом. Чтобы 
принимал свой адрес и отдавал ACK. Разумеется должны быть разрешены 
прерывания</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> Init_Slave_i2c<span style="color: #009900;">(</span>IIC_F Addr<span style="color: #009900;">)</span>	<span style="color: #666666; font-style: italic;">// Настройка режима слейва (если нужно)</span>
<span style="color: #009900;">{</span>
TWAR <span style="color: #339933;">=</span> i2c_MasterAddress<span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Внесем в регистр свой адрес, на который будем отзываться. </span>
				<span style="color: #666666; font-style: italic;">// 1 в нулевом бите означает, что мы отзываемся на широковещательные пакеты</span>
SlaveOutFunc <span style="color: #339933;">=</span> Addr<span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Присвоим указателю выхода по слейву функцию выхода</span>
&nbsp;
TWCR <span style="color: #339933;">=</span> 	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Включаем агрегат и начинаем слушать шину.</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Код библиотеки лучше смотреть в исходниках примеров, т.к. он слишком 
громоздок. Хотя и прост. Т.к. там нет ни одного замороченного алгоритма,
 а самое сложное что там есть — проверка битов режима. Т.к. все 
остальное делает автомат TWI.<br>
<a href="http://easyelectronics.ru/repository.php?act=view&amp;id=28"><b>IIC_ultimate.c</b></a><br>
<a href="http://easyelectronics.ru/repository.php?act=view&amp;id=29"><b>IIC_ultimate.h</b></a></p>
<p>Опишу лучше работу с ней на примере управляющей логики нашей садомазо группы</p>
<div style="text-align: center;"><b>Контроллер 1</b></div>
<p>Он начинает первый. </p>
<p>Его main функция выглядит вообще просто:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">int</span> main<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
InitAll<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                 		<span style="color: #666666; font-style: italic;">// Инициализируем периферию</span>
Init_i2c<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>               		<span style="color: #666666; font-style: italic;">// Запускаем и конфигурируем i2c</span>
Init_Slave_i2c<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>SlaveControl<span style="color: #009900;">)</span><span style="color: #339933;">;</span>   	<span style="color: #666666; font-style: italic;">// Настраиваем событие выхода при сработке как Slave</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/*
WorkIndex=0;               	// Лог с начала
WorkLog[WorkIndex]=1;         	// Записываем метку старта
WorkIndex++;
*/</span>
&nbsp;
InitRTOS<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>         		<span style="color: #666666; font-style: italic;">// Инициализируем ядро</span>
RunRTOS<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>         		<span style="color: #666666; font-style: italic;">// Старт ядра.</span>
&nbsp;
_delay_ms<span style="color: #009900;">(</span><span style="color: #0000dd;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>     		<span style="color: #666666; font-style: italic;">// Небольшая выдержка, чтобы второй контроллер успел встать на адресацию</span>
&nbsp;
&nbsp;
<span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #0000dd;">1</span><span style="color: #009900;">)</span>       			<span style="color: #666666; font-style: italic;">// Главный цикл диспетчера</span>
<span style="color: #009900;">{</span>
wdt_reset<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>   			<span style="color: #666666; font-style: italic;">// Сброс собачьего таймера</span>
TaskManager<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>   		<span style="color: #666666; font-style: italic;">// Вызов диспетчера</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Как видим — нет ничего кроме инициализации. Никакие задачи не страртуют. Экшн начинается когда приходит байт по UART</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
</pre></td><td class="code"><pre class="c" style="font-family:monospace;">ISR<span style="color: #009900;">(</span>USART_RXC_vect<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
UART_RX <span style="color: #339933;">=</span> UDR<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Сгребаем принятый байт в буфер</span>
SetTask<span style="color: #009900;">(</span>StartWrite2EPP<span style="color: #009900;">)</span><span style="color: #339933;">;</span>  	 <span style="color: #666666; font-style: italic;">// Запускаем процесс записи в ЕЕПРОМ.</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Сохраняется принятый байт и через диспетчер запускается процедура отправки байта в EEPROM</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> StartWrite2EPP<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span><span style="color: #339933;">!</span>i2c_eep_WriteByte<span style="color: #009900;">(</span><span style="color: #208080;">0xA0</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00FF</span><span style="color: #339933;">,</span>UART_RX<span style="color: #339933;">,&amp;</span>Writed2EEP<span style="color: #009900;">)</span><span style="color: #009900;">)</span>	<span style="color: #666666; font-style: italic;">// Если байт не записался</span>
	<span style="color: #009900;">{</span>
	SetTimerTask<span style="color: #009900;">(</span>StartWrite2EPP<span style="color: #339933;">,</span><span style="color: #0000dd;">50</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Повторить попытку через 50мс</span>
	<span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Функция <b>i2c_eep_WriteByte</b> отдает 1 если шина была свободна и 
процесс пошел. Если шина была занята обменом с другими участниками 
групповухи, то повтор попытки. Просто перезагрузка задачи через таймер. 
 В параметрах функции у нас адрес EEPROM на шине i2c (0xA0) и адрес 
страницы по которой мы будем писать данные (0х00FF), передаваемый байт 
из UART_RX, а также адрес процедуры выхода из автомата (Writed2EEP).</p>
<p>Когда автомат отработает все, мы туда и попадем</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> Writed2EEP<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
i2c_Do <span style="color: #339933;">&amp;=</span> i2c_Free<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Освобождаем шину</span>
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> <span style="color: #009900;">(</span>i2c_ERR_NA<span style="color: #339933;">|</span>i2c_ERR_BF<span style="color: #009900;">)</span><span style="color: #009900;">)</span>	<span style="color: #666666; font-style: italic;">// Если запись не удалась</span>
	<span style="color: #009900;">{</span>
	SetTimerTask<span style="color: #009900;">(</span>StartWrite2EPP<span style="color: #339933;">,</span><span style="color: #0000dd;">20</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// повторяем попытку</span>
	<span style="color: #009900;">}</span>
<span style="color: #b1b100;">else</span>
	<span style="color: #009900;">{</span>
	SetTask<span style="color: #009900;">(</span>SendAddrToSlave<span style="color: #009900;">)</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Если все ок, то идем на следующий</span>
	<span style="color: #009900;">}</span>				<span style="color: #666666; font-style: italic;">// Пункт задания - передача данных слейву 2</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Тут все просто. Проверим, что все ок и переходим к другому Slave девайсу.</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// Обращение к SLAVE контроллеру</span>
<span style="color: #993333;">void</span> SendAddrToSlave<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> i2c_Busy<span style="color: #009900;">)</span>				<span style="color: #666666; font-style: italic;">// Если передатчик занят</span>
	<span style="color: #009900;">{</span>
	SetTimerTask<span style="color: #009900;">(</span>SendAddrToSlave<span style="color: #339933;">,</span><span style="color: #0000dd;">100</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// То повторить через 100мс</span>
	<span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
&nbsp;
i2c_index <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Сброс индекса</span>
i2c_ByteCount <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Шлем два байта</span>
&nbsp;
i2c_SlaveAddress <span style="color: #339933;">=</span> <span style="color: #208080;">0xB0</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Адрес контроллера 0xB0</span>
&nbsp;
i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> <span style="color: #208080;">0x00</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Те самые два байта, что мы шлем подчиненному</span>
i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">1</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> <span style="color: #208080;">0xFF</span><span style="color: #339933;">;</span>
&nbsp;
i2c_Do <span style="color: #339933;">=</span> i2c_sawp<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Режим = простая запись, адрес+два байта данных</span>
&nbsp;
MasterOutFunc <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>SendedAddrToSlave<span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Точка выхода из автомата если все хорошо</span>
ErrorOutFunc <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>SendedAddrToSlave<span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// И если все плохо. </span>
&nbsp;
TWCR <span style="color: #339933;">=</span> 	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Поехали!</span>
&nbsp;
i2c_Do <span style="color: #339933;">|=</span> i2c_Busy<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Шина занята!</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Как я и описывал в разделе опций, мы тут полностью определяем 
параметры будущей передачи. Сколько байт передаем (i2c_ByteCount)  кому 
передаем (i2c_SlaveAddress), что передаем (i2c_Buffer), а также задаем 
режим передачи — простая запись ( i2c_sawp) . И точку выхода 
(SendedAddrToSlave). </p>
<p>Когда автомат отработает, то мы вываливаемся в принимающую задачу.</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> SendedAddrToSlave<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
i2c_Do <span style="color: #339933;">&amp;=</span> i2c_Free<span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Освобождаем шину</span>
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> <span style="color: #009900;">(</span>i2c_ERR_NA<span style="color: #339933;">|</span>i2c_ERR_BF<span style="color: #009900;">)</span><span style="color: #009900;">)</span>		<span style="color: #666666; font-style: italic;">// Если адресат нас не услышал или был сбой на линии</span>
	<span style="color: #009900;">{</span>										
	SetTimerTask<span style="color: #009900;">(</span>SendAddrToSlave<span style="color: #339933;">,</span><span style="color: #0000dd;">20</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Повторить попытку</span>
	<span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Тут все просто. Главное проверить, что все прошло хорошо. И перезапустить в случае косяка. </p>
<p>Остается подчиненная часть. Тут все еще проще. Только одна функция, точнее точка выхода из автомата:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> SlaveControl<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
i2c_Do <span style="color: #339933;">&amp;=</span> i2c_Free<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Освобождаем шину</span>
UDR <span style="color: #339933;">=</span> i2c_InBuff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Выгружаем принятый байт</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Освобождаем шину и загребаем байт из приемного буфера. </p>
<div style="text-align: center;"><b>Контроллер 2</b></div>
<p>Тут тоже все подобным образом, но в другом порядке. Тон тут задает не
 прерывание UART, а приход адресных байтов от Контроллера 1.</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">int</span> main<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
InitAll<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                     		<span style="color: #666666; font-style: italic;">// Инициализируем периферию</span>
Init_i2c<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                     	<span style="color: #666666; font-style: italic;">// Настроили мастер режим</span>
Init_Slave_i2c<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>SlaveControl<span style="color: #009900;">)</span><span style="color: #339933;">;</span>     	 <span style="color: #666666; font-style: italic;">// Настроили слейв режим</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/*
WorkLog[WorkIndex]=1;
WorkIndex++;
*/</span>
&nbsp;
InitRTOS<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>         			<span style="color: #666666; font-style: italic;">// Инициализируем ядро</span>
RunRTOS<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>         			<span style="color: #666666; font-style: italic;">// Старт ядра.</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #0000dd;">1</span><span style="color: #009900;">)</span>       				<span style="color: #666666; font-style: italic;">// Главный цикл диспетчера</span>
<span style="color: #009900;">{</span>
wdt_reset<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>   				<span style="color: #666666; font-style: italic;">// Сброс собачьего таймера</span>
TaskManager<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>   			<span style="color: #666666; font-style: italic;">// Вызов диспетчера</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Только настроили точку выхода из TWI (SlaveControl)</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> SlaveControl<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>                  <span style="color: #666666; font-style: italic;">// Точка выхода из автомата слейва</span>
<span style="color: #009900;">{</span>
i2c_Do <span style="color: #339933;">&amp;=</span> i2c_Free<span style="color: #339933;">;</span>                     <span style="color: #666666; font-style: italic;">// Осовобождаем шину</span>
SetTask<span style="color: #009900;">(</span>ReadEEPROM<span style="color: #009900;">)</span><span style="color: #339933;">;</span>                 	<span style="color: #666666; font-style: italic;">// Готовим запись в ЕЕПРОМ</span>
<span style="color: #009900;">}</span>
&nbsp;
Байты получены. Можно запускать чтение из EEPROM.
&nbsp;
<span style="color: #993333;">void</span> ReadEEPROM<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>                       		<span style="color: #666666; font-style: italic;">// Читаем из еепром</span>
<span style="color: #009900;">{</span>
u16 Addr<span style="color: #339933;">;</span>
&nbsp;
Addr <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>i2c_InBuff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span><span style="color: #339933;">|</span><span style="color: #009900;">(</span>i2c_InBuff<span style="color: #009900;">[</span><span style="color: #0000dd;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>            	<span style="color: #666666; font-style: italic;">// Адрес возьмем из буфера слейва</span>
&nbsp;
<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span><span style="color: #339933;">!</span>i2c_eep_ReadByte<span style="color: #009900;">(</span><span style="color: #208080;">0xA0</span><span style="color: #339933;">,</span>Addr<span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,&amp;</span>EepromReaded<span style="color: #009900;">)</span> <span style="color: #009900;">)</span>      <span style="color: #666666; font-style: italic;">// Читаем</span>
   <span style="color: #009900;">{</span>
   SetTimerTask<span style="color: #009900;">(</span>ReadEEPROM<span style="color: #339933;">,</span><span style="color: #0000dd;">50</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                  		<span style="color: #666666; font-style: italic;">// Если процесс не пошел (шина занята), то повтор через 50мс.</span>
   <span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Все аналогичным же образом. Разница лишь в том, что тут мы читаем из памяти. И точка выхода у нас другая (EepromReaded)</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> EepromReaded<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>               		<span style="color: #666666; font-style: italic;">// Была попытка чтения</span>
<span style="color: #009900;">{</span>
i2c_Do <span style="color: #339933;">&amp;=</span> i2c_Free<span style="color: #339933;">;</span>                  		<span style="color: #666666; font-style: italic;">// Освобождаем шину</span>
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> <span style="color: #009900;">(</span>i2c_ERR_NA<span style="color: #339933;">|</span>i2c_ERR_BF<span style="color: #009900;">)</span><span style="color: #009900;">)</span>   		<span style="color: #666666; font-style: italic;">// Ошибки при четнии были?</span>
   <span style="color: #009900;">{</span>
   SetTimerTask<span style="color: #009900;">(</span>ReadEEPROM<span style="color: #339933;">,</span><span style="color: #0000dd;">20</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>     		 <span style="color: #666666; font-style: italic;">// Тогда повтор</span>
   <span style="color: #009900;">}</span>
<span style="color: #b1b100;">else</span>
   <span style="color: #009900;">{</span>
   ReadedByte <span style="color: #339933;">=</span> i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>         		<span style="color: #666666; font-style: italic;">// Иначе считаный байт из буфера копируем в переменную</span>
   SetTask<span style="color: #009900;">(</span>SendByteToSlave<span style="color: #009900;">)</span><span style="color: #339933;">;</span>         		<span style="color: #666666; font-style: italic;">// И запускаем отсылку ее контроллеру 1</span>
   <span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Когда EEPROM будет успешно прочитана, то мы загоним задачу отправки байта контроллеру 1 (SendByteToSlave) . Вот эта задача:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> SendByteToSlave<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>        		 <span style="color: #666666; font-style: italic;">// Возвращаем контроллеру 1 его байт</span>
<span style="color: #009900;">{</span>
<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> i2c_Busy<span style="color: #009900;">)</span>            		<span style="color: #666666; font-style: italic;">// Если шина занята</span>
      <span style="color: #009900;">{</span>
      SetTimerTask<span style="color: #009900;">(</span>SendByteToSlave<span style="color: #339933;">,</span><span style="color: #0000dd;">100</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>         <span style="color: #666666; font-style: italic;">// То повторяем попытку</span>
      <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">}</span>
&nbsp;
i2c_index <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>                     		<span style="color: #666666; font-style: italic;">// Сброс индекса</span>
i2c_ByteCount <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>                  		<span style="color: #666666; font-style: italic;">// Шлем 1 байт</span>
&nbsp;
i2c_SlaveAddress <span style="color: #339933;">=</span> <span style="color: #208080;">0x32</span><span style="color: #339933;">;</span>            		<span style="color: #666666; font-style: italic;">// Адрес контроллера 1 на шине</span>
&nbsp;
i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> ReadedByte<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>         		<span style="color: #666666; font-style: italic;">// Загружаем в буфер число, увеличив его на 1.</span>
                              			<span style="color: #666666; font-style: italic;">// +1 чтобы понять, что число прошло через МК и было обработано</span>
&nbsp;
&nbsp;
i2c_Do <span style="color: #339933;">=</span> i2c_sawp<span style="color: #339933;">;</span>                  		<span style="color: #666666; font-style: italic;">// Режим - простая запись</span>
&nbsp;
MasterOutFunc <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>SendedByteToSlave<span style="color: #339933;">;</span>      	<span style="color: #666666; font-style: italic;">// Задаем точку выхода</span>
ErrorOutFunc <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>SendedByteToSlave<span style="color: #339933;">;</span>
&nbsp;
TWCR <span style="color: #339933;">=</span> 	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span>
	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>      				<span style="color: #666666; font-style: italic;">// Поехали!</span>
&nbsp;
i2c_Do <span style="color: #339933;">|=</span> i2c_Busy<span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Флаг занятости поставим</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Все полностью по аналогии.</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> SendedByteToSlave<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>            	<span style="color: #666666; font-style: italic;">// Байт был послан</span>
<span style="color: #009900;">{</span>
i2c_Do <span style="color: #339933;">&amp;=</span> i2c_Free<span style="color: #339933;">;</span>                     	<span style="color: #666666; font-style: italic;">// Осовбождаем шину</span>
&nbsp;
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> <span style="color: #009900;">(</span>i2c_ERR_NA<span style="color: #339933;">|</span>i2c_ERR_BF<span style="color: #009900;">)</span><span style="color: #009900;">)</span>      	<span style="color: #666666; font-style: italic;">// Если посылка не удалась</span>
   <span style="color: #009900;">{</span>
   SetTimerTask<span style="color: #009900;">(</span>SendByteToSlave<span style="color: #339933;">,</span><span style="color: #0000dd;">20</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>      	<span style="color: #666666; font-style: italic;">// Пробуем еще раз.</span>
   <span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>И все. Тупо ждем следующего экшна.  Т.е .в принцип работы заложена 
основа, что у нас обмен делается посредством связки из двух функций. 
Запускающей и выходящей. </p>
<div style="text-align: center;"><b>EEPROM</b></div>
<p>Поскольку ей в мозги не заглянешь, то покажу тут содержимое 
библиотечки, через которую мы к ней стучались. Тоже накорябал на днях. 
Если IIC_ultimate.c это своего рода полуфабрикат, то это уже ближе к 
финальному продукту, для непосредственной работы.</p>
<p>Там все очень и очень просто, смотрите сами:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;i2c_AT24C_EEP.h&gt;</span>
&nbsp;
&nbsp;
<span style="color: #339933;">#define HI(X) (X&gt;&gt;8)			// Макросы разделения слова на байты</span>
<span style="color: #339933;">#define LO(X) (X &amp; 0xFF)</span>
&nbsp;
u08 i2c_eep_WriteByte<span style="color: #009900;">(</span>u08 SAddr<span style="color: #339933;">,</span>u16 Addr<span style="color: #339933;">,</span> u08 Byte<span style="color: #339933;">,</span> IIC_F WhatDo<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
&nbsp;
<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> i2c_Busy<span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Если шина занята, то возвращаем 0</span>
&nbsp;
i2c_index <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Зануляем индексы</span>
i2c_ByteCount <span style="color: #339933;">=</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Запись байта всего делается за три байта. </span>
					<span style="color: #666666; font-style: italic;">// Два байта -- адрес страницы и байт данных.</span>
&nbsp;
i2c_SlaveAddress <span style="color: #339933;">=</span> SAddr<span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Какой именно EEPROM будем слать. </span>
&nbsp;
&nbsp;
i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> HI<span style="color: #009900;">(</span>Addr<span style="color: #009900;">)</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// В буфер кладем адрес страницы</span>
i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">1</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> LO<span style="color: #009900;">(</span>Addr<span style="color: #009900;">)</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Старший и младший байты, по очереди. Старший впереди</span>
i2c_Buffer<span style="color: #009900;">[</span><span style="color: #0000dd;">2</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> Byte<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Ну и байт данных</span>
&nbsp;
i2c_Do <span style="color: #339933;">=</span> i2c_sawp<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Режим простой записи</span>
&nbsp;
MasterOutFunc <span style="color: #339933;">=</span> WhatDo<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Точка выхода которую нам передадут</span>
ErrorOutFunc <span style="color: #339933;">=</span> WhatDo<span style="color: #339933;">;</span>
&nbsp;
TWCR <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span><span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span><span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// ПЦ!</span>
&nbsp;
i2c_Do <span style="color: #339933;">|=</span> i2c_Busy<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Занимаем шину</span>
&nbsp;
<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Возвращаем 1, мол процесс пошел. </span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Это чтение из EEPROM Тут чуточку сложней</span>
u08 i2c_eep_ReadByte<span style="color: #009900;">(</span>u08 SAddr<span style="color: #339933;">,</span> u16 Addr<span style="color: #339933;">,</span> u08 ByteNumber<span style="color: #339933;">,</span> IIC_F WhatDo<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> i2c_Busy<span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// Если шина занята</span>
&nbsp;
i2c_index <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Индексы в ноль</span>
i2c_ByteCount <span style="color: #339933;">=</span> ByteNumber<span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Число считываемых байт</span>
&nbsp;
i2c_SlaveAddress <span style="color: #339933;">=</span> SAddr<span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Адрес EEPROM на шине IIC</span>
&nbsp;
i2c_PageAddress<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> HI<span style="color: #009900;">(</span>Addr<span style="color: #009900;">)</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// На этот раз грузим адрес страницы</span>
i2c_PageAddress<span style="color: #009900;">[</span><span style="color: #0000dd;">1</span><span style="color: #009900;">]</span> <span style="color: #339933;">=</span> LO<span style="color: #009900;">(</span>Addr<span style="color: #009900;">)</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// В специальный буфер</span>
&nbsp;
i2c_PageAddrIndex <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Обнуляем индексы</span>
i2c_PageAddrCount <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Адрес страницы из 2 байт</span>
&nbsp;
i2c_Do <span style="color: #339933;">=</span> i2c_sawsarp<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Режим чтения с заносом адреса</span>
&nbsp;
MasterOutFunc <span style="color: #339933;">=</span> WhatDo<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Точка выхода</span>
ErrorOutFunc <span style="color: #339933;">=</span> WhatDo<span style="color: #339933;">;</span>
&nbsp;
TWCR <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span><span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span><span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">//ПЦ!</span>
&nbsp;
i2c_Do <span style="color: #339933;">|=</span> i2c_Busy<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Заняли шину, чтобы никто не мешал. </span>
&nbsp;
<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>				<span style="color: #666666; font-style: italic;">// Вернули 1, мол процесс пошел. </span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Вот так вот. </p>
<p><b>Железо</b></p>
<blockquote><p>Чтобы такое по быстрому слабать на коленке я заюзал свою маленькую прелесть… Дада вы уже догадались. <a href="http://shop.easyelectronics.ru/index.php?productID=147">Pinboard</a>.  Там есть почти все необходимое для нашей вакханалии. Два контроллера и макетное поле в которое мы засадим микросхему памяти.</p>
<p> Один контроллер, правда, это JTAG адаптер. Но это не страшно. На 
борту есть FTBB программатор, поэтому нам ничего не стоит прошить его 
тем же бутлоадером, превратив в рядовой контроллер, подобный главному 
(обратно вернуть просто, достаточно запустить батник зашивки кода JTAG 
см. <a href="http://easyelectronics.ru/files/PinBoard/ftbb.zip" onclick="javascript:_gaq.push(['_trackEvent','download','http://easyelectronics.ru/files/PinBoard/ftbb.zip']);">документацию по самопрограммированию</a>)</p>
<p>Подключите FTBB выводы к порту прошивки JTAG контроллера и выполните батник <b>PBSelf16.cmd</b>
  после чего контроллер также начнет отвечать на бутлоадер. Надо будет 
только подсоединить его к порту джамперами JTAG (отключив переключатели 
UART). Да, для прошивки обеих контроллеров вы тумблерочками этими 
туда-сюда нащелкаетесь :)</p>
<p>  Потом снимите шлейфик и пользуйтесь им как главным, т.е. через 
бутлоадер. А чтобы вернуть JTAG адаптер на место то просто оденьте шлейф
 обратно, и запустите батник <b>PBSelfJT.cmd</b> и прошивка JTAG’a будет возвращена на место.</p>
<p>Также, в некоторых версиях возможно придется перепаять один резистор 
на плате. Дело в том, что изначально JTAG контроллер планировался как 
отладочный JTAG интерфейс и не более того. Однако куда интересней когда 
мы его можем использовать в любых целях. Но осознание этого пришло 
несколько позже :(. Так что в старых ревизиях версии 1.1 на линии SCL у 
нижней меги стоит резистор в 100ом, что слишком мало для подтяжки. Нога 
может не придавить и шина работать не будет. Его надо аккуратно выпаять и
 впаять туда резистор на 10к. Отпаивается smd резистор довольно просто —
 кладем на него паяльник плашмя, так чтобы прогреть его весь, да 
сдвигаем зубочисткой. В новых версиях там уже везде идут другие 
номиналы. </p>
<p>Резисторы которые надо заменить показаны на картинке:</p>
<table align="center" border="1" cellpadding="1" cellspacing="1">
<tbody><tr>
<td><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/pb2_rear_2.jpg" alt=""></td>
</tr>
</tbody></table>
</blockquote>
<p><b>Сборка схемы</b><br>
Что к чему идет показано на фотках (кликабельны). Думаю все понятно. Благо схема то там — три с половиной проводка.<br>
</p><table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/main_view_m.jpg"></td><td><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/pads_at24_m.jpg"></td></tr><tr><td><a href="http://easyelectronics.ru/img/AVR_kurs/i2c/main_view.jpg">Увеличить</a></td><td><a href="http://easyelectronics.ru/img/AVR_kurs/i2c/pads_at24.jpg">Увеличить</a></td></tr></tbody></table><p></p>
<p><b>Ну и процесс работы</b></p>
<div style="text-align: center;"><object height="385" width="480"><param name="movie" value="http://www.youtube.com/v/ijP6luNBqrs?fs=1&amp;hl=ru_RU"><param name="allowFullScreen" value="true"><param name="allowscriptaccess" value="always"><embed src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/ijP6luNBqrs" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" height="385" width="480"></object></div>
<ul>
<li> <b><a href="http://easyelectronics.ru/img/AVR_kurs/i2c/avrmultimaster.zip" onclick="javascript:_gaq.push(['_trackEvent','download','http://easyelectronics.ru/img/AVR_kurs/i2c/avrmultimaster.zip']);">Архив с проектами под оба контроллера</a></b> </li>
</ul>
<p><b>Пара слов о отладке</b><br>
В процессе написания было наделана куча багов, порой идиотских, но от 
этого не менее страшных. В процессе отладки активно применялся 
отладочный буфер. Его вы найдете закомментированым в коде. Это барахло 
вида:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>WorkIndex <span style="color: #339933;">&lt;</span><span style="color: #0000dd;">99</span><span style="color: #009900;">)</span>					<span style="color: #666666; font-style: italic;">// Если лог не переполнен</span>
<span style="color: #009900;">{</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>TWSR<span style="color: #009900;">)</span>					<span style="color: #666666; font-style: italic;">// Статус нулевой?</span>
		<span style="color: #009900;">{</span>
		WorkLog<span style="color: #009900;">[</span>WorkIndex<span style="color: #009900;">]</span><span style="color: #339933;">=</span> TWSR<span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Пишем статус в лог</span>
		WorkIndex<span style="color: #339933;">++;</span>						
		<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">else</span>
		<span style="color: #009900;">{</span>
		WorkLog<span style="color: #009900;">[</span>WorkIndex<span style="color: #009900;">]</span><span style="color: #339933;">=</span> <span style="color: #208080;">0xFF</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// Если статус нулевой то вписываем FF</span>
		WorkIndex<span style="color: #339933;">++;</span>
		<span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>И прочие почеркушки в массив WorkLog. </p>
<p>Т.е. мы пишем все статусы TWSR с лог, а потом, спустя какое то время (я выбирал около 1с) сбрасываем его в терминал.</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">void</span> LogOut<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>				<span style="color: #666666; font-style: italic;">// Выброс логов</span>
<span style="color: #009900;">{</span>
u08 i<span style="color: #339933;">;</span>
&nbsp;
WorkLog<span style="color: #009900;">[</span>WorkIndex<span style="color: #009900;">]</span><span style="color: #339933;">=</span> <span style="color: #208080;">0xFF</span><span style="color: #339933;">;</span>
WorkIndex<span style="color: #339933;">++;</span>
&nbsp;
<span style="color: #b1b100;">for</span><span style="color: #009900;">(</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>i<span style="color: #339933;">!=</span>WorkIndex<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">)</span>
	<span style="color: #009900;">{</span>
	UDR <span style="color: #339933;">=</span> WorkLog<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	_delay_ms<span style="color: #009900;">(</span><span style="color: #0000dd;">30</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Напрямую в UART данные пихать нельзя. Т.к. TWI автомат щелкает 
гораздо быстрей чем UART может прожевать. И получится что что то 
потеряется, что то перепутается. А так мы получаем четкую историю работы
 программы. Понятно что происходит, где зацикливается передача, где не 
идет обмен. </p>
<p>Вот, например, мне Slave выдавал такие логи в хексах:</p>

<div class="wp_syntax"><div class="code"><pre class="avr" style="font-family:monospace;">60 80 88 08 20 08 18 28 28 10 40 58 08 18 30</pre></div></div>

<p>Сразу видно, по статусам, как прошел обмен. Как он получил байт от 
Master (60 80 88). Как попытался достучаться до EEPROM, но та была 
занята прожевыванием предыдущего байта (08 20). Как повторил попытку и 
успешно записал в нее адрес и считал байт (08 18 28 28 10 40 58), а 
потом отправил его другому контроллеру (08 18 30). </p>
<p>А отслеживать прохождение отдельных байт помогал осциллограф. 
Показывая что творится на шине, есть ли там NACK/ACK и когда идет ответы
 от Slave. </p>
<p> Кстати, пробовал, ради прикола, погонять пример в Proteus — выдал 
какую то неадекватную муть. I2C анализатор вообще половину обмена 
прошляпил. Хотя, по логам в терминалах, вторая половина все же был. Хотя
 и через задницу и не до конца. Плюс еще были интересные баги от того, 
что Proteus контроллер при старте запускает в нули , а реальный 
процессор может иметь неопределенное значение в некоторых регистрах.  
Так что был прикольный баг, когда прошивка в Proteus работает, а в реале
 нифига подобного. В общем, диодиком помигать сгодится, но пытаться 
отлаживать в нем что либо серьезное это надо быть сильно просветленным. 
Т.к. в железе все оно будет вести себя совсем по другому.</p>
<p><strong>Доработки</strong><br>
Глюки я вроде бы поотлавливал. В разных режимах мастеров посталкивал. Но
 кое что надо доработать. Например, избавиться от полчища буферов и 
первести все на указатели. Чтобы в функции запуска/инициализации 
передвались только указатели на произвольный массив. Также было 
предложение все параметры согнать в структуры. Так что версию я может 
еще и обновлю. Но пока не до нее. Еще интересные вещи есть с которыми 
стоит поковыряться. </p>
<p>З.Ы.<br>
Большое спасибо камраду Dcoder’у за ценные советы и идеи в процессе отладки. </p>
											</div><!-- .entry-content -->

<!-- Яндекс.Директ -->
<script type="text/javascript"><!--
yandex_partner_id = 49703;
yandex_site_bg_color = 'FFFFFF';
yandex_site_charset = 'utf-8';
yandex_ad_format = 'direct';
yandex_font_size = 1;
yandex_direct_type = 'horizontal';
yandex_direct_limit = 4;
yandex_direct_header_bg_color = 'F8F8F8';
yandex_direct_title_color = '000000';
yandex_direct_url_color = '990000';
yandex_direct_all_color = '990000';
yandex_direct_text_color = '000000';
yandex_direct_hover_color = '000000';
document.write('<sc'+'ript type="text/javascript" src="http://an.yandex.ru/system/context.js"></sc'+'ript>');
//--></script><script type="text/javascript" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/context.js"></script><div id="Ya_sync_0"><div id="ya_partner_Ya_sync_0-horizontal" style="background:transparent none no-repeat scroll 0 0 !important;border:none !important;border-radius:none !important;border-spacing:0 !important;border-collapse:collapse !important;-moz-box-sizing:content-box !important;box-sizing:content-box !important;clear:none !important;clip:auto !important;color:inherit !important;cursor:auto !important;empty-cells:show !important;float:none !important;font:inherit !important;font-variant:normal !important;font-weight:normal !important;height:auto !important;letter-spacing:normal !important;line-height:normal !important;margin:0 !important;max-height:none !important;max-width:none !important;min-height:0 !important;min-width:0 !important;outline:none !important;overflow:visible !important;padding:0 !important;position:static !important;table-layout:auto !important;text-align:left !important;text-decoration:none !important;text-indent:0 !important;text-transform:none !important;vertical-align:baseline !important;visibility:visible !important;white-space:normal !important;width:auto !important;word-spacing:normal !important;z-index:auto !important;display:block !important;"><yatag class="ya-partner_theme_horizontal  ya-partner ya-partner_type_horiz"><yatag class="ya-partner__ads"><yatag class="ya-partner__ads-l"><a href="http://direct.yandex.ru/?partner" class="ya-partner__ads-link ya-partner__ads-link-l" target="_blank">Яндекс.Директ</a></yatag></yatag><table class="ya-partner__list" cellpadding="0" cellspacing="0"><tbody><tr class="ya-partner__tr"><td class="ya-partner__item ya-partner__item-1 ya-partner__item_pic_yes ya-partner__item_piclayout_float ya-partner__item_sitelinks_no ya-partner__item_pos_first"><yatag class="ya-partner__pic-container"><a href="http://an.yandex.ru/count/NdKZbWAg1kO40000ZhgPloy5XPSY39K2cm5kGxS2Am68k78a80M9bH5Hc4ATf3F80PQdOdN8klvTCUJ99ilF3gPHYgosJh2zh6VJvQe1fQqo-G6Hk1zRrmsFlsBv1W-VlaiWAGYJYmkPUqACa8WJe93v5Q-GY1EKcVeFfvb60QYwUqh30gJ00000_06iCQx-3DynR5KzyWIn0RA84xcaCyW1k_x9Q8QHUgh20dWK?test-tag=2129" class="ya-partner__pic" target="_blank" title="aviasales.ru" style="width: 90px ! important; height: 90px ! important; background-image: url(&quot;//avatars-fast.yandex.net/get-direct/XA_tDbAFMnafgEAKkjvkzA/y90&quot;) ! important;"></a></yatag><a href="http://an.yandex.ru/count/NdKZbWAg1kO40000ZhgPloy5XPSY39K2cm5kGxS2Am68k78a80M9bH5Hc4ATf3F80PQdOdN8klvTCUJ99ilF3gPHYgosJh2zh6VJvQe1fQqo-G6Hk1zRrmsFlsBv1W-VlaiWAGYJYmkPUqACa8WJe93v5Q-GY1EKcVeFfvb60QYwUqh30gJ00000_06iCQx-3DynR5KzyWIn0RA84xcaCyW1k_x9Q8QHUgh20dWK?test-tag=2129" class="ya-partner__title-link" title="aviasales.ru" target="_blank"><yatag class="ya-partner__title-link-text">Авиабилеты дешево на&nbsp;AVIASALES.RU</yatag></a> <yatag class="ya-partner__text">Быстрый поиск самых дешевых авиабилетов по 728 авиакомпаниям! Онлайн бронь!</yatag><yatag class="ya-partner__url"><yatag class="ya-partner__domain"><a class="ya-partner__domain-link" href="http://an.yandex.ru/count/NdKZbWAg1kO40000ZhgPloy5XPSY39K2cm5kGxS2Am68k78a80M9bH5Hc4ATf3F80PQdOdN8klvTCUJ99ilF3gPHYgosJh2zh6VJvQe1fQqo-G6Hk1zRrmsFlsBv1W-VlaiWAGYJYmkPUqACa8WJe93v5Q-GY1EKcVeFfvb60QYwUqh30gJ00000_06iCQx-3DynR5KzyWIn0RA84xcaCyW1k_x9Q8QHUgh20dWK?test-tag=2129" target="_blank">aviasales.ru</a></yatag> <yatag class="ya-partner__region"></yatag></yatag><yatag class="ya-partner__clearfix"></yatag></td><td class="ya-partner__gap">&nbsp;</td><td class="ya-partner__item ya-partner__item-2 ya-partner__item_pic_yes ya-partner__item_piclayout_float ya-partner__item_sitelinks_yes"><yatag class="ya-partner__pic-container"><a href="http://an.yandex.ru/count/NdKZblJfneq40000ZhgPloy5XPSY39K2cm5kGxS2Am4oYBiqJe04YQasRAYOGfscIP8BbgTYTSYw_bqnvCacoyyEfaUAfy7_gRsgkTnggW6bedl30P6u7rlN3O-q2Vq219--EZXv0fEB2vbPGeoGdoIWa9yahv2V99IHhYsdaL41gA1jv1Aam0000Fm1h36k_WpVCMnLFV84iG6oY1EvfacI2xl-oMY6aNggmW9v5000?test-tag=2129" class="ya-partner__pic" target="_blank" title="kayak.ru" style="width: 90px ! important; height: 90px ! important; background-image: url(&quot;//avatars-fast.yandex.net/get-direct/d3R1Q8HjTXbGfbaRTwOIfQ/y90&quot;) ! important;"></a></yatag><a href="http://an.yandex.ru/count/NdKZblJfneq40000ZhgPloy5XPSY39K2cm5kGxS2Am4oYBiqJe04YQasRAYOGfscIP8BbgTYTSYw_bqnvCacoyyEfaUAfy7_gRsgkTnggW6bedl30P6u7rlN3O-q2Vq219--EZXv0fEB2vbPGeoGdoIWa9yahv2V99IHhYsdaL41gA1jv1Aam0000Fm1h36k_WpVCMnLFV84iG6oY1EvfacI2xl-oMY6aNggmW9v5000?test-tag=2129" class="ya-partner__title-link" title="kayak.ru" target="_blank"><yatag class="ya-partner__title-link-text">Авиабилеты Н.Новгород Симферополь</yatag></a> <yatag class="ya-partner__text">Моментальное сравнение цен авиабилетов на рейс «Н.Новгород Симферополь»!</yatag><yatag class="ya-partner__sitelinks"><yatag class="ya-partner__sitelink ya-partner__sitelink-1"><a class="ya-partner__sitelinks-text" target="_blank" href="http://an.yandex.ru/count/NdKZbjFHX0u40000ZhgPloy5XPSY39K2cm5kGxS2Am4oYBiqJe04YQasRAYOGfscIP8BbgTYTSYw_bqnvCacoyyEfaUAfy7_gRsgkTnggWQbedl30P6u7rlN3O-q2Vq219--EZXv0fEB2vbPGeoGdoIWa9yahv2V99IHhYsdaL41gA1jv1Aam0000Fm1h36k_WpVCMnLFV84iG6oY1EvfacI2xl-oMY6aNggmW9v5000?test-tag=2129">Отели в&nbsp;Симферополе</a><yatag class="ya-partner__sitelinks-inline-delim">·</yatag></yatag><wbr><yatag class="ya-partner__sitelink ya-partner__sitelink-2"><a class="ya-partner__sitelinks-text" target="_blank" href="http://an.yandex.ru/count/NdKZbfsX0GW40000ZhgPloy5XPSY39K2cm5kGxS2Am4oYBiqJe04YQasRAYOGfscIP8BbgTYTSYw_bqnvCacoyyEfaUAfy7_gRsgkTnggWYbedl30P6u7rlN3O-q2Vq219--EZXv0fEB2vbPGeoGdoIWa9yahv2V99IHhYsdaL41gA1jv1Aam0000Fm1h36k_WpVCMnLFV84iG6oY1EvfacI2xl-oMY6aNggmW9v5000?test-tag=2129">Маршруты с&nbsp;пересадкой</a><yatag class="ya-partner__sitelinks-inline-delim">·</yatag></yatag><wbr><yatag class="ya-partner__sitelink ya-partner__sitelink-3"><a class="ya-partner__sitelinks-text" target="_blank" href="http://an.yandex.ru/count/NdKZbeJSWD840000ZhgPloy5XPSY39K2cm5kGxS2Am4oYBiqJe04YQasRAYOGfscIP8BbgTYTSYw_bqnvCacoyyEfaUAfy7_gRsgkTnggWgbedl30P6u7rlN3O-q2Vq219--EZXv0fEB2vbPGeoGdoIWa9yahv2V99IHhYsdaL41gA1jv1Aam0000Fm1h36k_WpVCMnLFV84iG6oY1EvfacI2xl-oMY6aNggmW9v5000?test-tag=2129">Скачать приложение</a></yatag><wbr></yatag><yatag class="ya-partner__url"><yatag class="ya-partner__domain"><a class="ya-partner__domain-link" href="http://an.yandex.ru/count/NdKZblJfneq40000ZhgPloy5XPSY39K2cm5kGxS2Am4oYBiqJe04YQasRAYOGfscIP8BbgTYTSYw_bqnvCacoyyEfaUAfy7_gRsgkTnggW6bedl30P6u7rlN3O-q2Vq219--EZXv0fEB2vbPGeoGdoIWa9yahv2V99IHhYsdaL41gA1jv1Aam0000Fm1h36k_WpVCMnLFV84iG6oY1EvfacI2xl-oMY6aNggmW9v5000?test-tag=2129" target="_blank">kayak.ru</a></yatag> <yatag class="ya-partner__region"></yatag></yatag><yatag class="ya-partner__clearfix"></yatag></td><td class="ya-partner__gap">&nbsp;</td><td class="ya-partner__item ya-partner__item-3 ya-partner__item_pic_yes ya-partner__item_piclayout_float ya-partner__item_sitelinks_no"><yatag class="ya-partner__pic-container"><a href="http://an.yandex.ru/count/NdKZbdAOr6i40000ZhgPloy5XPSY39K2cm5kGxS2Am4pYBRJp101YQDXNhAOhA-zlfsSk1AMfs9roBh-NJ7aoIRBpmwc48gXBDtHlQAoP7Ig0QMbJDG1aRWVMzSDZxGw4aaBdxwNjtu2auiBcJb2Z91g6A2GdoIla6eOb9yr1wURO06efNYbXQJ00000_06iCQx-3DynR5KzyWIn0RA84xcSk1Ax_ibeXf5wgi82UXG0?test-tag=2129" class="ya-partner__pic" target="_blank" title="rozetka.com.ua" style="width: 112px ! important; height: 90px ! important; background-image: url(&quot;//avatars-fast.yandex.net/get-direct/8oiGJ5wfJHstNEBjK6XoTg/y90&quot;) ! important;"></a></yatag><a href="http://an.yandex.ru/count/NdKZbdAOr6i40000ZhgPloy5XPSY39K2cm5kGxS2Am4pYBRJp101YQDXNhAOhA-zlfsSk1AMfs9roBh-NJ7aoIRBpmwc48gXBDtHlQAoP7Ig0QMbJDG1aRWVMzSDZxGw4aaBdxwNjtu2auiBcJb2Z91g6A2GdoIla6eOb9yr1wURO06efNYbXQJ00000_06iCQx-3DynR5KzyWIn0RA84xcSk1Ax_ibeXf5wgi82UXG0?test-tag=2129" class="ya-partner__title-link" title="rozetka.com.ua" target="_blank"><yatag class="ya-partner__title-link-text">Какой GPS-навигатор выбрать?</yatag></a> <yatag class="ya-partner__text">Выбирайте в интернет-магазине Розетка! Мировые бренды. От 534 грн. Доставка</yatag><yatag class="ya-partner__url"><yatag class="ya-partner__domain"><a class="ya-partner__domain-link" href="http://an.yandex.ru/count/NdKZbdAOr6i40000ZhgPloy5XPSY39K2cm5kGxS2Am4pYBRJp101YQDXNhAOhA-zlfsSk1AMfs9roBh-NJ7aoIRBpmwc48gXBDtHlQAoP7Ig0QMbJDG1aRWVMzSDZxGw4aaBdxwNjtu2auiBcJb2Z91g6A2GdoIla6eOb9yr1wURO06efNYbXQJ00000_06iCQx-3DynR5KzyWIn0RA84xcSk1Ax_ibeXf5wgi82UXG0?test-tag=2129" target="_blank">rozetka.com.ua</a></yatag> <yatag class="ya-partner__region"></yatag></yatag><yatag class="ya-partner__clearfix"></yatag></td><td class="ya-partner__gap">&nbsp;</td><td class="ya-partner__item ya-partner__item-4 ya-partner__item_sitelinks_no ya-partner__item_pos_last"><a href="http://an.yandex.ru/count/NdKZbYg-dVO40000ZhgPloy5XPSY39K2cm5kGxS2Am4qYBqn8Ne6YRgN6bi1c5YTeYj14PQdOdN8klvTCUJ99ilF3gPlYge0ETYzju2w506g0QMjnD42aRWVMzSDZxzY-GOFdxvB82a8auiBcNj2Z93KCA2Gr32laDGmb9NR2wU4YAYWfUf7fC00003y0QmnhluCtp5iLJto1B41ieWHkQ8hGH6x_ibeXf5wgi82UXG0?test-tag=2129" class="ya-partner__title-link" title="grouptravel.ua" target="_blank"><yatag class="ya-partner__title-link-text">Туры в&nbsp;Турцию со&nbsp;скидкой до&nbsp;50%</yatag></a> <yatag class="ya-partner__text">Заявка на&nbsp;подбор тура в&nbsp;Турцию со&nbsp;скидкой до&nbsp;50%. Индивидуальный подход!</yatag><yatag class="ya-partner__url"><yatag class="ya-partner__domain"><a class="ya-partner__domain-link" href="http://an.yandex.ru/count/NdKZbYg-dVO40000ZhgPloy5XPSY39K2cm5kGxS2Am4qYBqn8Ne6YRgN6bi1c5YTeYj14PQdOdN8klvTCUJ99ilF3gPlYge0ETYzju2w506g0QMjnD42aRWVMzSDZxzY-GOFdxvB82a8auiBcNj2Z93KCA2Gr32laDGmb9NR2wU4YAYWfUf7fC00003y0QmnhluCtp5iLJto1B41ieWHkQ8hGH6x_ibeXf5wgi82UXG0?test-tag=2129" target="_blank">grouptravel.ua</a></yatag> <yatag class="ya-partner__region"></yatag></yatag></td></tr></tbody></table></yatag></div></div><script type="text/javascript" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/context_static_r669.js" yandex_load_check="yes"></script><script type="text/javascript" charset="utf-8" src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/49703.js"></script>


					<div class="entry-utility">
						Запись опубликована в рубрике <a href="http://easyelectronics.ru/category/avr-uchebnyj-kurs" title="Просмотреть все записи в рубрике «AVR. Учебный курс»" rel="category tag">AVR. Учебный курс</a> с метками <a href="http://easyelectronics.ru/tag/avr" rel="tag">AVR</a>, <a href="http://easyelectronics.ru/tag/i2c" rel="tag">i2c</a>, <a href="http://easyelectronics.ru/tag/iic" rel="tag">IIC</a>, <a href="http://easyelectronics.ru/tag/pinboard" rel="tag">PinBoard</a>, <a href="http://easyelectronics.ru/tag/twi" rel="tag">TWI</a>. Добавьте в закладки <a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html" title="Постоянная ссылка: AVR. Учебный Курс. Использование AVR TWI для работы с шиной IIC (i2c)" rel="bookmark">постоянную ссылку</a>.											</div><!-- .entry-utility -->
				</div><!-- #post-## -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://easyelectronics.ru/ispolzovanie-interfejsa-usi-v-rezhime-mastera-twi.html" rel="prev"><span class="meta-nav">←</span> Использование интерфейса USI  в режиме мастера TWI</a></div>
					<div class="nav-next"><a href="http://easyelectronics.ru/pereezd.html" rel="next">Переезд <span class="meta-nav">→</span></a></div>
				</div><!-- #nav-below -->

				
			<div id="comments">


			<h3 id="comments-title">130 комментариев: <em>AVR. Учебный Курс. Использование AVR TWI для работы с шиной IIC (i2c)</em></h3>


			<ol class="commentlist">
					<li class="comment byuser comment-author-bigleha even thread-even depth-1" id="li-comment-23802">
		<div id="comment-23802">
		<div class="comment-author vcard">
						<cite class="fn">BigLeha</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23802">
			24 Ноябрь 2010 в 6:40</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Очень много букав. Не осилил с первого 
раза. Но статья, без сомнения, полезная. Как раз думал о связке двух 
контроллеров между собой… Решал между SPI и IIC. Надо будет потом 
подробнее покурить что здесь написано…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-madmazy odd alt depth-2" id="li-comment-23814">
		<div id="comment-23814">
		<div class="comment-author vcard">
						<cite class="fn"><a href="http://www.alcoride.ru/" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://www.alcoride.ru']);" rel="external nofollow" class="url">madmazy</a></cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23814">
			24 Ноябрь 2010 в 14:30</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Я бы рекомендовал SPI — скорость выше, и работа с ним до безобразия тупа:) ничего сложного.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-3" id="li-comment-23817">
		<div id="comment-23817">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23817">
			24 Ноябрь 2010 в 15:08</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Адресации там нет. Десяток устройств не навешаешь.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-madmazy odd alt depth-4" id="li-comment-23820">
		<div id="comment-23820">
		<div class="comment-author vcard">
						<cite class="fn"><a href="http://www.alcoride.ru/" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://www.alcoride.ru']);" rel="external nofollow" class="url">madmazy</a></cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23820">
			24 Ноябрь 2010 в 16:11</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ди, ну, во-первых, речь шла о двух контроллерах.<br>
Во-вторых, если есть возможность сделать звезду по сигналу CS то почему бы и нет?<br>
Я, правда, больше четырех не вешал. W5100, оперативка, флешка и часы реального времени.</p>
<p>Спасибо за статью, надо, конечно, и с I2C разбираться…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-swg even depth-4" id="li-comment-23828">
		<div id="comment-23828">
		<div class="comment-author vcard">
						<cite class="fn">SWG</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23828">
			25 Ноябрь 2010 в 4:02</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Есть у SPI аппаратная адресация — линиями
 /SS. Требует, правда, по одной линии на каждого ведомого. Но их можно 
пустить через дешифратор: 3 — до 7, 4 — до 15 устройств. SPI все же для 
межконтроллерного обмена намного удобнее и компактнее, чем I2C, я пока 
от I2C решил воздержаться для этого. Правда, со SPI несколько 
усложняется использование, когда мастер должен не передавать, а читать с
 ведомого больше чем 1 байт. Приходится или давать задержку на время 
заведомо большее, чем пока ведомый положит в буфер следующий байт, или 
каким-то образом опрашивать его готовность к отправке следующего байта 
(например, по отдельной линии готовности). Но все равно это намного 
проще и меньше грузит ведомый контроллер, чем реализация ведомого I2C. 
Пробовал уже…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-5" id="li-comment-23832">
		<div id="comment-23832">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23832">
			25 Ноябрь 2010 в 13:40</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>У Slave нагрузка на процессор для I2C 
вообще мизерная.  Надо всего лишь отработать одно прерывание раз в байт.
 А дальше автомат все сделает сам, аппаратно. Это грузит проц не сильней
 чем UART или SPI. Не знаю как на PIC, но на AVR аппаратный TWI Slave 
это такая халява, как оказалось.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-swg even depth-6" id="li-comment-23833">
		<div id="comment-23833">
		<div class="comment-author vcard">
						<cite class="fn">SWG</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23833">
			25 Ноябрь 2010 в 15:06</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Я, правда, глубоко не копал, но когда 
начал просматривать даташиты по реализации I2C на PIC, то сложилось 
впечатление, что аппаратная поддержка слэва довольно слабая. Приходится 
отслеживать почти любое событие, проверять каждый байт. Мастер — тот 
более-менее полный. И везде в примерах в основном дается работа мастера с
 периферией — часами, памятью, и прочими. Для слэва примеров даже не 
нашел. И в том же МикроПаскале библиотеки только для мастера. Для слэва 
даже инициализации в библиотеке нет, надо самому биты по регистрам 
распихивать, и обработку приема фактически на асме писать, со всеми 
проверками и подтверждениями. Поэтому и сложилось у меня мнение о 
сложности реализации слэва и большой нагрузке на контроллер при его 
использовании. В отличие от I2C, со SPI — при пересылке одного байта — 
вообще без проблем, чисто аппаратно, как и с USART, вот правда чтение 
нескольких байт мастером со слэва — немного сложнее, из за определения 
готовности следующего байта к отправке, но в простейшем случае легко 
решаемо вводом пауз между байтами, гарантирующими готовность слэва. 
Пробовал и с отдельной линией проверки готовности, но особого выигрыша 
по времени не получил. При тактовой 16мгц и тактировании SPI 1 МГц 
(максимально можно до 4МГц) байт уходит за 8 мкс, процессор за это время
 успевает обработать до 32 команд, так что все довольно быстро. На I2C 
типичная частота — 100КГц, максимальная по стандарту — 400КГц, так что 
не быстрее, чем SPI. Тем более что по SPI нет заголовка (адреса и вида 
операции), а также подтверждения. В Атмелах тоже пока I2C глубоко не 
копал, сейчас понемногу разбираюсь с периферией Меги 128, попутно 
посмотрю, что у нее с I2C, но все же для межконтроллерного 
взаимодействия наверно буду использовать SPI.<br>
 Альтернатива — USART по одному проводу, с обьединением приема с 
передачей, в мультимастерном режиме с адресацией. Тем более, что в Меге 
128 — 2 USART (один мне нужен для радиоканала), и в остальных 
контроллерах моего робота — ходовом, бамперов и башни — USART тоже есть.
 Там вообще все просто и давно известно…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-7" id="li-comment-23837">
		<div id="comment-23837">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23837">
			25 Ноябрь 2010 в 18:39</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>У атмелей есть два вида i2c первый это 
TWI — полноценная поддержка на аппаратном уровне. ВТорой USI — т.е. 
нечто полуфабрикатное, которое умеет ловить только старты/стопы, да 
имеет буффер сдвига. А вся адресация и ACK/NACK делается на программном 
уровне. Может у PIC подобие USI? И еще такой момент. У Тини ЕМНИП, 
поголовно используется USI а вот в Мега уже идет TWI. Ты же, как я 
помню, использовал что то малоногое, может эт аналог тини только от 
микрочипа и i2c интерфейс у него ущербный. </p>
<p>По поводу готовности слейва… а в чем проблема? Боишься что прерывание не успеешь обработать? </p>
<p>В этом, кстати, и плюс i2c там есть мало мальская система контроля 
данных. Если слейв вдруг не сообщил ACK когда должен был, то это повод 
повторить посылку. </p>
<p>Ну а скорость нам особо не важна. Мы же не данные гигабайтами гоняем. Мне бы и 10кГц за глаза хватило бы.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-bigleha even depth-3" id="li-comment-23821">
		<div id="comment-23821">
		<div class="comment-author vcard">
						<cite class="fn">BigLeha</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23821">
			24 Ноябрь 2010 в 17:24</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Да скорости особо не надо. Один 
контроллер рулит индикатором, другой — главный. Периодически главный 
посылает байты для вывода на индикатор. Ну с SPI понятно вроде что да 
как. Осталось только написанное тут собраться и почитать.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-sergeydon odd alt depth-3" id="li-comment-23831">
		<div id="comment-23831">
		<div class="comment-author vcard">
						<cite class="fn">SergeyDon</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23831">
			25 Ноябрь 2010 в 11:49</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>кто нибудь может сделать краткий экскурс (типа обзор) интерфейсов: I2C, SPI, TWI и т.п.<br>
достоинства, недостатки когда какой и где лучше использовать? а то вроде
 все более менее понятно, а кокой и для какой задачи выбирать вопрос…</p>
<p>Понятно, что можно любой присобачить к своей задачи, но должны же быть и критерии выбора :) («ОКА» — тоже машина)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-4" id="li-comment-24829">
		<div id="comment-24829">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-24829">
			3 Январь 2011 в 8:02</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>I2C он же TWI это когда у нас гроздья 
устройств на плате, все на одной шине. А Обмен не слишком критичен к 
скорости и задержкам. Когда нужна многомастерная система с обработкой 
коллизий. </p>
<p>SPI это ОЧЕНЬ быстрый обмен между двумя устройствами (фактически 
ограничивается только разводкой платы и скоростью работы 
приемника/передатчика. Т.е. там можно и гигабит устроить). Часто 
используется для работы с памятью, той же флешей.  Но для адресации спи 
устройств нужен отдельный провод. Так что три провода интерфейса и один 
адресации. А мастер похож на спрута, у которого щупальца к каждому 
слейву индивидуально идет.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-andrew_freeman odd alt thread-odd thread-alt depth-1" id="li-comment-23803">
		<div id="comment-23803">
		<div class="comment-author vcard">
						<cite class="fn">andrew_freeman</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23803">
			24 Ноябрь 2010 в 10:22</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Просто окуеть! О_О Надеюсь это не шутки ради, а по заказу?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-23804">
		<div id="comment-23804">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23804">
			24 Ноябрь 2010 в 11:40</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Вообще Just for Lulz :)  Просто мне тут 
пришли клевые цифроые компасы, а они i2c шные ну  и я под них 
инструментарий себе завел. Заодно читателей решил побаловать :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-ultrin odd alt depth-3" id="li-comment-23844">
		<div id="comment-23844">
		<div class="comment-author vcard">
						<cite class="fn">Ultrin</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23844">
			25 Ноябрь 2010 в 21:06</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ди. а можно поподробнее, что за звери такие эти компасы? И какие именно?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-4" id="li-comment-23845">
		<div id="comment-23845">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23845">
			25 Ноябрь 2010 в 21:17</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>LSM303DLH</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-serega_mak odd alt thread-even depth-1" id="li-comment-23805">
		<div id="comment-23805">
		<div class="comment-author vcard">
						<cite class="fn">bomond</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23805">
			24 Ноябрь 2010 в 13:06</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Компасы к терминатору будешь лепить?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-23816">
		<div id="comment-23816">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23816">
			24 Ноябрь 2010 в 15:08</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ага</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-httpteh-anonlivejournalcom odd alt thread-odd thread-alt depth-1" id="li-comment-23807">
		<div id="comment-23807">
		<div class="comment-author vcard">
						<cite class="fn"><a href="http://teh-anon.livejournal.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://teh-anon.livejournal.com']);" rel="external nofollow" class="url">http://teh-anon.livejournal.com/</a></cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23807">
			24 Ноябрь 2010 в 13:32</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>[code]<br>
if (WorkIndex &lt; 99){				// Если лог не переполнен<br>
	WorkLog[WorkIndex] = (TWSR) ? TWSR : 0xFF;<br>
	WorkIndex++;<br>
}<br>
[/code]</p>
<p>щутка :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-httpteh-anonlivejournalcom even depth-2" id="li-comment-23808">
		<div id="comment-23808">
		<div class="comment-author vcard">
						<cite class="fn"><a href="http://teh-anon.livejournal.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://teh-anon.livejournal.com']);" rel="external nofollow" class="url">http://teh-anon.livejournal.com/</a></cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23808">
			24 Ноябрь 2010 в 13:34</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>я дурень :)</p>
<p>if (WorkIndex &lt; 99)	 // Если лог не переполнен<br>
    WorkLog[WorkIndex++] = (TWSR) ? TWSR : 0xFF;</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-3" id="li-comment-23818">
		<div id="comment-23818">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23818">
			24 Ноябрь 2010 в 15:09</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Точняк, забыл вообще про этот оператор.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-mars even thread-even depth-1" id="li-comment-23889">
		<div id="comment-23889">
		<div class="comment-author vcard">
						<cite class="fn">mars</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23889">
			26 Ноябрь 2010 в 23:53</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Спасибо за хорошую статью!<br>
Как раз во время, сейчас занимаюсь переходом с пика на авр.<br>
Есть устройство: выновсной пульт с индикатором и исполнительная плата.<br>
Они связаны между собой по и2с. По поводу реализации и2с слейва на пике,<br>
то он такойже простой если не проще. Сейчас слейв будет на меге а пульт останется<br>
на пике. Потом всё будет в двух вариантах и пики и меги. Будем смотреть на ситуацию<br>
с поставками и ценами на микроконтроллеры.<br>
И ещё пара слов в защиту и2с. У нас на пульт идут четыре провода питание
 земля данные и клок. При реализации на SPI нужно будет ещё пару 
проводов тащить (возврат данных и чипселект). У и2с, если захочешь ещё 
устройство подключить к шине, то просто подпаялся 4-мя проводами да в 
программе новый адрес прописал и всё. А у SPI нужно как минимум ещё одну
 ножку выделить под ещё один чипселект. И по поводу скоровти. В 
некоторых системах (например у нас) надёжность и помехоустойчивость 
гораздо важнее скорости, и тут и2с выигрывает.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-23890">
		<div id="comment-23890">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23890">
			26 Ноябрь 2010 в 23:58</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>По помехоустойчивости SPI  фору даст. 
Т.к. у SPI уровни жесткие, тогда как на i2c подтянутые. Ну и если девайс
 один, то чипселект не нужен вроде бы. Или у спи интеррупт возникает при
 чип селекте?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-mars even depth-3" id="li-comment-23891">
		<div id="comment-23891">
		<div class="comment-author vcard">
						<cite class="fn">mars</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23891">
			27 Ноябрь 2010 в 0:06</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Если мега стоит слейвом, то у SPI надо задействовать SS слейв селект.<br>
Всё таки спиай хорош на большой скорости, подключешь датафлешь и гоняешь
 байты туда-сюда на мегагерцах. Если правильно помню у меги максимум 
клок/2.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-4" id="li-comment-23892">
		<div id="comment-23892">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23892">
			27 Ноябрь 2010 в 0:18</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Я к тому, что слейву загнать припайкой ноги СС в режим «Всегда на стреме» и все. Не получится разве?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-mars even depth-5" id="li-comment-23893">
		<div id="comment-23893">
		<div class="comment-author vcard">
						<cite class="fn">mars</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-23893">
			27 Ноябрь 2010 в 0:58</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Да Вы правы, так получится. Только эта 
ножка ещё и ресетит всю спиайную логику и регистры приёма и передачи. Мы
 её использовали именно для этого.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-ostrov odd alt thread-odd thread-alt depth-1" id="li-comment-24877">
		<div id="comment-24877">
		<div class="comment-author vcard">
						<cite class="fn">ostrov</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-24877">
			3 Январь 2011 в 23:22</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>други посмотрите пожалуйста<br>
 <a href="http://easyelectronics.ru/repository.php?act=view&amp;id=37" rel="nofollow">http://easyelectronics.ru/repository.php?act=view&amp;id=37</a><br>
попытался аппаратно реализовать i2c на AVR(ифу брал отсюда <a href="http://www.radiohlam.ru/program/i2c_proc.htm" onclick="javascript:_gaq.push(['_trackEvent','outbound-comment','http://www.radiohlam.ru']);" rel="nofollow">http://www.radiohlam.ru/program/i2c_proc.htm</a>), пока только на отправку.</p>
<p>в правильном направлении двигаюсь или мрак полный)))))</p>
<p>и помойму нужно еще задержки ввести ведь у аврки команды выполняются большинство за один такт.</p>
<p>извиняюсь если не туда запостил,  Спасибо</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-24900">
		<div id="comment-24900">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-24900">
			4 Январь 2011 в 5:44</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ну это не аппаратно, а программно. Это раз. Во вторых выставка нуля на шину ииц должна быть<br>
как PORT = 0 DDR =1</p>
<p>Выставка 1 на шину  (она же свободное состояние)<br>
PORT = 1 DDR = 0</p>
<p>У тебя же какой то мрак. С этими дата нуль, дата адын, клок адын (это что за НЁХ?)</p>
<p>Старт условие и стоп условие должно быть с небольшой выдержкой. </p>
<p>Т.е. сда вниз<br>
пауза<br>
скл вниз. </p>
<p>Иначе слейв тебя может не понять, т.к. все будет слишком быстро.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-ostrov odd alt depth-3" id="li-comment-24910">
		<div id="comment-24910">
		<div class="comment-author vcard">
						<cite class="fn">ostrov</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-24910">
			4 Январь 2011 в 13:41</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>спасибо.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-dansar even thread-even depth-1" id="li-comment-25543">
		<div id="comment-25543">
		<div class="comment-author vcard">
						<cite class="fn">dansar</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-25543">
			24 Январь 2011 в 19:56</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p># 0×68 Receive SLA+W LP Мы были мастером,
 трепались с подчиненными по шине. И тут появляется на шине другой, 
более равный, мастер, перебивает нас и молвит “Уважаемый ХХ, а не 
возьмете ли вы вот эти байтики…” Чтож, он круче. Придется бросать 
передачу и брать его байты себе.</p>
<p>А чем определяется «крутость» мастера? Тем, что у него не выставлен 
бит TWEA? Мне просто интересно, вот мастер1 читает с памяти данные, а 
второму мастеру приспичило тоже что-то прочитать. Его блок TWI будет 
терпеливо ждать, когда на шине будет сгенерирован STOP?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-26549">
		<div id="comment-26549">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26549">
			26 Февраль 2011 в 23:07</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Крутость мастера определяется количеством
 яйцев (в смысле нулей) в его посылке. Тот у кого яиц больше, тот и 
круче. Простая логика шины на монтажном И.  </p>
<p>Так что если один мастер передает, а второй в этот момент тоже начнет
 передавать, то они будут передавать синхронно ровно до тех пор, пока у 
одного из мастеров на шину не вылезет ноль против единицы. Ноль 
однозначно давит шину и перебивает 1 и тот кто выставил 1 уходит с 
ошибкой арбитража, ожидая конца передачи и пробует снова. </p>
<p>Если один вещает, а второй засек, что шина вдруг занята, то он да, 
будет ждать пока на шине не выскочит стоп и она не освободится. Но если 
по какой то причине он этого не понял (начали строго синхронно в один 
миг, включился поздно и не поймал старт) то тут действует арбитраж и 
правило сильного нуля</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-jacek even thread-odd thread-alt depth-1" id="li-comment-26153">
		<div id="comment-26153">
		<div class="comment-author vcard">
						<cite class="fn">jacek</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26153">
			17 Февраль 2011 в 0:17</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>ДИ, подскажи пожалуйста.<br>
Тут принтер перестал внезапно печатать, по моему предположению, из-за 
переполнения счетчика количества страниц. Благо, счетчик реализован на 
обычной еепром 24ххх. Хочу считать содержимое, переписать байт-код и 
обратно отправить в еепром.<br>
SPI+UART на FTDI, поэтому PonyProg не катит, а Terminal выдаст 
информацию не в очень читабельном виде (в виде одного столбца 
шестнадцатеричных данных).<br>
Посоветуй пожалуйста прогу для чтения памяти через этот FTDI (возможно, что-то придумали для передачи данных по И2С на комп)<br>
Или, возможно, есть какая-то более удобная прога для чтения данных по 
UART с контроллера. Прошивку сделать, думаю, не составит труда для 
чтения еепром в контроллер, а потом — отсылка данных в комп.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-26154">
		<div id="comment-26154">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26154">
			17 Февраль 2011 в 0:18</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Я ни одной такой не знаю. Спроси у dcoder’a он что то вроде недавно скреативил на FTDI бегал у меня тут в аське, хвастался.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-jacek even thread-even depth-1" id="li-comment-26166">
		<div id="comment-26166">
		<div class="comment-author vcard">
						<cite class="fn">jacek</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26166">
			17 Февраль 2011 в 5:07</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>ДИ, а еще можно вопросик?<br>
После прерывания с идентификатором 0х40 надо<br>
а) переписывать содержимое twdr в регистр<br>
или<br>
б) просто отправить twint, twie, twen, а читать регистр уже после 0х50?</p>
<p>И еще: зачем мы ставим вручную флаг twint? Он же автоматически должен
 сам установиться сразу по какому-то событию (например, после прихода 
АСК). Или нет?<br>
Заранее спасибо.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-26175">
		<div id="comment-26175">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26175">
			17 Февраль 2011 в 15:17</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>После 40го там еще вроде бы твой адрес лежит. А Читать надо после приема байта уже. Т.е. после 50</p>
<p>Записью в twint 1 мы его стираем. Автоматом при переходе по вектору 
он не стирается. Если этого не сделать, то конечный автомат TWI не 
провернется дальше и следующего прерывания не будет.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-jacek even thread-odd thread-alt depth-1" id="li-comment-26200">
		<div id="comment-26200">
		<div class="comment-author vcard">
						<cite class="fn">jacek</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26200">
			18 Февраль 2011 в 2:28</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>М… опять вопрос. Скорость мастера для 
еепром надо 100кГц, а контроллер работает на 1МГц. Вычисляя по формуле 
из ДШ, получим отрицательное число. Это что значит: если тактовая 
частота 1МГц, то частоты 100кГц для чтения еепром не получить? Как 
поступить без прошивки фузи-битов?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-26202">
		<div id="comment-26202">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26202">
			18 Февраль 2011 в 2:34</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Не получить. Только частоты выше разгонять. Но зачем тебе 100кгц?  Еепром может работать хоть на 1гц :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-jacek even thread-even depth-1" id="li-comment-26534">
		<div id="comment-26534">
		<div class="comment-author vcard">
						<cite class="fn">jacek</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26534">
			25 Февраль 2011 в 23:08</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Я смотрю, только у меня популярна эта тема, и, кажется, мне опять придется задуматься над тем, чтоб «поставить автору пива» )))</p>
<p>Ди, вот не получается принять байты с указываемого адреса. Вот кусок кода</p>
<p>m_0x10:<br>
	send_SLA-R<br>
	reti<br>
m_0x40:<br>
	ldi temp, (1&lt;&lt;twen | 1&lt;&lt;twie | 1&lt;&lt;twint)<br>
	out twcr, temp<br>
	reti<br>
m_0x50:<br>
	in uart, twdr<br>
e:	sbis ucsra, udre<br>
	rjmp e<br>
	out udr, uart<br>
		cpi count, 0<br>
		breq nack<br>
		ldi temp, (1&lt;&lt;twen | 1&lt;&lt;twie | 0&lt;&lt;twsto | 1&lt;&lt;twint | 1&lt;&lt;twea)<br>
		out twcr, temp<br>
	dec count<br>
	reti<br>
nack:<br>
	ldi temp, (1&lt;&lt;twen | 1&lt;&lt;twie  | 0&lt;&lt;twsto | 1&lt;&lt;twint | 0&lt;&lt;twea)<br>
	out twcr, temp<br>
	reti</p>
<p>stop:<br>
	ldi temp, (1&lt;&lt;twen | 1&lt;&lt;twie  | 1&lt;&lt;twsto | 1&lt;&lt;twint  | 0&lt;&lt;twea)<br>
	out twcr, temp<br>
	ldi temp, 0b01011001 //отправить на комп ‘Y’ типа ‘ДА, УРА!’<br>
	out udr, temp<br>
	rjmp m2</p>
<p>Меня смущает логика прерывания с номером 0х40. Что тут надо делать? 
После передачи повторного старта сгенерировалось прерывание 0х10. По 
нему я отправил SLA-R. По приходу от слэйва АСК генерируется 0х40 (как я
 понял, байта с памяти еще не пришло в TWDR). По 0х40 я просто еще раз 
установил флаги TWINT, TWIE, TWEN и вышел из прерывания… И жду генерации
 0х50? Думаю, что это неверно. Как иначе надо?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-26536">
		<div id="comment-26536">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-26536">
			25 Февраль 2011 в 23:23</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Почему неверно? Дал повстарт, получил 10,
 дал запрос адреса на чтение получил 40 — адресат отозвался и готов 
слать данные. Дальше просто пинаешь конечный автомат, чтобы он сделал 
ищо одну итерацию и получаешь 50 на которых считываешь тот самый байт из
 твдр.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-esn22 even thread-odd thread-alt depth-1" id="li-comment-27360">
		<div id="comment-27360">
		<div class="comment-author vcard">
						<cite class="fn">ESN22</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-27360">
			3 Апрель 2011 в 16:20</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>DI HALT, что ты понимаешь под выражением «конечный автомат»?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-27368">
		<div id="comment-27368">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-27368">
			3 Апрель 2011 в 19:42</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Конечный автомат это функция которая 
помнит свое состояние и при следующем входе в нее делает следующее 
действие исходя из запомненного состояния. Простейший пример конечного 
автомата — авторучка с кнопкой. </p>
<p>У нас есть один лишь вызов функции — нажать кнопку. Но в зависимости от состояния стержень либо вылезет либо спрячется.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-flame1208 even thread-even depth-1" id="li-comment-28299">
		<div id="comment-28299">
		<div class="comment-author vcard">
						<cite class="fn">flame1208</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28299">
			1 Июнь 2011 в 14:32</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Здравствуйте, уважаемый DI HALT! Помогите
 разобраться, плиз. Не записывается единичка в в седьмой бит регистра 
TWCR. После выполнения команд:<br>
ldi Temp,(1&lt;&lt;TWSTA)|(0&lt;&lt;TWSTO)|(1&lt;&lt;TWINT)|(1&lt;&lt;TWEN)|(1&lt;&lt;TWIE)<br>
out TWCR,Temp<br>
в отладчике в TWCR получается значение 0b00100101, т.е. устанавливаются 
все нужные биты, кроме TWINT. Естественно, ничего не работает. Что 
делать?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-28300">
		<div id="comment-28300">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28300">
			1 Июнь 2011 в 15:51</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>А в отладчике ты ее и не увидишь. Т.е. 
она «устанавливается» и на этом же такте сбрасывается, чтобы прога не 
восприняла ее как 1 т.е. как новое прерывание. Дальше только ждать 
прерывание.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-tpyxa even thread-odd thread-alt depth-1" id="li-comment-28570">
		<div id="comment-28570">
		<div class="comment-author vcard">
						<cite class="fn">Tpyxa</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28570">
			23 Июнь 2011 в 9:16</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Вопросик. Изучаю i2c по апноутам (AVR315)
 — все работает(правда немного странно), но очень малый функционал. Ваш 
вариант мне нравится гораздо больше, т.к. более универсален. Переделал 
его под CVAVR без использования вашей ОС. И что-то даже простая запись 1
 байта в ЕЕПРОМ неработает вообще. По логам вылезает только 01(старт) и 
08 (поймали старт в прерывании) и все, тишина, больше мы в прерывание 
непопадаем. В чем может быть проблема?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-28573">
		<div id="comment-28573">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28573">
			23 Июнь 2011 в 10:54</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Какой нахрен 01?  Нет такого кода. У тебя после инициализации и первого щелчка должен быть 08 после чего шлешь адрес девайса.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-tpyxa even depth-3" id="li-comment-28574">
		<div id="comment-28574">
		<div class="comment-author vcard">
						<cite class="fn">Tpyxa</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28574">
			23 Июнь 2011 в 11:04</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ну сам же писал:<br>
WorkIndex=0;               	// Лог с начала<br>
WorkLog[WorkIndex]=1;         	// Записываем метку старта<br>
WorkIndex++;</p>
<p>Я просто раскомментировал. :)<br>
Пробовал между 2х контроллеров:<br>
на мастере тоже самое 08 и тишина<br>
А на Слейве выдает 00 — Бас Фейл. Не пойму в чем проблема.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-4" id="li-comment-28577">
		<div id="comment-28577">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28577">
			23 Июнь 2011 в 11:25</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Т.е. отправляет адрес, но прерывание не 
генерится? А ты его вообще разрешил? Его же каждый раз надо разрешать. 
Ну и осциллографом на состояние шины смотреть. Без лог анализатора или 
осцила отлаживать i2c шину  сущий геморрой.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-tpyxa even depth-5" id="li-comment-28578">
		<div id="comment-28578">
		<div class="comment-author vcard">
						<cite class="fn">Tpyxa</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28578">
			23 Июнь 2011 в 11:34</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>К сожалению ни осцилографа, ни 
анализотора нет, разве что к звуковухе прикрутить, но боюсь у нее 
частоты дискретизации не хватит, да и программные осциллографы убогие.</p>
<p>Если посылаю на ЕЕПРОМ, то на 08 все кончается. Больше прерывания не генеряться.<br>
Если на Слейв-Контроллер, то после 08 идет 48 и посылка останавливается 
(я делаю однократную попытку, без повтора — повторяю кнопкой резет на 
МК)<br>
На слейве же в этот момент идет прерывание с 00 — Bus Fail</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-orienta odd alt depth-6" id="li-comment-31140">
		<div id="comment-31140">
		<div class="comment-author vcard">
						<cite class="fn">Orienta</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31140">
			2 Декабрь 2011 в 13:39</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Я бы посоветовала скомпилировать без оптимизации</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-tpyxa even depth-3" id="li-comment-28575">
		<div id="comment-28575">
		<div class="comment-author vcard">
						<cite class="fn">Tpyxa</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28575">
			23 Июнь 2011 в 11:07</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Кстати. мне кажется или в описании твоей функции<br>
void SendByteToSlave(void)<br>
после строки 5 должен быть return? Иначе код далее выполняется вне зависимости от занятости шины.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-4" id="li-comment-28576">
		<div id="comment-28576">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28576">
			23 Июнь 2011 в 11:23</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Да там должен быть return</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-strauss even thread-even depth-1" id="li-comment-28943">
		<div id="comment-28943">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28943">
			27 Июль 2011 в 12:40</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Добрый день.<br>
Благодарю за работу — действительно в инете практически нет описания 
полноценной реализации i2c. Так что ваша статья как нельзя — вовремя и 
кстати.</p>
<p>Вопрос такой: А реализован ли в этом коде арбитраж для случая, когда 
наш контроллер посылает кому-то данные, а другой мастер при этом 
начинает слать нашему контроллеру данные? Подхватит ли наш контроллер 
данные в этом случае, или просто заткнётся на время?<br>
Моделировалась ли такая ситуация в реале?</p>
<p>П.С. А так — код замечательно работает на Codevision 1.x после соответствующей модификации.<br>
П.П.С. От себя могу порекомендовать:<br>
1) вместо char i2c_Buffer[i2c_Buffer_Size] использовать char *i2c_Buffer;<br>
2) Добавить char i2c_MiniBuffer[i2c_Buffer_Size]<br>
3) В процедуре инициализации добавить строчку i2c_Buffer=&amp;i2c_MiniBuffer;<br>
В коде нигде нет анализа максимума буфера, так что i2c_Buffer_Size делать переменной нет смысла.<br>
Причина такого изменения — у меня необходимость писать блоки данных по 
32 байта (а лучше — 64 байта… Кто не в курсе — еепромка пишет с 
одинаковой скоростью как 1 так и целый блок из 64 байтов). Причём эти 
данные приходят по USART по Wake протоколу и уже лежат в буфере, поэтому
 заводить ещё один отдельный буфер из 64 байт для i2c — так свободной 
ОЗУ не напасёшься… При этом обеспечивается обратная совместимость с 
предложенным автором кодом. Соответственно перед записью в память я 
настраиваю указатель на готовый буфер, а по окончанию — возвращаю 
обратно на минибуфер.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-28944">
		<div id="comment-28944">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28944">
			27 Июль 2011 в 13:25</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Смотря кто выйграет арбитраж. Если мы 
проиграем его, то получим свой адрес и перейдем в слейв. Если выйграем 
то будем слать дальше. За потерю арбитража отвечает 38 код. </p>
<p>Код там такой:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #b1b100;">case</span> <span style="color: #208080;">0x38</span><span style="color: #339933;">:</span>	<span style="color: #666666; font-style: italic;">//  Коллизия на шине. Нашелся кто то поглавней</span>
			<span style="color: #009900;">{</span>
			i2c_Do <span style="color: #339933;">|=</span> i2c_ERR_LP<span style="color: #339933;">;</span>						<span style="color: #666666; font-style: italic;">// Ставим ошибку потери приоритета</span>
&nbsp;
			<span style="color: #666666; font-style: italic;">// Настраиваем индексы заново. </span>
			i2c_index <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
			i2c_PageAddrIndex <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
			TWCR <span style="color: #339933;">=</span> 	<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span>
					<span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span>
					<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span>
					i2c_i_am_slave<span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span>
					<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span>
					<span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>							<span style="color: #666666; font-style: italic;">// Как только шина будет свободна </span>
			<span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>										<span style="color: #666666; font-style: italic;">// попробуем передать снова.</span>
			<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Как видишь, нет события выхода. Я видимо его забыл вставить. Но ничего не мешает добавить туда строчку</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
</pre></td><td class="code"><pre class="c" style="font-family:monospace;">MACRO_i2c_WhatDo_MasterOut	<span style="color: #666666; font-style: italic;">// Отрабатываем событие выхода</span></pre></td></tr></tbody></table></div>

<p>И уже в MasterOut задать обработку флага потери приоритета как нам угодно.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-strauss even depth-3" id="li-comment-28979">
		<div id="comment-28979">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28979">
			28 Июль 2011 в 22:30</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>&gt;Если мы проиграем его, то получим свой адрес и перейдем в слейв.<br>
Т.е. контроллер перейдёт в режим слейва и удачно примет данные 
(аппаратно восстановив ту часть адреса, которую слал мастер до потери 
арбитража) как будто бы он и не пытался вовсе слать данные, а всё время 
сидел в режиме слейва?<br>
Или он просто перейдёт в режим слейва или будет ждать следующего пакета адреса (удачно «пропустив мимо ушей» текущий пакет)?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-4" id="li-comment-28981">
		<div id="comment-28981">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28981">
			28 Июль 2011 в 23:10</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Нет по окончании работы слейва он 
повторно станет мастером, сгенерирует старт (аппаратная фишка)  и заново
 отошлет адрес на шину. Т.е. повторит все с нуля. Нельзя вот так взять и
 продолжить обмен.  У меня нет никаких пакетов, есть только буфер и 
адрес. В данном случае мастер просто повторит прерваную посылку отослав 
по текущему адресу текущий буфер.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-4" id="li-comment-28985">
		<div id="comment-28985">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28985">
			28 Июль 2011 в 23:39</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Т.е. мы начали что то слать, тут другой 
мастер на шине обратился одновременно к нам. Пока наши биты выставляемые
 на шину совпадают все ок. Как только он выставил ноль против нашей 
единицы — он однозначно выигрывает арбитраж, НАШ байт искажается, но это
 уже не имеет значения, т.к. наша передача уже прерывана и мы бросаемся 
принимать данные (если словили наш адрес) либо затыкаемся и уходим на 
круг ожидания если адрес не наш. </p>
<p>Т.е. нет нужды восстанавливать адрес. Адрес победитель не искажается 
(потому они и победитель), а судьба побежденного никого уже не волнует.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-28945">
		<div id="comment-28945">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28945">
			27 Июль 2011 в 13:31</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ну или использовать MACRO_i2c_WhatDo_ErrorOut выход на спец функцию обработки коллизий. Должно работать. </p>
<p>Размер буфера сделан переменной чтобы можно было работать с разными 
девайсами в одной программе, которые требуют разный обьем передаваемых 
данных. </p>
<p>Ну и буферы по хорошему действительно надо передалать на указатели, 
так будет универсальней. Не придется держать его в памяти, а можно будет
 скормить ему любую последовательность байт из памяти. Но пока до этого 
руки не дойдут. Возникнет необходимость допилю.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-28948">
		<div id="comment-28948">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28948">
			27 Июль 2011 в 13:51</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>А вот, собственно</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #b1b100;">case</span> <span style="color: #208080;">0xC0</span><span style="color: #339933;">:</span> <span style="color: #666666; font-style: italic;">// Мы выслали последний байт, больше у нас нет, получили NACK</span>
	<span style="color: #b1b100;">case</span> <span style="color: #208080;">0xC8</span><span style="color: #339933;">:</span> <span style="color: #666666; font-style: italic;">// или ACK. В данном случае нам пох. Т.к. больше байтов у нас нет.</span>
			<span style="color: #009900;">{</span>
			<span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>i2c_Do <span style="color: #339933;">&amp;</span> i2c_Interrupted<span style="color: #009900;">)</span>											<span style="color: #666666; font-style: italic;">// Если там была прерваная передача мастера</span>
				<span style="color: #009900;">{</span>																	<span style="color: #666666; font-style: italic;">// То мы ему ее вернем</span>
				i2c_Do <span style="color: #339933;">&amp;=</span> i2c_NoInterrupted<span style="color: #339933;">;</span>										<span style="color: #666666; font-style: italic;">// Снимем флаг прерваности</span>
				TWCR <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span><span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Сгенерим старт сразу же как получим шину.</span>
				<span style="color: #009900;">}</span>
			<span style="color: #b1b100;">else</span>
				<span style="color: #009900;">{</span>
				TWCR <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTA<span style="color: #339933;">|</span><span style="color: #0000dd;">0</span><span style="color: #339933;">&lt;&lt;</span>TWSTO<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWINT<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEA<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWEN<span style="color: #339933;">|</span><span style="color: #0000dd;">1</span><span style="color: #339933;">&lt;&lt;</span>TWIE<span style="color: #339933;">;</span>			<span style="color: #666666; font-style: italic;">// Если мы там одни, то просто отдадим шину</span>
				<span style="color: #009900;">}</span>
&nbsp;
			MACRO_i2c_WhatDo_SlaveOut												<span style="color: #666666; font-style: italic;">// И отработаем выход слейва. Впрочем, он тут</span>
																					<span style="color: #666666; font-style: italic;">// Не особо то нужен. Разве что как сигнал, что мастер</span>
			<span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>																	<span style="color: #666666; font-style: italic;">// Нас почтил своим визитом.</span>
			<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Тут проверяется флаг Interrupted и генерится снова старт. При 
следующем входе в прерывание попадаем опять в 0х10, где будет послан 
адрес (автоматом возьмется из той же переменной. Она же не изменилась. А
 далее будет 0х18 где есть бага :) Там бы добавить заново инициализацию 
i2c_index (а из стартовой функции ее вообще можно убрать)  т.к. она 
изменилась, мы ведь передали уже байты, а в стартовую процедуру запуска 
передачи уже не попадем. Автоматика без нас отработает.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-strauss odd alt thread-odd thread-alt depth-1" id="li-comment-28980">
		<div id="comment-28980">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28980">
			28 Июль 2011 в 23:04</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Есть одна очень паршивая грабля. Когда я 
по этой аналогии делал на контроллере циклический опрос и2ц термометра 
(период 1сек) и по протоколу wake общался с еепромкой, то некоторые 
операции с памятью могли просто не проходить. Самое печальное — это было
 с вероятностью менее 1% (что порой намного хуже, чем систематический 
глюк)<br>
Причём он проявлялся при загрузке контроллера ещё некоторыми 
параллельными задачами. (Т.е. если оставить только термометр и операции с
 памятью — всё ОК. Естественно если отключить опрос термометра — тоже 
всё замечательно. </p>
<p>Есть подозрение на этот участок кода (и ему подобные).<br>
u08 i2c_eep_ReadByte(u08 SAddr, u16 Addr, u08 ByteNumber, IIC_F WhatDo)<br>
{<br>
  if (i2c_Do &amp; i2c_Busy) return 0;	// Если шина занята<br>
    i2c_index = 0;				// Индексы в ноль<br>
    …<br>
    TWCR = 1&lt;&lt;TWSTA|0&lt;&lt;TWSTO|1&lt;&lt;TWINT|0&lt;&lt;TWEA|1&lt;&lt;TWEN|1&lt;&lt;TWIE;	//ПЦ!<br>
  i2c_Do |= i2c_Busy;			// Заняли шину, чтобы никто не мешал.<br>
return 1;				// Вернули 1, мол процесс пошел.<br>
}</p>
<p>Опасность состоит в том, что если между проверкой шины и её занятием 
заработает другая задача, которая тоже начнёт использовать эту или 
подобную процедуру, то<br>
это будет глюк. </p>
<p>Вопрос гарантируется ли атомарность этой операции (то, что выполнение
 этого куска кода не прервётся другой задачей в районе многоточия?) (По 
английски это ещё называют Re-entrance)<br>
(Я поверхностно проанализировал код диспетчера задач — вроде как одна 
задача не может быть прервана другой задачей, но во время выполнения 
задачи прерывания разрешены… Стало быть процедуру i2c_eep_ReadByte и 
подобного рода вызывать из прерывания — запрещено. Но я запрещал 
прерывания на время выполнения — не очень то помогло.)</p>
<p>Глюк вроде исчез, когда я сразу после  if (i2c_Do &amp; i2c_Busy) return 0;	//<br>
поставил  i2c_Do |= i2c_Busy но внутреннее чувство подсказывает, что это
 всего лишь снижение вероятности глюка, а не полное устранение. </p>
<p>П.С. Сорри за мутные разъяснения — просто когда 8 часов пытаешься выловить глюк — начинаешь верить в сверхестественные силы…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-28982">
		<div id="comment-28982">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28982">
			28 Июль 2011 в 23:17</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>На самом деле атомарности там нет :) Т.е.
 ее можно ввести запретив прерывания между анализом шины (т.е. от входа,
 еще до IF и до Return).  В этом случае ни диспетчер не сможет задачу 
перехватить (мой точно не сможет, он не вытесняющий, но может же быть и 
RTOS), ни прерывание.  </p>
<p>Ты прав, выставление флага занятости сразу же это  всего лишь снижение вероятности. </p>
<p>Или, лучше, сделать так:</p>
<p>u08 i2c_eep_ReadByte(u08 SAddr, u16 Addr, u08 ByteNumber, IIC_F WhatDo)<br>
 {<br>
cli();<br>
 if (i2c_Do &amp; i2c_Busy) { sei(); return 0;}// Если шина занята<br>
 i2c_Do |= i2c_Busy; // Заняли шину, чтобы никто не мешал.<br>
sei();</p>
<p> i2c_index = 0; // Индексы в ноль<br>
 …<br>
 TWCR = 1&lt;&lt;TWSTA|0&lt;&lt;TWSTO|1&lt;&lt;TWINT|0&lt;&lt;TWEA|1&lt;&lt;TWEN|1&lt;&lt;TWIE; //ПЦ!<br>
 return 1; // Вернули 1, мол процесс пошел.<br>
 }</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-3" id="li-comment-28983">
		<div id="comment-28983">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28983">
			28 Июль 2011 в 23:19</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Причем под cli и sei  имеется ввиду не 
тупой запрет/разрешение прерываний. А запрещение/восстановление I,  
чтобы не разрешить прерывания в прерываниях.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-strauss even depth-4" id="li-comment-28988">
		<div id="comment-28988">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28988">
			29 Июль 2011 в 0:27</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Да, я уже заметил… о сохранении состояния<br>
Кстати, немного отклоняясь от темы, почему используется конструкция (пишу по памяти…)<br>
{<br>
  char flag=0;<br>
  if (прерывания разрешены) flag=1;<br>
  cli();<br>
      …<br>
  if (flag) sei();<br>
}</p>
<p>вместо предложенной в даташите<br>
{<br>
  char oldsreg=SREG; //сохраним состояние прерываний<br>
  cli();<br>
      …<br>
  SREG=oldsreg;      //восстановим состояние прерываний<br>
}</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-5" id="li-comment-28990">
		<div id="comment-28990">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28990">
			29 Июль 2011 в 0:38</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Т.к. диспетчер портируется не только на 
AVR но и на многое другое. У STM32, например, такой фокус не пройдет. 
Там прерывания куда сложней. А так заменил макрос и вот оно уже работает
 на другой системе.  </p>
<p>Но вообще, тупо сохранить SREG, а потом его вернуть оптимальней и 
быстрей если речь идет о AVR. Кстати, даже в моем случае компилятор 
иногда так компилирует мой if  :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-strauss even depth-6" id="li-comment-29687">
		<div id="comment-29687">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29687">
			11 Сентябрь 2011 в 19:44</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>В таком случае предлагаю сделать что-то типа:<br>
<a href="http://easyelectronics.ru/repository.php?act=view&amp;id=61" rel="nofollow">http://easyelectronics.ru/repository.php?act=view&amp;id=61</a><br>
и молиться, чтобы компилятор откомпилировал в нечто подобное этому (на микрочиповском асме пишу ибо атмеловский ещё не ковырял):</p>
<p>mycli MACRO<br>
  cli<br>
  incf mycli_cnt<br>
ENDM  ; итого 2 такта</p>
<p>mysei MACRO<br>
  decf mycli_cnt<br>
  skpnz               ;пропустить команду если mycli_cnt не равно нулю<br>
  sei<br>
ENDM  ; итого 3 такта по любому</p>
<p>Естественно поместив mycli_cnt в соответствующий регистр</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-7" id="li-comment-29688">
		<div id="comment-29688">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29688">
			12 Сентябрь 2011 в 0:35</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>как вариант, но что ты будешь делать с irq и fiq в кортексе? :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-strauss even depth-8" id="li-comment-29691">
		<div id="comment-29691">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29691">
			12 Сентябрь 2011 в 12:15</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>примерно то же самое:</p>
<p>mycli()<br>
{<br>
  заблокировать прерывания<br>
  увеличить счётчик<br>
}</p>
<p>mysei()<br>
{<br>
  уменьшить счетчик<br>
  если равен нулю — разблокировать прерывания<br>
}</p>
<p>Всё-равно же HAL переписывать придётся. Так что шестью строчками больше или меньше — не особо заметно…</p>
<p>А вообще — к сожалению оптимизация программы очень часто действует 
против переносимости. Чем то из этого приходится жертвовать  :(. </p>
<p>Это, кстати — не моё изобретение. Эта фишка используется, к примеру, 
 в драйвере мыши под ДОС (int 33h, номера функций — не помню) или в 
Win32 процедурах GlobalLock и GlobalUnlock (это процедуры для работы с 
динамически выделяемой памятью).  Соответственно двукратный вызов одной 
из этих функций требует по окончанию двукратный вызов второй, чтобы 
вернуть всё так, как было прежде.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-9" id="li-comment-29694">
		<div id="comment-29694">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29694">
			12 Сентябрь 2011 в 13:09</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Просто там два уровня. И если например 
обычное прерывание может потребовать запрета, то какой нибудь FIQ в 
котором крутится диспетчер ОС и которой гарантированно не будет лезть в 
атомарность операций можно не запрещать.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-strauss even depth-10" id="li-comment-29701">
		<div id="comment-29701">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29701">
			12 Сентябрь 2011 в 18:49</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>стало быть для обоих уровней такую фишку сделать: cli,clifiq, sei,seifiq… и 2 счётчика соответственно.</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-28987">
		<div id="comment-28987">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28987">
			28 Июль 2011 в 23:46</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>По поводу глюка — в самом диспетчере (Как понял, ты юзаешь мой) тоже могут быть баги. :) </p>
<p>Один из недавно выловленых, но не исправленных еще на сайте — 
отсутствие атомарности в момент выбора адреса очереди задач. Т.е. может 
получится такая фигня, что одна задача начала ставить в очередь, выбрала
 адрес, уже готовится записать, тут из прерывания опа в этот же адрес 
внеслось, и на выходе идентификатор затирается и получаем пропуск 
задачи.  Посмотри внимательно код отвечающий за добавление задачи в 
очередь и заатомарь его от места выборки адреса и до внесения 
идентификатора в очередь.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-strauss even depth-3" id="li-comment-28989">
		<div id="comment-28989">
		<div class="comment-author vcard">
						<cite class="fn">Strauss</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-28989">
			29 Июль 2011 в 0:34</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Да, именно ваш. (только я его перевёл на 
Codevision 1.25). Жалко только, чтобы пошагово отладить процедуры в 
библиотеке приходится вытаскивать процедуру в основной модуль… иначе в 
симуляторе не возможно протрассировать её (Там только содержимое 
основного модуля показывается)</p>
<p>Спасибо, проверю. Ох уж эти потоко-безопасные операции… и на контроллере достали. :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-vadanat odd alt thread-even depth-1" id="li-comment-29851">
		<div id="comment-29851">
		<div class="comment-author vcard">
						<cite class="fn">vadanat</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29851">
			26 Сентябрь 2011 в 2:45</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Доброго времени суток, DI HALT.<br>
Спасибо за замечательную статью, очень просветлило.<br>
Подскажите: у меня есть задача — контроллер должен отвечать за несколько
 SLAVE-устройств и в зависимости от адреса выдавать данные. Возможно ли 
это при использовании вашей библиотеки?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-29859">
		<div id="comment-29859">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-29859">
			26 Сентябрь 2011 в 19:53</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Это не умеет SLAVE т.к. у него 
фиксированный адрес, записываемый перед инициализацией библиотеки и это 
аппаратная фича. Т.е. налету можно адрес сменить, но вот обращаться 
сразу по нескольким нельзя.  Вам проще будет вначале обратиться к 
слейву, потом пнуть ему внутренний адрес, а потом уже данные. Как идет 
обращение к микросхемам памяти. в таком виде.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-orienta odd alt thread-odd thread-alt depth-1" id="li-comment-31112">
		<div id="comment-31112">
		<div class="comment-author vcard">
						<cite class="fn">Orienta</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31112">
			30 Ноябрь 2011 в 17:27</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ой, мамочки… диалог мастера и слейва буду ребенку на ночь читать вместо сказок :-))))</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-igor-x even thread-even depth-1" id="li-comment-31370">
		<div id="comment-31370">
		<div class="comment-author vcard">
						<cite class="fn">igor-x</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31370">
			14 Декабрь 2011 в 15:42</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>а подскажите пож, два мастера могут обменяться информацией, или надо периодически переходить в слейв?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-31371">
		<div id="comment-31371">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31371">
			14 Декабрь 2011 в 15:46</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Нет конечно, только мастер-слейв. Иначе кто вожжу то дергать будет?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-igor-x even depth-3" id="li-comment-31372">
		<div id="comment-31372">
		<div class="comment-author vcard">
						<cite class="fn">igor-x</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31372">
			14 Декабрь 2011 в 16:06</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>а это нормальная картина- когда несколько
 МК постоянно превращаются в из мастера в слейв и наоборот? можно бы как
 вариант предложить одному МК постоянно опрашивать несколько слейвов, но
 тогда постоянно по шине будет обмен…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-4" id="li-comment-31373">
		<div id="comment-31373">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31373">
			14 Декабрь 2011 в 17:14</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>А почему нет? Есть что сказать — стал мастером, сказал. Нет сиди слейвом и жди когда вызовут.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-igor-x even depth-2" id="li-comment-31379">
		<div id="comment-31379">
		<div class="comment-author vcard">
						<cite class="fn">igor-x</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31379">
			15 Декабрь 2011 в 16:42</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>читата из статьи: «Причем во время работы
 мастера может произойти вызов его как слейва и тогда возникнет переход 
от одного обмена к другому.»</p>
<p>значит мастер тоже имеет свой адрес и к этому мастеру другой мастер может как особенным образом адресоваться?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-3" id="li-comment-31380">
		<div id="comment-31380">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31380">
			15 Декабрь 2011 в 16:57</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Мастер, если это задумано, может иметь свой Slave адрес.  Адресация к нему идет как к обычному слейву. </p>
<p>Master и Slave это не типы устройств на шине, это режим работы, 
мастер это тот кто дергает Clock.  Конечно немало чисто slave устройств,
 вроде памяти. Но более умные, такие как контроллеры, могут быть кем 
угодно. А в многомастерной шине принято, что все слейвы со своими 
адресами и только тот кому надо передать становится мастером.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-unknown even thread-odd thread-alt depth-1" id="li-comment-31382">
		<div id="comment-31382">
		<div class="comment-author vcard">
						<cite class="fn">unknown</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31382">
			15 Декабрь 2011 в 20:47</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Уважаемый DI HALT, вы не могли бы мне 
помочь разобраться с этим интерфейсом, ато что то у меня даже запустить 
его не получается((( а курсовой проект в субботу сдавать(((</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-31383">
		<div id="comment-31383">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31383">
			15 Декабрь 2011 в 20:47</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Не мог бы. Весь материал есть, курсовой вам задали тоже не вчера.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-unknown even depth-3" id="li-comment-31385">
		<div id="comment-31385">
		<div class="comment-author vcard">
						<cite class="fn">unknown</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31385">
			15 Декабрь 2011 в 21:11</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>тк и я, не первый день этим вожусь…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-4" id="li-comment-31386">
		<div id="comment-31386">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31386">
			15 Декабрь 2011 в 21:18</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>задавайте конкретные вопросы я на них отвечу. Смотреть код и говорить где там что не работает не буду, не до того сейчас.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-unknown even depth-5" id="li-comment-31387">
		<div id="comment-31387">
		<div class="comment-author vcard">
						<cite class="fn">unknown</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31387">
			15 Декабрь 2011 в 21:29</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>вот у меня не разу не получилось словить 
изменение регистра статуса TWSR в AVR Studio! У нет нет полной поддержки
 эмуляции интерфейса или же мне грешить на код?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-unknown odd alt depth-6" id="li-comment-31388">
		<div id="comment-31388">
		<div class="comment-author vcard">
						<cite class="fn">unknown</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31388">
			15 Декабрь 2011 в 21:30</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>У него нет полной поддержки эмуляции интерфейса или же мне грешить на код?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-7" id="li-comment-31389">
		<div id="comment-31389">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31389">
			15 Декабрь 2011 в 21:32</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>А где происходит эмуляция? насколько 
помню, AVRStudio эмулировать его не умеет, TWSR надо менять вручную. 
Насчет протеуса ХЗ. Там оно работает, но с ошибками. Такие вещи надо 
тестить в реальном железе. Выплевывать состояние TWSR в уарт и смотреть 
что к чему.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-unknown odd alt depth-8" id="li-comment-31390">
		<div id="comment-31390">
		<div class="comment-author vcard">
						<cite class="fn">unknown</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31390">
			15 Декабрь 2011 в 21:35</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>А в реальном железе, допустим при 
подключенной к МК ЖК дисплея, TWSR аппаратно меняется? или тоже в коде 
самому прописывать по состоянию ACK?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-arcanum7 even thread-even depth-1" id="li-comment-31439">
		<div id="comment-31439">
		<div class="comment-author vcard">
						<cite class="fn">Arcanum</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31439">
			19 Декабрь 2011 в 19:54</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>интересно а можно ли сделать вот так:<br>
void GetTime (void)<br>
{<br>
InBufferTx	(i2c_RTC_ReadByte(0xA1,0×01,1,&amp;DoNothing) );<br>
InBufferTx	(i2c_RTC_ReadByte(0xA1,0×02,1,&amp;DoNothing) );<br>
InBufferTx	(i2c_RTC_ReadByte(0xA1,0×03,1,&amp;DoNothing) );<br>
InBufferTx	(i2c_RTC_ReadByte(0xA1,0×04,1,&amp;DoNothing) );<br>
InBufferTx	(i2c_RTC_ReadByte(0xA1,0×05,1,&amp;DoNothing) );<br>
InBufferTx	(i2c_RTC_ReadByte(0xA1,0×06,1,&amp;DoNothing) );</p>
<p>}<br>
или каждый раз надо функцию чтения «заворачивать» в отдельную функцию как в примере?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-arcanum7 odd alt depth-2" id="li-comment-31440">
		<div id="comment-31440">
		<div class="comment-author vcard">
						<cite class="fn">Arcanum</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31440">
			19 Декабрь 2011 в 21:28</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>блииииин какую я спорол чушь! удалите коммент а то сгорю от стыда!<br>
пойду отсыпаться…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-igor-x even thread-odd thread-alt depth-1" id="li-comment-31504">
		<div id="comment-31504">
		<div class="comment-author vcard">
						<cite class="fn">igor-x</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31504">
			23 Декабрь 2011 в 14:29</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>а подскажите пож. по вопросу надежности ?<br>
в программе-примере я вижу работает WD, значит есь вероятнось зависания 
изза протокола I2C ? или же WD — всегда ставите на всякий случай</p>
<p>и еще по надежности — насколько необходимо передача с контрольными 
суммами или же сам протокол I2c обеспечивает достаточный контроль 
передаваемых данных?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-31505">
		<div id="comment-31505">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31505">
			23 Декабрь 2011 в 15:25</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>WD всегда у меня работает. Если нужна надежность, то нужна СРС сам проткол ничего вам не гарантирует.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-arcanum7 even thread-even depth-1" id="li-comment-31507">
		<div id="comment-31507">
		<div class="comment-author vcard">
						<cite class="fn">Arcanum</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31507">
			23 Декабрь 2011 в 23:17</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>можете пояснить зачем u08 перед:<br>
u08 i2c_eep_WriteByte(u08 SAddr,u16 Addr, u08 Byte, IIC_F WhatDo)</p>
<p>?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-31508">
		<div id="comment-31508">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31508">
			23 Декабрь 2011 в 23:23</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>это же тип передаваемых данных. Слейв адрес восьмибитный.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-arxangelrus even thread-odd thread-alt depth-1" id="li-comment-31555">
		<div id="comment-31555">
		<div class="comment-author vcard">
						<cite class="fn">ArxangelRUS</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31555">
			27 Декабрь 2011 в 23:17</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Вот и пришло время заюзать i2c микрухи от NPX :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-igor-x odd alt thread-even depth-1" id="li-comment-31600">
		<div id="comment-31600">
		<div class="comment-author vcard">
						<cite class="fn">igor-x</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-31600">
			3 Январь 2012 в 16:02</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>а подскажите пож. еще:<br>
мастер пытается сделать широковещательное сообщение:<br>
а ну ка девчонки примите 4 байт!</p>
<p>что получится в результате? — кто будет формировать АСК и буде ли по нему понятно — что все SLAVE приняли сообщение?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-al-x even depth-2" id="li-comment-32063">
		<div id="comment-32063">
		<div class="comment-author vcard">
						<cite class="fn">Al-x</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32063">
			14 Февраль 2012 в 18:32</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>100% не уверен, но если память не 
изменяет — АСК будут генерироваться всеми устройствами, и если какое-то 
из них не успело принять данные или произошла ошибка — оно не отпустит 
шину, т.е. будет держать её в низком состоянии и мастер это зафиксирует.
 Правда мои эксперименты показали, что не все ошибки шины легко 
распознать и возможны даже ситуации «зависания» (было на микросхеме 
RTC). Но в общем и целом шина не плохая — у меня так много МК связаны, а
 общая длина линии около 40 метров — и ничего, работает стабильно. 
Только вот crc и повтор отправки пришлось внедрять, т.к. изредка посылки
 приходят с ошибками в одном, двух байтах из 5-10.<br>
PS. я не извращенец, просто в то время, как я разрабатывал такую систему
 было проще взять меги, чем контроллеры с CAN. Если хотите строить 
серьёзную систему — используйте CAN.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-michail odd alt thread-odd thread-alt depth-1" id="li-comment-32659">
		<div id="comment-32659">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32659">
			6 Апрель 2012 в 11:16</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Добрый день.<br>
Столкнулся с той же проблемой, что была у Tpyxa 1.5 года назад. Собираю 
под AVR Studio 5.1, под ATmega8. Номера выводов поменял на нужные в 
IIC_ultimate.h. Чтение из EEPROM не работает.<br>
При симуляции в Proteus и включении диагностики TWI вижу в логах<br>
Enabled (TWEN=1)<br>
Prescaler=1 (TWPS=0), TWBR=32, TWI frequency set to 100000Hz<br>
TWSTA=1, Start initiated<br>
Initiating S<br>
Interrupt Enabled<br>
SDA negative edge<br>
S detected<br>
SCL negative edge<br>
после этого шины SDA и SCL ложатся в нулевой уровень и все.<br>
Может кто еще сталкивался, или сам Tpyxa объявится, расскажет как 
поборол, а то бьюсь второй день, но опыта мало, не знаю куда и копнуть 
еще.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-michail even depth-2" id="li-comment-32660">
		<div id="comment-32660">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32660">
			6 Апрель 2012 в 12:09</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ну вот, как всегда бывает, только спросишь совета — и сразу умные мысли сами приходят.<br>
Проблема оказалась не в I2C библиотеке, а в том, что я функцию 
ReadEEPROM вызывал до инициализации диспетчера, соответственно переделав
 в ней SetTimerTask(ReadEEPROM,50); на простой цикл с задержкой. Почему 
именно не работало пока не понял, но поменял в первоначальный вариант — 
поехало.<br>
Так что сам дурак оказался, всем спасибо! :)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-deadfish45 odd alt thread-even depth-1" id="li-comment-32711">
		<div id="comment-32711">
		<div class="comment-author vcard">
						<cite class="fn">deadfish45</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32711">
			9 Апрель 2012 в 0:49</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Если я сделаю</p>
<p>#define u08 unsigned char<br>
#include «IIC_ultimate.h»<br>
Никаких подводных камней не встречу?</p>
<p>ато у меня никаких  avrlibtypes.h    и  avrlibdefs.h нету</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-32712">
		<div id="comment-32712">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32712">
			9 Апрель 2012 в 0:55</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Да вроде нормально должно быть. Т.к. это чар и есть.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-michail odd alt thread-odd thread-alt depth-1" id="li-comment-32767">
		<div id="comment-32767">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32767">
			11 Апрель 2012 в 15:47</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Еще немного помучаю :)<br>
Используется в проекте 2 контроллера, один — в Arduino Uno (Atmega328p),
 другой — просто ATmega8. Связь по I2C. На первый все пишется под 
ArduinoIDE, на другой под AVR Studio 5.1 c обсуждаемой тут библиотекой 
I2C. Ну вот такой я извращенец :) Просто большая часть кода на ардуине 
уже была готова, может когда и переделаю все по уму.<br>
Ну и по делу. Сначала 8-ка мастером запрашивает у 328 свой адрес 
(SAWSrARP). Тут все проходит без проблем, адрес считывается и 8-ка с ним
 нормально инициализируется как Slave. После этого 328-й становится 
мастером и пытается передать 8-ке один байт (SAWP). Выдает старт, адрес,
 8-ка это все корректно принимает, а дальше начинаются чудеса. Судя по 
логам и временным диаграммам в Proteus 328 корректно передает дальше 
байт с данными, но 8-ка принимает его с запаздыванием в 1 бит. Т.е. 
например вместо 0х5А она принимает 0хB5 (последний бит принятых данных —
 это NAK от 328). И соответственно выставляет свой ACK когда ее уже 
никто и не слушает, и так и оставляет линию SDA в низком состоянии.<br>
При этом по логам ее состояния — 08 18 28 10 40 58 60 FF 00.<br>
Вот и не могу понять, откуда может происходить такой «рассинхрон» на 1 
бит? Или это Proteus глючит (до железа если только в выходные доберусь)?<br>
Если кому интересно — по ссылке на картинке логи передачи и временные диаграммы.<br>
<a href="http://photo.qip.ru/users/mrusinov.qipru/151149438/173894292/full_image/" onclick="javascript:_gaq.push(['_trackEvent','outbound-comment','http://photo.qip.ru']);" rel="nofollow">http://photo.qip.ru/users/mrusinov.qipru/151149438/173894292/full_image/</a></p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-michail even depth-2" id="li-comment-32848">
		<div id="comment-32848">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32848">
			17 Апрель 2012 в 14:52</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Чем дальше бьюсь головой об стену — тем 
все чудесатее и чудесатее. Сократил код у обоих до минимума — просто 328
 передает 1 байт на mega8, менял mega8 на mega16 — та же проблема. 
Где-то пропадает 1 такт. Код приемной стороны — один в один как у 
второго контроллера из примера, только убрано общение с EEPROM, скорость
 выставлена в 100кГц и включено логирование. После этого убрал 
логирование из прерывания — через раз начало нормально проходить. Начал 
увеличивать частоту у mega16. При частоте кристалла &gt; 16Mhz начинает 
работать все лучше и лучше, на 20MHz практически стабильно, один сбой на
 20 передач.<br>
К сожалению в выходные так и не добрался проверить в железе, поэтому 
варианты так и остались: либо глючит Proteus, либо скорости принимающей 
стороны почему-то не хватат. Ну или мои кривые руки, но когда 
моделировал работу той же Ардуины с mega328 в протеусе с разными другими
 модулями — все шло нормально…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-michail odd alt depth-3" id="li-comment-32879">
		<div id="comment-32879">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-32879">
			20 Апрель 2012 в 10:27</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Продолжу свой детективный монолог. Если вдруг утомил — только намекните :)<br>
Добрался вчера наконец проверить в железе. Так как ни осциллом ни 
анализатором пока не обзавелся, одна только цешка китайская, то сделал в
 лоб. Mega328 на 16 MHz всегда мастером, Mega8 на 8 MHz — slave. Шина 
I2C на 100 KHz. 328-я кидает один байт на 8-ю, затем запрашивает его 
обратно, выводит в терминал и дальше все по кругу. Каждый контроллер при
 этом увеличивает значение байтика на 1-ку.<br>
Вот что получилось. При запуске и отправке первого же байта все зависает
 и 8-ка ложит линию (правда в отличие от протеуса на этот раз SCL) в 
ноль. Начал играться с перезапуском 8-ки при работающей 328-й (просто 
выключал и включал питание). В 9 из 10 случаев при перезапуске 328-я 
успевает просунуть в линию очередной байт, затем на следующем 8-ка опять
 все ложит. Но в редких случаях удавалось включить 8-ю в какой-то 
удачный момент и начиналась нормальная передача в обе стороны. Проверял в
 течение получаса — ни одной потери или затыка. При этом 328-ю можно 
спокойно перезапускать без выключения 8-ки и после старта все продолжает
 работать с прерванного момента, но только перезапускаем 8-ку — опять 
грабли.<br>
Вот такие дела. Такое чувство, что какой-то инициализации у 8-ки не хватает. Пошел думать и курить даташиты дальше…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-rigormortis even thread-even depth-1" id="li-comment-33047">
		<div id="comment-33047">
		<div class="comment-author vcard">
						<cite class="fn">RigorMortis</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33047">
			8 Май 2012 в 13:51</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Добрый день<br>
Скачал исходники. Обнаружил пока что 3 ошибки. Автор еще поддерживает код?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-michail odd alt depth-2" id="li-comment-33048">
		<div id="comment-33048">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33048">
			8 Май 2012 в 13:57</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Что за ошибки? Здесь бы и озвучил, и людям (вроде меня) может поможет и автор глядишь доберется обновит.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-rigormortis even depth-3" id="li-comment-33081">
		<div id="comment-33081">
		<div class="comment-author vcard">
						<cite class="fn">RigorMortis</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33081">
			9 Май 2012 в 13:30</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Сначала хотелось бы пообщаться с автором. А то может это вовсе и не ошибки, а он так задумал. Хотя больше похоже на ошибки.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-rigormortis odd alt thread-odd thread-alt depth-1" id="li-comment-33082">
		<div id="comment-33082">
		<div class="comment-author vcard">
						<cite class="fn">RigorMortis</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33082">
			9 Май 2012 в 13:50</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Ладно, напишу тут. Авось автор доберется и опровергнет:<br>
1) строка 355: TWCR = 
0&lt;&lt;TWSTA|0&lt;&lt;TWSTO|1&lt;&lt;TWINT|1&lt;&lt;TWEA|0&lt;&lt;TWEN|1&lt;&lt;TWIE;
        // Если нет, то шлем и ждем ACK<br>
Зачем то запрещается работа TWI (0&lt;&lt;TWEN). Возможно тут есть какой то скрытый смысл, но похоже на опечатку.<br>
2) строка 301: case 0xA0: // Ой, мы получили Повторный старт. Но чо нам с ним делать?<br>
На самом деле это сигнал Стоп или Повторный старт и означает он конец пакета и обрабатывается соответственно.<br>
3) строка 285: i2c_InBuff[i2c_SlaveIndex] = TWDR;   // Сожрали его в буфер<br>
после этого i2c_SlaveIndex не увеличивается на 1, но есть подозрение что должен</p>
<p>Сделал еще много мелких исправлений и украшательств для читабельности
 кода, перенес логику отправки данных и освобождения шины в модуль 
IIC_ultimate.<br>
Спасибо автору!</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-33091">
		<div id="comment-33091">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33091">
			9 Май 2012 в 19:36</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>1) Да, это просто опечатка.<br>
2) Зависит от протокола. Далеко не все устройства работают пакетами. При нужде допиливается до нужного уровня самостоятельно.<br>
3) уже не помню, может увеличивается где то в другом месте. по крайней 
мере с многобайтными данными я работал, ничего не терялось. Но стоит 
проверить.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-michail odd alt depth-2" id="li-comment-33096">
		<div id="comment-33096">
		<div class="comment-author vcard">
						<cite class="fn">Michail</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33096">
			9 Май 2012 в 23:46</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>По пункту 2. Тоже с этим столкнулся когда
 в режиме Slave буфер настроен на прием 2-х байт, а мастер отдает только
 по одному. В этом случае в SlaveOutFunc мы никогда не попадаем и 
соответственно этих байт не видим. Тоже собирался обработчик стопа 
прикручивать.<br>
По остальным пунктам спасибо, надо посмотреть.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-rigormortis even depth-3" id="li-comment-33806">
		<div id="comment-33806">
		<div class="comment-author vcard">
						<cite class="fn">RigorMortis</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33806">
			18 Июль 2012 в 17:39</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Обнаружил еще один глюк: если мастером 
начата передача данных и уже послан Старт и после этого в режиме 
мультимастера приходит адрес контроллера, то возникает событие не 0×68 
(RCV SLA+W Low Priority), а 0×60 — как будто передача не была начата. В 
итоге пакет не передается, а просто теряется, хотя считается, что 
передача начата. События по понятной причине тоже не работают. Для 
исправления ввел проверку на текущий режим работы мастера и 
соответственно обнуление режима при завершении работы мастера, при 
переходе в режим слейва из режима мастера (не только по 0×68) при 
возможности заново начинаю передачу.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-austins odd alt depth-4" id="li-comment-36213">
		<div id="comment-36213">
		<div class="comment-author vcard">
						<cite class="fn">Austin</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-36213">
			15 Май 2013 в 18:57</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Выложите свой вариант кода пожалуйста</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-neon-f even thread-even depth-1" id="li-comment-33329">
		<div id="comment-33329">
		<div class="comment-author vcard">
						<cite class="fn"><a href="http://mdoga.ru/" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://MDOGA.RU']);" rel="external nofollow" class="url">neon-f</a></cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33329">
			25 Май 2012 в 16:19</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Вот и мне понадобилась I2C шина.  Решил использовать TWI  модуль.<br>
Буксанул на проверке кода статуса состояния модуля.  Он у меня почему то равен 0хF8.<br>
Что и как делаю:<br>
Вначале инициализация<br>
TWSR = 0b00;          //<br>
TWBR = 0x0a;          // задаю скорость работы модуля TWI<br>
TWCR|= 0b00000100;    // разрешаю работу модуля TWI<br>
Потом в основном цикле<br>
TWCR  |= 0×20;         //   СТАРТ<br>
TWCR  |= 0×40;         //   СБРОС TWINT  (приступить к выполнению)<br>
после этого смотрю чему равен    (TWSR &amp; 0b11111000),  он равен 0хF8 вместо ожидаемого 0х08<br>
В чем я ступил?</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-dorian-gray odd alt thread-odd thread-alt depth-1" id="li-comment-33452">
		<div id="comment-33452">
		<div class="comment-author vcard">
						<cite class="fn">Dorian Gray</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33452">
			4 Июнь 2012 в 15:26</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>у меня вопросик вот я юзал этот код, но 
вот в чем беда — все соеденил, в коде оставил только банальную запись 
байта и потом его чтение одним контроллером, данные с регистра TWSR 
выплевываю в УАРТ, и прочитанный байт тоже и сообствено в чем беда — 
записываю байт — все ок, микросхема все съела и довольна, а вот когда 
читаю байт, он не тот что должен быть … переделал немного библиотеку для
 ДС1307, и тоже попробывал считать/записать байт — и все ок, пишет и 
читает норм. Почему не читает норм с памяти ???!! промоделил в протеусе —
 там все пишет и читает норм=)</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-33460">
		<div id="comment-33460">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33460">
			5 Июнь 2012 в 8:57</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Причин много может быть. Вплоть до 
переполнения стека. Насуй в код отладочного вывода в буфер, а потом 
прогони всю последовательность. Выведешь буфер через уарт и увидишь на 
чем случился затык.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-dorian-gray odd alt depth-3" id="li-comment-33531">
		<div id="comment-33531">
		<div class="comment-author vcard">
						<cite class="fn">Dorian Gray</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33531">
			9 Июнь 2012 в 0:06</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>немножко не понял о чем речь ((( вот что у
 меня получилось — если память записывать так — А0, байт адреса, байт 
данных и так же считывать, то все считывается норм, как и в случае с 
часами … но вот когда подаю 2 байта ад-реса ячейки, то почему-то 
считывает какую-то ерунду =(</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-4" id="li-comment-33533">
		<div id="comment-33533">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33533">
			9 Июнь 2012 в 17:24</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>у и2с адрес однобайтный. Все что больше 
пишется через запись/чтение. Т.е. сначала по адресу епромки пишешь два 
байта (адрес считываемого байта), а потом делаешь повстарт и читаешь 
оттуда заказанный байт.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-dorian-gray odd alt depth-5" id="li-comment-33534">
		<div id="comment-33534">
		<div class="comment-author vcard">
						<cite class="fn">Dorian Gray</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33534">
			9 Июнь 2012 в 19:55</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>ах вот оно как, терь ясно хоть куда копать…ато две недели топчусь на одном месте( большое спасибо!</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
	<li class="comment byuser comment-author-dima_em even thread-even depth-1" id="li-comment-33812">
		<div id="comment-33812">
		<div class="comment-author vcard">
						<cite class="fn">Dima_Em</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33812">
			19 Июль 2012 в 10:31</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Здравствуйте. Вот пытаюсь освоить TWI(IIC) на RTOS и естественно возникают вопросы:<br>
1. В исходнике в ф-ии void Init_i2c(void) у вас настройка скорости TWI канала как я понял 244Гц<br>
TWBR = 0xFF;//256 — коэффициент деления частоты генератора скорости связи<br>
TWSR = 0×03;//Предделитель TWI 64<br>
. По datashed-у atmega32a посчитал по ф-ле f_scl=f_cpu/(16+2*TWBR*4^TWPS)<br>
8000000/(16+2*256*4^3)=244Гц = 1тик происходит каждые 4мс, а диспетчер крутит каждые 1мс, не будет ли накладок задач.<br>
2. Прерывание TWI вызывается каждый раз после отработки, настроек в 
TWCR? Тоест например сделали START свалились в прерывании, получили код 
0×08, сформировали в прерывании SLA+W вышли из него, получили или не 
получили адрес вывалились в прерывании с кодом  0х18 (или 0х20 ) и так 
далее.<br>
3. Непонятно откуда вы взяли значения для значения масок для<br>
i2c_type_msk, i2c_sarp, i2c_sawp, i2c_sawsarp, i2c_Err_msk….i2c_Free  и 
предназначение MACRO_i2c_WhatDo_MasterOut, MACRO_i2c_WhatDo_SlaveOut и 
MACRO_i2c_WhatDo_ErrorOutв IIC_ultimate.h. Код ошибок понятны, но откуда
 эти значения для меня загадка.:)<br>
4. У вас i2c_Do;// Переменная состояния передатчика IIC. Как я понял на 
ее основе в следующем вызове прерывания можно судить о состоянии 
шины(где в предыдущем прерывании i2c_Do была изменена).<br>
5. И последнее наверное самое главное: как я понял вашу ось IIC+RTOS 
можно использовать для подключения опроса датчиков(двух проводных) и 
любых 2х проводных уст-в поддерживающих этот протокол. Для этого файлы 
IIC_ultimate менять ненадо, а изменения коснуться только задач 
крутящихся?<br>
Прокомментируйте  или ответьте если не сложно. С уважением Дмитрий. Автору ОГРОМНОЕ СПАСИБО ЗА СТАТЬЮ!</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-33817">
		<div id="comment-33817">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-33817">
			19 Июль 2012 в 15:00</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>1. Нет, не будет. В худшем случае задач накидает на конвеер. А интерфейс подождет. Он же синхронный.<br>
2. Оно вызывается на каждом событии IIC. Т.е. как только передатчик 
сделает старт (на линии сделает) так сразу и попадаем. Не когда сделали,
 а когда передатчик реально это отработал.<br>
3. Сам придумал. Моя переменная, что хочу то и ворочу.<br>
4. Скорей не о состоянии шины, а о том, что мы с этой шиной должны сделать дальше, в каком режиме работаем, были ли ошибки.<br>
5. Да хоть десять. Сам файл менять не надо, только задачи прописать.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-dima_em even thread-odd thread-alt depth-1" id="li-comment-34074">
		<div id="comment-34074">
		<div class="comment-author vcard">
						<cite class="fn">Dima_Em</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-34074">
			19 Август 2012 в 10:45</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Здравствуйте. Подскажите: значит для 
использования меги 16 в slave режиме необходимо заменить одно 
сопротивление 100 Ом (101) на 10 кОм(103) для подтяжки SDL в 0.<br>
1. У ВАС на фото отмечены два сопротивления, их надо менять оба?<br>
2. И еще: если мы захотим использовать мегу16 в качестве mastera для 
slave меги32, значит необходимо к ней повесить сопротивления SDA, SCL в 
10кОМ(к питанию), или оставить схему без изенения (мега32 SDA, SCL в 
10кОМ(к питанию) + мега16 SDL в 10Ом).</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor odd alt depth-2" id="li-comment-34075">
		<div id="comment-34075">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-34075">
			19 Август 2012 в 11:10</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Эти не столько для подтяжки, сколько 
чтобы не мешались. Заменить лучше оба, мало ли когда пригодится. Их 
можно и вообще выпаять, но тогда жтаг не будет работать. Когда вы его 
зашьете обратно. Для меги 32 разницы нет. Не забудте одеть подтягивающие
 джамперы на ииц шину. Больше ничего и не нужно.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-rigormortis even thread-even depth-1" id="li-comment-34195">
		<div id="comment-34195">
		<div class="comment-author vcard">
						<cite class="fn">RigorMortis</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-34195">
			30 Август 2012 в 13:42</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Все равно в Multimaster режиме подвисает 
шина. Сложно сказать почему, но похоже, если при передаче мастером 
возникает ситуация встречной передачи, то возобновить передачу не 
удается, хотя в регистр записывается сигнал Start. Похоже не я один на 
эти грабли наступил. Вот тут разбор полетов: <a href="http://www.robotroom.com/Atmel-AVR-TWI-I2C-Multi-Master-Problem.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-comment','http://www.robotroom.com']);" rel="nofollow">http://www.robotroom.com/Atmel-AVR-TWI-I2C-Multi-Master-Problem.html</a><br>
Пока что глюк не исправил.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-rigormortis odd alt depth-2" id="li-comment-34233">
		<div id="comment-34233">
		<div class="comment-author vcard">
						<cite class="fn">RigorMortis</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-34233">
			3 Сентябрь 2012 в 16:35</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>В таком виде в мультимастере работает наиболее стабильно:</p>
<p>unsigned char I2CSendBuffer(unsigned char Slave, unsigned char * Addr, unsigned int Count)<br>
{<br>
  if (!(i2c_Do &amp; i2c_Busy))       // Check bus locked<br>
  {<br>
    if (I2CBusChecks != 0)        // Workaround delay<br>
    {<br>
      if ((SDA == 0) || (SCL == 0))<br>
        I2CBusChecks = DefBusChecks;<br>
      else I2CBusChecks—;<br>
    } else<br>
    {<br>
      i2c_SlaveAddress = Slave;<br>
      i2c_ByteCount = Count;<br>
      i2c_Buffer = Addr;<br>
      SREG_I_bit = 0;             // Interrupt disable<br>
      i2c_Do |= i2c_sawp | i2c_Busy | i2c_Interrupted; // Lock bus, set interrupted state<br>
      SREG_I_bit = 1;             // Interrupt enable<br>
      TWSTA_bit = 1;              // Start<br>
      return 1;<br>
    }<br>
  }<br>
  return 0;<br>
}</p>
<p>Бит прерванности передачи взводится сразу, т.к. возможна ситуация при
 приходе встречного пакета, когда прерывание по стартовому биту теряется
 и прием начинается сразу с состояния 0×80. Конечно это случай 
исключительный, но тем не менее такая ситуация вполне реальна.<br>
Учтена задержка после прихода 0xA0 — см. ссылку на проблему выше.<br>
Состояние устанавливается логическим «или», т.к. встречный пакет может 
придти в любой момент, а запрещать надолго прерывания плохо. Передача 
начнется даже если не пройдет состояние «старт» (и такое бывает в 
мультимастере).<br>
Передача переделана на указатель вместо статического буфера. 
I2CBusChecks не защищена объектом синхронизации, но вроде и так 
работает.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-andreil even thread-odd thread-alt depth-1" id="li-comment-35482">
		<div id="comment-35482">
		<div class="comment-author vcard">
						<cite class="fn">andreil</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-35482">
			22 Январь 2013 в 23:56</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Пытаюсь записать кусок памяти в ЕЕПРОМку.
 После захода на первую запись последующие операции отваливаются — шина 
занята. При том, что стоит жесткий выход со сбрасыванием флага 
занятости. Вот код:</p>
<p>void EepromReaded(void)               		// Была попытка чтения<br>
{<br>
	i2c_Do &amp;= i2c_Free;                  		// Освобождаем шину</p>
<p>	if(i2c_Do &amp; (i2c_ERR_NA|i2c_ERR_BF))   		// Ошибки при четнии были?<br>
	{<br>
		eeprom_complete = EEPROM_ERROR;<br>
	}<br>
	else<br>
	{<br>
		eeprom_complete = EEPROM_OK;<br>
	}<br>
}<br>
uint8_t i2c_eep_WriteBytes(uint8_t SAddr, uint16_t Addr, uint8_t Count, uint8_t *Bytes)<br>
{<br>
	if (i2c_Do &amp; i2c_Busy)<br>
		return 0;</p>
<p>	i2c_index = 0;<br>
	i2c_ByteCount = 2 + Count;</p>
<p>	i2c_SlaveAddress = SAddr;</p>
<p>	i2c_Buffer[0] = HI(Addr);<br>
	i2c_Buffer[1] = LO(Addr);</p>
<p>	memcpy(&amp;i2c_Buffer[2], Bytes, Count);</p>
<p>	i2c_Do = i2c_sawp;</p>
<p>	MasterOutFunc = EepromReaded;<br>
	ErrorOutFunc = EepromReaded;</p>
<p>	TWCR = 1&lt;&lt;TWSTA|0&lt;&lt;TWSTO|1&lt;&lt;TWINT|0&lt;&lt;TWEA|1&lt;&lt;TWEN|1&lt;&lt;TWIE;</p>
<p>	i2c_Do |= i2c_Busy | i2c_Interrupted;</p>
<p>	while (!eeprom_complete);<br>
	return eeprom_complete;<br>
}</p>
<p>То есть у меня идет "тупая" запись, с ожиданием. Ест., переменную 
i2c_Do объявил как volatile — чтение таким же образом осуществляется 
вполне себе нормально. А вот запись выкаблучивается :(</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-praktik_1974 odd alt thread-even depth-1" id="li-comment-35611">
		<div id="comment-35611">
		<div class="comment-author vcard">
						<cite class="fn">praktik_1974</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-35611">
			5 Февраль 2013 в 16:23</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Здравствуйте DI !<br>
Огромная благодарность Вам за лик-без по данной тематике!<br>
Извините новичка за вопрос.<br>
Откуда мы берем адрес  ведомого устройства?<br>
Просто я начинаю осваивать AVR, и программировать на ассемблере.<br>
По I2C протоколу вроди понятно, за исключениям выше упомянутого.<br>
С ув.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-35613">
		<div id="comment-35613">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-35613">
			5 Февраль 2013 в 17:39</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Адрес фиксирован для каждого устройства. Обычно производителем.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
	<li class="comment byuser comment-author-jyraf odd alt thread-odd thread-alt depth-1" id="li-comment-37612">
		<div id="comment-37612">
		<div class="comment-author vcard">
						<cite class="fn">Алекс</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-37612">
			20 Декабрь 2013 в 16:25</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Всем доброго дня!<br>
Спасибо автору за отличную статью, очень помогла…<br>
Есть вопросик. Строю сеть 8..10 контроллеров, все в режиме мультимастер. Подскажите обработку кода 0х00 (ошибка шины)…<br>
Вообще, она определяется только в режиме Master или Slave то-же? Если 
при ее возникновении переинициализировать шину, нужно понимать в какой 
режим ее поставить…</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-coriolan even thread-even depth-1" id="li-comment-37783">
		<div id="comment-37783">
		<div class="comment-author vcard">
						<cite class="fn">coriolan</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-37783">
			20 Январь 2014 в 22:18</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Добрый день!<br>
Проясните по поводу TWI. Есть система Master Receiver — Slave 
Transmitter. У Slave есть 6 байт, которые нужно передать мастеру. Я так и
 не понял, кто же все таки останавливает передачу — сначала Slave 
сообщает, что последний байт передан (после передачи последнего байта он
 делает NACK), далее Master получает этот байт (0×50) и делает NACK, 
после этого Master попадает на код 0×58 и передает TWSTO. Правильно ли я
 понял? Или может Master после получения последнего, по его мнению, 
байта (код 0×50) выдает NACK, попадает на 0×58 и передает TWSTO? 
Помогите — не могу правильно завершить посылку — застреваю на 0×50 у 
Master и 0xB8 у Slave. В режиме Master Transmitter — Slave Receiver все 
работает как часы.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-coriolan odd alt depth-2" id="li-comment-37784">
		<div id="comment-37784">
		<div class="comment-author vcard">
						<cite class="fn">coriolan</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-37784">
			20 Январь 2014 в 22:57</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Или еще вариант — только что придумал: 
При получении предпоследнего байта Master как обычно попадает на 0×50, 
при этом он уже отослал Slave’у ACK. Принимаем байт и ставим TWEA=0 — в 
этом случае при получении следующего (последнего) байта Master уже не 
откликнется на посылку и попадет на код 0×58, по которому сформирует 
Стоповое условие. Опять же неясно поведение Slave в этом случае — он 
ведь попадет на 0xC0, а дальше может просто игнорировать сообщения 
(1&lt;&lt;TWINT)|(0&lt;&lt;TWEA)|(1&lt;&lt;TWEN)|(1&lt;&lt;TWIE)? Хотя 
мне этот вариант не нравится — нехорошо думать о завершении посылки, 
пока не принят последний байт. В общем, запутался я малость конкретно.</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment byuser comment-author-di-halt bypostauthor even depth-2" id="li-comment-37785">
		<div id="comment-37785">
		<div class="comment-author vcard">
						<cite class="fn">DI HALT</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-37785">
			20 Январь 2014 в 23:00</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p><a href="http://easyelectronics.ru/interface-bus-iic-i2c.html" rel="nofollow">http://easyelectronics.ru/interface-bus-iic-i2c.html</a></p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-coriolan odd alt depth-3" id="li-comment-37786">
		<div id="comment-37786">
		<div class="comment-author vcard">
						<cite class="fn">coriolan</cite> <span class="says">говорит:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#comment-37786">
			20 Январь 2014 в 23:26</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Понял кажется — с утра попробую. Скорей бы утро)))) Значит все-таки Master решает, когда прерваться — вполне логично.<br>
Спасибо DI HALT — очень полезные статьи на понятном языке!</p>
</div>

		<div class="reply">
			<a rel="nofollow" class="comment-reply-login" href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">Войдите, чтобы ответить</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
</ul>
</li>
</ul>
</li>
			</ol>




					   
			<div id="respond">
				<h3 id="reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://easyelectronics.ru/avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html#respond" style="display: none;">Отменить ответ</a></small></h3>
									<p class="must-log-in">Для отправки комментария вы должны <a href="http://easyelectronics.ru/wordpress/wp-login.php?redirect_to=http%3A%2F%2Feasyelectronics.ru%2Favr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c.html">авторизоваться</a>.</p>												</div><!-- #respond -->
			<script type="text/javascript">
    jQuery(document).ready(function() {
        jQuery('#commentform').submit(function() {
            _gaq.push(
                ['_setAccount','UA-4236757-2'],
                ['_trackEvent','comment']
            );
        });
    });    
</script>
			
</div><!-- #comments -->


			</div><!-- #content -->
		</div><!-- #container -->


		<div id="primary" class="widget-area" role="complementary">
			<ul class="xoxo">

<li id="text-10" class="widget-container widget_text">			<div class="textwidget"><!-- easyelectronics-220x250 -->
<div id="div-gpt-ad-1376913278738-0" style="width: 220px; height: 250px;">
<script type="text/javascript">
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1376913278738-0'); });
</script><div style="border: 0pt none;" id="google_ads_iframe_/1234152/easyelectronics-220x250_0__container__"><iframe src="javascript:&quot;<html><body style='background:transparent'></body></html>&quot;" style="border: 0pt none; vertical-align: bottom;" marginheight="0" marginwidth="0" name="google_ads_iframe_/1234152/easyelectronics-220x250_0" id="google_ads_iframe_/1234152/easyelectronics-220x250_0" frameborder="0" height="250" scrolling="no" width="220"></iframe></div><iframe src="javascript:&quot;<html><body style='background:transparent'></body></html>&quot;" style="border: 0pt none; vertical-align: bottom; visibility: hidden; display: none;" marginheight="0" marginwidth="0" name="google_ads_iframe_/1234152/easyelectronics-220x250_0__hidden__" id="google_ads_iframe_/1234152/easyelectronics-220x250_0__hidden__" frameborder="0" height="0" scrolling="no" width="0"></iframe>
</div></div>
		</li><li id="text-7" class="widget-container widget_text">			<div class="textwidget"></div>
		</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Рубрики</h3>		<ul>
	<li class="cat-item cat-item-194"><a href="http://easyelectronics.ru/category/arm-uchebnyj-kurs" title="Просмотреть все записи в рубрике «ARM. Учебный курс»">ARM. Учебный курс</a>
</li>
	<li class="cat-item cat-item-31"><a href="http://easyelectronics.ru/category/avr-uchebnyj-kurs" title="Просмотреть все записи в рубрике «AVR. Учебный курс»">AVR. Учебный курс</a>
</li>
	<li class="cat-item cat-item-216"><a href="http://easyelectronics.ru/category/msp430-uchebnyj-kurs" title="Работа с контроллерами MSP430 от Texas Instruments">MSP430. Учебный курс</a>
</li>
	<li class="cat-item cat-item-190"><a href="http://easyelectronics.ru/category/autoelectronics" title="Электроника в автомобиле, электротюнинг, аудиосистемы. ">Автоэлектроника</a>
</li>
	<li class="cat-item cat-item-7"><a href="http://easyelectronics.ru/category/gotovoe-ustrojstvo" title="Пошаговые инструкции по сборке устройств.">Готовые устройства</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://easyelectronics.ru/category/diagnostika-i-remont" title="Советы по определению неисправностей и ремонту радиооборудования.">Диагностика и ремонт</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://easyelectronics.ru/category/instrument" title="Описание, тесты и отзывы о инструментах которыми мы пользуемся.">Инструмент</a>
</li>
	<li class="cat-item cat-item-48"><a href="http://easyelectronics.ru/category/knigi" title="Просмотреть все записи в рубрике «Книги»">Книги</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://easyelectronics.ru/category/nachinayushhim" title="Просмотреть все записи в рубрике «Начинающим»">Начинающим</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://easyelectronics.ru/category/news" title="Просмотреть все записи в рубрике «Новости»">Новости</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://easyelectronics.ru/category/texnologiya" title="Изготовление всего, что только можно в домашних условиях">Радиолюбительские Технологии</a>
</li>
	<li class="cat-item cat-item-44"><a href="http://easyelectronics.ru/category/robototexnika" title="Просмотреть все записи в рубрике «Робототехника»">Робототехника</a>
</li>
	<li class="cat-item cat-item-9"><a href="http://easyelectronics.ru/category/soft" title="Весь необходимый софт. Описание, обучение. ">Софт</a>
</li>
		</ul>
</li><li id="meta-2" class="widget-container widget_meta"><h3 class="widget-title"> </h3>			<ul>
			<li><a href="http://easyelectronics.ru/wordpress/wp-login.php?action=register">Регистрация</a></li>			<li><a href="http://easyelectronics.ru/wordpress/wp-login.php">Войти</a></li>
			<li><a href="http://easyelectronics.ru/feed" title="Подпишитесь на RSS-ленту этого сайта"><abbr title="Really Simple Syndication">RSS</abbr> записей</a></li>
			<li><a href="http://easyelectronics.ru/comments/feed" title="Последние комментарии ко всем записям в RSS"><abbr title="Really Simple Syndication">RSS</abbr> комментариев</a></li>
						</ul>
</li><li id="text-9" class="widget-container widget_text">			<div class="textwidget"><a target="_blank" href="http://chipster.ru/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://chipster.ru']);"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/chipster_for_ee.jpg" alt="Магазин радиодеталей Chipster.ru" align="middle" border="0" vspace="0"></a></div>
		</li><li id="search-2" class="widget-container widget_search"><form role="search" method="get" id="searchform" action="http://easyelectronics.ru/">
	<div><label class="screen-reader-text" for="s">Найти:</label>
	<input name="s" id="s" type="text">
	<input id="searchsubmit" value="Поиск" type="submit">
	</div>
	</form></li><li id="text-6" class="widget-container widget_text"><h3 class="widget-title">Разработки EasyElectronics</h3>			<div class="textwidget"><a href="http://shop.easyelectronics.ru/index.php?categoryID=102"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/Pinboard_II_main_220.png"></a>
<a href="http://shop.easyelectronics.ru/index.php?categoryID=102"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/arm_module_220.png"></a>
<a href="http://shop.easyelectronics.ru/index.php?categoryID=102"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/avr_module_220.png"></a></div>
		</li><li id="text-3" class="widget-container widget_text">			<div class="textwidget"><a target="_blank" href="http://easyelectronics.ru/united.php"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/map.jpg" alt="Карта сообщества" align="middle" border="0" vspace="30"></a>

<a target="_blank" href="http://dihalt.ru/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://dihalt.ru']);"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/dihalt16060.gif" align="middle" border="0" vspace="2"></a>

<a target="_blank" href="http://easyelectronics.ru/links/magazin-element"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/elementbn.gif" align="middle" border="0" vspace="2"></a>

<a target="_blank" href="http://easyelectronics.ru/links/modernsteel"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/modernsteel.gif" align="middle" border="0" vspace="2"></a>
</div>
		</li><li id="simpletags-2" class="widget-container widget-simpletags"><h3 class="widget-title">Метки</h3>
<!-- Generated by Simple Tags 2.2 - http://wordpress.org/extend/plugins/simple-tags -->
	<div class="st-tag-cloud">
	<a href="http://easyelectronics.ru/tag/flash" id="tag-link-103" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">FLASH</a>
<a href="http://easyelectronics.ru/tag/ftdi" id="tag-link-239" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">FTDI</a>
<a href="http://easyelectronics.ru/tag/fuse" id="tag-link-93" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">FUSE</a>
<a href="http://easyelectronics.ru/tag/gpio" id="tag-link-226" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">GPIO</a>
<a href="http://easyelectronics.ru/tag/gui" id="tag-link-186" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">GUI</a>
<a href="http://easyelectronics.ru/tag/hd44780" id="tag-link-81" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">HD44780</a>
<a href="http://easyelectronics.ru/tag/hoperf" id="tag-link-128" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">HopeRF</a>
<a href="http://easyelectronics.ru/tag/i-button" id="tag-link-208" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">i-button</a>
<a href="http://easyelectronics.ru/tag/io" id="tag-link-163" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">I/O</a>
<a href="http://easyelectronics.ru/tag/i2c" id="tag-link-72" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">i2c</a>
<a href="http://easyelectronics.ru/tag/iar" id="tag-link-202" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">IAR</a>
<a href="http://easyelectronics.ru/tag/ide" id="tag-link-199" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">IDE</a>
<a href="http://easyelectronics.ru/tag/igbt" id="tag-link-165" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">IGBT</a>
<a href="http://easyelectronics.ru/tag/iic" id="tag-link-144" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">IIC</a>
<a href="http://easyelectronics.ru/tag/isis-proteus" id="tag-link-66" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ISIS Proteus</a>
<a href="http://easyelectronics.ru/tag/isp" id="tag-link-180" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ISP</a>
<a href="http://easyelectronics.ru/tag/jtag" id="tag-link-160" class="st-tags t2" title="6 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">JTAG</a>
<a href="http://easyelectronics.ru/tag/keil" id="tag-link-198" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Keil</a>
<a href="http://easyelectronics.ru/tag/labview" id="tag-link-203" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">LabView</a>
<a href="http://easyelectronics.ru/tag/lan" id="tag-link-131" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">LAN</a>
<a href="http://easyelectronics.ru/tag/lcd" id="tag-link-80" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">LCD</a>
<a href="http://easyelectronics.ru/tag/linux" id="tag-link-183" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Linux</a>
<a href="http://easyelectronics.ru/tag/mc34063" id="tag-link-132" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">MC34063</a>
<a href="http://easyelectronics.ru/tag/mc34068" id="tag-link-85" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">MC34068</a>
<a href="http://easyelectronics.ru/tag/microchip" id="tag-link-89" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Microchip</a>
<a href="http://easyelectronics.ru/tag/mosfet" id="tag-link-164" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">MOSFET</a>
<a href="http://easyelectronics.ru/tag/msc-51" id="tag-link-22" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">MSC-51</a>
<a href="http://easyelectronics.ru/tag/msp430" id="tag-link-218" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">MSP430</a>
<a href="http://easyelectronics.ru/tag/ne555" id="tag-link-124" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">NE555</a>
<a href="http://easyelectronics.ru/tag/nvic" id="tag-link-231" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">NVIC</a>
<a href="http://easyelectronics.ru/tag/palm" id="tag-link-134" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Palm</a>
<a href="http://easyelectronics.ru/tag/pascal" id="tag-link-87" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Pascal</a>
<a href="http://easyelectronics.ru/tag/pc" id="tag-link-177" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">PC</a>
<a href="http://easyelectronics.ru/tag/pic" id="tag-link-21" class="st-tags t4" title="11 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">PIC</a>
<a href="http://easyelectronics.ru/tag/pinboard" id="tag-link-168" class="st-tags t4" title="10 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">PinBoard</a>
<a href="http://easyelectronics.ru/tag/pinboard-ii" id="tag-link-224" class="st-tags t4" title="11 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">PinBoard II</a>
<a href="http://easyelectronics.ru/tag/plc" id="tag-link-161" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">PLC</a>
<a href="http://easyelectronics.ru/tag/pll" id="tag-link-204" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">PLL</a>
<a href="http://easyelectronics.ru/tag/pr" id="tag-link-121" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">PR</a>
<a href="http://easyelectronics.ru/tag/pwm" id="tag-link-54" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">PWM</a>
<a href="http://easyelectronics.ru/tag/rc" id="tag-link-170" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">RC</a>
<a href="http://easyelectronics.ru/tag/rigol" id="tag-link-133" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">RIGOL</a>
<a href="http://easyelectronics.ru/tag/rigol-1042cd" id="tag-link-136" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">RIGOL 1042CD</a>
<a href="http://easyelectronics.ru/tag/rs232" id="tag-link-63" class="st-tags t4" title="10 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">RS232</a>
<a href="http://easyelectronics.ru/tag/rtc" id="tag-link-154" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">RTC</a>
<a href="http://easyelectronics.ru/tag/rtos" id="tag-link-137" class="st-tags t4" title="12 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">RTOS</a>
<a href="http://easyelectronics.ru/tag/smd" id="tag-link-127" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">smd</a>
<a href="http://easyelectronics.ru/tag/stm8" id="tag-link-233" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">STM8</a>
<a href="http://easyelectronics.ru/tag/stm32" id="tag-link-205" class="st-tags t3" title="9 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">STM32</a>
<a href="http://easyelectronics.ru/tag/swd" id="tag-link-197" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">SWD</a>
<a href="http://easyelectronics.ru/tag/topor" id="tag-link-214" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">TopoR</a>
<a href="http://easyelectronics.ru/tag/touchssreen" id="tag-link-236" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">TouchSсreen</a>
<a href="http://easyelectronics.ru/tag/tsop" id="tag-link-150" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">TSOP</a>
<a href="http://easyelectronics.ru/tag/twi" id="tag-link-200" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">TWI</a>
<a href="http://easyelectronics.ru/tag/uart" id="tag-link-64" class="st-tags t5" title="13 topics" rel="tag" style="font-size: 13.78pt; color: rgb(113, 113, 113);">UART</a>
<a href="http://easyelectronics.ru/tag/usart" id="tag-link-188" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">USART</a>
<a href="http://easyelectronics.ru/tag/usb" id="tag-link-158" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">USB</a>
<a href="http://easyelectronics.ru/tag/usi" id="tag-link-201" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">USI</a>
<a href="http://easyelectronics.ru/tag/wg12864" id="tag-link-221" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">WG12864</a>
<a href="http://easyelectronics.ru/tag/zif" id="tag-link-117" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ZIF</a>
<a href="http://easyelectronics.ru/tag/zigbee" id="tag-link-189" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ZigBee</a>
<a href="http://easyelectronics.ru/tag/aru" id="tag-link-149" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">АРУ</a>
<a href="http://easyelectronics.ru/tag/acp" id="tag-link-73" class="st-tags t3" title="9 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">АЦП</a>
<a href="http://easyelectronics.ru/tag/avto" id="tag-link-191" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Авто</a>
<a href="http://easyelectronics.ru/tag/akkumulyatory" id="tag-link-82" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Аккумуляторы</a>
<a href="http://easyelectronics.ru/tag/akselerometr" id="tag-link-125" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Акселерометр</a>
<a href="http://easyelectronics.ru/tag/algoritm" id="tag-link-68" class="st-tags t7" title="19 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Алгоритм</a>
<a href="http://easyelectronics.ru/tag/analog" id="tag-link-25" class="st-tags t4" title="12 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">Аналог</a>
<a href="http://easyelectronics.ru/tag/bp" id="tag-link-83" class="st-tags t3" title="9 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">БП</a>
<a href="http://easyelectronics.ru/tag/bpf" id="tag-link-92" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">БПФ</a>
<a href="http://easyelectronics.ru/tag/biblioteka" id="tag-link-230" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Библиотека</a>
<a href="http://easyelectronics.ru/tag/bystryj-start" id="tag-link-217" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Быстрый старт</a>
<a href="http://easyelectronics.ru/tag/vch" id="tag-link-78" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ВЧ</a>
<a href="http://easyelectronics.ru/tag/video" id="tag-link-53" class="st-tags t7" title="21 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Видео</a>
<a href="http://easyelectronics.ru/tag/vybor" id="tag-link-129" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Выбор</a>
<a href="http://easyelectronics.ru/tag/gazovyj-payalnik" id="tag-link-104" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Газовый паяльник</a>
<a href="http://easyelectronics.ru/tag/generator" id="tag-link-151" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Генератор</a>
<a href="http://easyelectronics.ru/tag/gonyu" id="tag-link-179" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Гоню</a>
<a href="http://easyelectronics.ru/tag/darlington" id="tag-link-143" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Дарлингтон</a>
<a href="http://easyelectronics.ru/tag/datchik" id="tag-link-98" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Датчик</a>
<a href="http://easyelectronics.ru/tag/dvigateli" id="tag-link-45" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Двигатели</a>
<a href="http://easyelectronics.ru/tag/demontazh" id="tag-link-105" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Демонтаж</a>
<a href="http://easyelectronics.ru/tag/demoplata" id="tag-link-196" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Демоплата</a>
<a href="http://easyelectronics.ru/tag/diod" id="tag-link-17" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Диод</a>
<a href="http://easyelectronics.ru/tag/druzya" id="tag-link-122" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Друзья</a>
<a href="http://easyelectronics.ru/tag/zhalo" id="tag-link-112" class="st-tags t3" title="7 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Жало</a>
<a href="http://easyelectronics.ru/tag/zadachka" id="tag-link-123" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Задачка</a>
<a href="http://easyelectronics.ru/tag/izmereniya" id="tag-link-223" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Измерения</a>
<a href="http://easyelectronics.ru/tag/impulsnye" id="tag-link-115" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Импульсные</a>
<a href="http://easyelectronics.ru/tag/induktivnost" id="tag-link-18" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Индуктивность</a>
<a href="http://easyelectronics.ru/tag/instrument" id="tag-link-8" class="st-tags t7" title="19 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Инструмент</a>
<a href="http://easyelectronics.ru/tag/interfejs" id="tag-link-65" class="st-tags t10" title="28 topics" rel="tag" style="font-size: 16pt; color: rgb(0, 0, 0);">Интерфейс</a>
<a href="http://easyelectronics.ru/tag/ionistor" id="tag-link-135" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Ионистор</a>
<a href="http://easyelectronics.ru/tag/klaviatura" id="tag-link-69" class="st-tags t3" title="7 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Клавиатура</a>
<a href="http://easyelectronics.ru/tag/kommercheskaya-razrabotka" id="tag-link-169" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Коммерческая разработка</a>
<a href="http://easyelectronics.ru/tag/komparator" id="tag-link-74" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Компаратор</a>
<a href="http://easyelectronics.ru/tag/kompas" id="tag-link-207" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Компас</a>
<a href="http://easyelectronics.ru/tag/kondensator" id="tag-link-15" class="st-tags t2" title="6 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Конденсатор</a>
<a href="http://easyelectronics.ru/tag/konkurs" id="tag-link-210" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Конкурс</a>
<a href="http://easyelectronics.ru/tag/konfiguraciya" id="tag-link-94" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Конфигурация</a>
<a href="http://easyelectronics.ru/tag/korpus" id="tag-link-76" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Корпус</a>
<a href="http://easyelectronics.ru/tag/lut" id="tag-link-34" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">ЛУТ</a>
<a href="http://easyelectronics.ru/tag/logicheskij-analizator" id="tag-link-212" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Логический анализатор</a>
<a href="http://easyelectronics.ru/tag/luzhenie" id="tag-link-75" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Лужение</a>
<a href="http://easyelectronics.ru/tag/mk" id="tag-link-176" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">МК</a>
<a href="http://easyelectronics.ru/tag/magnetizm" id="tag-link-184" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Магнетизм</a>
<a href="http://easyelectronics.ru/tag/makrovideo" id="tag-link-173" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Макровидео</a>
<a href="http://easyelectronics.ru/tag/makro-yazyk" id="tag-link-33" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Макро язык</a>
<a href="http://easyelectronics.ru/tag/malenkie-xitrosti" id="tag-link-227" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Маленькие хитрости</a>
<a href="http://easyelectronics.ru/tag/manipulyator" id="tag-link-193" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Манипулятор</a>
<a href="http://easyelectronics.ru/tag/melochi" id="tag-link-86" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Мелочи</a>
<a href="http://easyelectronics.ru/tag/mexanika" id="tag-link-162" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Механика</a>
<a href="http://easyelectronics.ru/tag/mikrovolna" id="tag-link-113" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Микроволна</a>
<a href="http://easyelectronics.ru/tag/mikrokontroller" id="tag-link-19" class="st-tags t6" title="16 topics" rel="tag" style="font-size: 14.22pt; color: rgb(90, 90, 90);">Микроконтроллер</a>
<a href="http://easyelectronics.ru/tag/modding" id="tag-link-40" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Моддинг</a>
<a href="http://easyelectronics.ru/tag/modul" id="tag-link-101" class="st-tags t6" title="16 topics" rel="tag" style="font-size: 14.22pt; color: rgb(90, 90, 90);">Модуль</a>
<a href="http://easyelectronics.ru/tag/montazh" id="tag-link-157" class="st-tags t3" title="7 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Монтаж</a>
<a href="http://easyelectronics.ru/tag/multimetr" id="tag-link-107" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Мультиметр</a>
<a href="http://easyelectronics.ru/tag/navodka" id="tag-link-79" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Наводка</a>
<a href="http://easyelectronics.ru/tag/nachinayushhim" id="tag-link-3" class="st-tags t7" title="19 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Начинающим</a>
<a href="http://easyelectronics.ru/tag/ou" id="tag-link-41" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">ОУ</a>
<a href="http://easyelectronics.ru/tag/obrabotka-signalov" id="tag-link-91" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Обработка сигналов</a>
<a href="http://easyelectronics.ru/tag/operacionnaya-sistema" id="tag-link-141" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Операционная система</a>
<a href="http://easyelectronics.ru/tag/opisanie" id="tag-link-23" class="st-tags t4" title="11 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">Описание</a>
<a href="http://easyelectronics.ru/tag/opletka" id="tag-link-172" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Оплетка</a>
<a href="http://easyelectronics.ru/tag/opornoe-napryazhenie" id="tag-link-120" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Опорное напряжение</a>
<a href="http://easyelectronics.ru/tag/optimizaciya" id="tag-link-77" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Оптимизация</a>
<a href="http://easyelectronics.ru/tag/optorazvyazka" id="tag-link-59" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Опторазвязка</a>
<a href="http://easyelectronics.ru/tag/o-sajte" id="tag-link-100" class="st-tags t3" title="9 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">О сайте</a>
<a href="http://easyelectronics.ru/tag/osnovy" id="tag-link-13" class="st-tags t4" title="11 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">Основы</a>
<a href="http://easyelectronics.ru/tag/oscillograf" id="tag-link-47" class="st-tags t4" title="12 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">Осциллограф</a>
<a href="http://easyelectronics.ru/tag/ot-avtora" id="tag-link-56" class="st-tags t9" title="27 topics" rel="tag" style="font-size: 15.56pt; color: rgb(22, 22, 22);">От Автора</a>
<a href="http://easyelectronics.ru/tag/otverstiya" id="tag-link-209" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Отверстия</a>
<a href="http://easyelectronics.ru/tag/otladka" id="tag-link-67" class="st-tags t7" title="19 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Отладка</a>
<a href="http://easyelectronics.ru/tag/plis" id="tag-link-234" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ПЛИС</a>
<a href="http://easyelectronics.ru/tag/pajka" id="tag-link-36" class="st-tags t7" title="21 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Пайка</a>
<a href="http://easyelectronics.ru/tag/pamyat" id="tag-link-96" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Память</a>
<a href="http://easyelectronics.ru/tag/partnerstvo" id="tag-link-178" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Партнерство</a>
<a href="http://easyelectronics.ru/tag/payalnaya-stanciya" id="tag-link-49" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Паяльная станция</a>
<a href="http://easyelectronics.ru/tag/payalnik" id="tag-link-12" class="st-tags t5" title="13 topics" rel="tag" style="font-size: 13.78pt; color: rgb(113, 113, 113);">Паяльник</a>
<a href="http://easyelectronics.ru/tag/pechatnaya-plata" id="tag-link-35" class="st-tags t7" title="21 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Печатная плата</a>
<a href="http://easyelectronics.ru/tag/pitanie" id="tag-link-142" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Питание</a>
<a href="http://easyelectronics.ru/tag/port" id="tag-link-90" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Порт</a>
<a href="http://easyelectronics.ru/tag/preryvaniya" id="tag-link-187" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Прерывания</a>
<a href="http://easyelectronics.ru/tag/pribor" id="tag-link-106" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Прибор</a>
<a href="http://easyelectronics.ru/tag/prikol" id="tag-link-108" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Прикол</a>
<a href="http://easyelectronics.ru/tag/provereno-na-sebe" id="tag-link-111" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Проверено на себе</a>
<a href="http://easyelectronics.ru/tag/programmator" id="tag-link-27" class="st-tags t6" title="17 topics" rel="tag" style="font-size: 14.22pt; color: rgb(90, 90, 90);">Программатор</a>
<a href="http://easyelectronics.ru/tag/programmirovanie" id="tag-link-30" class="st-tags t8" title="23 topics" rel="tag" style="font-size: 15.11pt; color: rgb(45, 45, 45);">Программирование</a>
<a href="http://easyelectronics.ru/tag/protokol" id="tag-link-145" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Протокол</a>
<a href="http://easyelectronics.ru/tag/rabochee-mesto" id="tag-link-116" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Рабочее место</a>
<a href="http://easyelectronics.ru/tag/radiolyubitelskie-texnologii" id="tag-link-37" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Радиолюбительские Технологии</a>
<a href="http://easyelectronics.ru/tag/radiolyubitelskie-texnologiya" id="tag-link-38" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Радиолюбительские Технология</a>
<a href="http://easyelectronics.ru/tag/radioperedacha" id="tag-link-102" class="st-tags t3" title="7 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Радиопередача</a>
<a href="http://easyelectronics.ru/tag/racuxa" id="tag-link-147" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Рацуха</a>
<a href="http://easyelectronics.ru/tag/reaktiv" id="tag-link-152" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Реактив</a>
<a href="http://easyelectronics.ru/tag/registr" id="tag-link-140" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Регистр</a>
<a href="http://easyelectronics.ru/tag/rezistor" id="tag-link-14" class="st-tags t3" title="7 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Резистор</a>
<a href="http://easyelectronics.ru/tag/robot" id="tag-link-32" class="st-tags t7" title="21 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Робот</a>
<a href="http://easyelectronics.ru/tag/svetodiody" id="tag-link-156" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Светодиоды</a>
<a href="http://easyelectronics.ru/tag/silovaya-elektronika" id="tag-link-166" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Силовая электроника</a>
<a href="http://easyelectronics.ru/tag/simistor" id="tag-link-58" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Симистор</a>
<a href="http://easyelectronics.ru/tag/sonar" id="tag-link-97" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Сонар</a>
<a href="http://easyelectronics.ru/tag/soobshhestvo" id="tag-link-211" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Сообщество</a>
<a href="http://easyelectronics.ru/tag/soft" id="tag-link-9" class="st-tags t3" title="9 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Софт</a>
<a href="http://easyelectronics.ru/tag/sxemotexnika" id="tag-link-51" class="st-tags t7" title="19 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Схемотехника</a>
<a href="http://easyelectronics.ru/tag/triz" id="tag-link-138" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ТРИЗ</a>
<a href="http://easyelectronics.ru/tag/tablica-perexodov" id="tag-link-42" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Таблица переходов</a>
<a href="http://easyelectronics.ru/tag/tajmery" id="tag-link-50" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Таймеры</a>
<a href="http://easyelectronics.ru/tag/terminal" id="tag-link-174" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Терминал</a>
<a href="http://easyelectronics.ru/tag/tipy-vyxodov" id="tag-link-26" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Типы выходов</a>
<a href="http://easyelectronics.ru/tag/tiristor" id="tag-link-60" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Тиристор</a>
<a href="http://easyelectronics.ru/tag/tranzistor" id="tag-link-16" class="st-tags t3" title="8 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Транзистор</a>
<a href="http://easyelectronics.ru/tag/transiver" id="tag-link-206" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Трансивер</a>
<a href="http://easyelectronics.ru/tag/trassirovka" id="tag-link-215" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Трассировка</a>
<a href="http://easyelectronics.ru/tag/tryuki" id="tag-link-43" class="st-tags t7" title="21 topics" rel="tag" style="font-size: 14.67pt; color: rgb(67, 67, 67);">Трюки</a>
<a href="http://easyelectronics.ru/tag/ultrazvuk" id="tag-link-99" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Ультразвук</a>
<a href="http://easyelectronics.ru/tag/umnyj-dom" id="tag-link-61" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Умный дом</a>
<a href="http://easyelectronics.ru/tag/fen" id="tag-link-171" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Фен</a>
<a href="http://easyelectronics.ru/tag/fizika" id="tag-link-109" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Физика</a>
<a href="http://easyelectronics.ru/tag/filtry" id="tag-link-119" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Фильтры</a>
<a href="http://easyelectronics.ru/tag/flagi" id="tag-link-39" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Флаги</a>
<a href="http://easyelectronics.ru/tag/flyus" id="tag-link-146" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Флюс</a>
<a href="http://easyelectronics.ru/tag/fotodiod" id="tag-link-46" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Фотодиод</a>
<a href="http://easyelectronics.ru/tag/fototranzistor" id="tag-link-148" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Фототранзистор</a>
<a href="http://easyelectronics.ru/tag/xalyava" id="tag-link-114" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Халява</a>
<a href="http://easyelectronics.ru/tag/cap" id="tag-link-139" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ЦАП</a>
<a href="http://easyelectronics.ru/tag/cifra" id="tag-link-24" class="st-tags t2" title="6 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">Цифра</a>
<a href="http://easyelectronics.ru/tag/chasy" id="tag-link-155" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Часы</a>
<a href="http://easyelectronics.ru/tag/shim" id="tag-link-55" class="st-tags t2" title="5 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">ШИМ</a>
<a href="http://easyelectronics.ru/tag/shagovyj-dvigatel" id="tag-link-70" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Шаговый двигатель</a>
<a href="http://easyelectronics.ru/tag/shassi" id="tag-link-52" class="st-tags t1" title="2 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Шасси</a>
<a href="http://easyelectronics.ru/tag/shunt" id="tag-link-222" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Шунт</a>
<a href="http://easyelectronics.ru/tag/eksperiment" id="tag-link-110" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Эксперимент</a>
<a href="http://easyelectronics.ru/tag/elektroprivod" id="tag-link-71" class="st-tags t3" title="8 topics" rel="tag" style="font-size: 12.89pt; color: rgb(158, 158, 158);">Электропривод</a>
<a href="http://easyelectronics.ru/tag/enkoder" id="tag-link-159" class="st-tags t1" title="3 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">Энкодер</a>
<a href="http://easyelectronics.ru/tag/yazyk-si" id="tag-link-153" class="st-tags t4" title="10 topics" rel="tag" style="font-size: 13.33pt; color: rgb(136, 136, 136);">Язык Си</a>
<a href="http://easyelectronics.ru/tag/klej" id="tag-link-238" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">клей</a>
<a href="http://easyelectronics.ru/tag/samopal" id="tag-link-118" class="st-tags t2" title="4 topics" rel="tag" style="font-size: 12.44pt; color: rgb(181, 181, 181);">самопал</a>
<a href="http://easyelectronics.ru/tag/ssylki" id="tag-link-237" class="st-tags t1" title="1 topics" rel="tag" style="font-size: 12pt; color: rgb(204, 204, 204);">ссылки</a></div>

</li><li id="text-8" class="widget-container widget_text">			<div class="textwidget"><a target="_blank" href="http://chipster.ru/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://chipster.ru']);"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/chipster_for_ee.jpg" alt="Магазин радиодеталей Chipster.ru" align="middle" border="0" vspace="0"></a>
</div>
		</li>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">



			<div id="footer-widget-area" role="complementary">

				<div id="first" class="widget-area">
					<ul class="xoxo">
								<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Свежие записи</h3>		<ul>
				<li><a href="http://easyelectronics.ru/modernizaciya-modulya-dlya-pinboard-ii-avr-happy-jtag-ice-do-jtag-ice-i.html" title="Модернизация модуля для Pinboard II AVR Happy Jtag ICE до JTAG ICE I">Модернизация модуля для Pinboard II AVR Happy Jtag ICE до JTAG ICE I</a></li>
				<li><a href="http://easyelectronics.ru/bosch-gluepen.html" title="BOSCH GluePen">BOSCH GluePen</a></li>
				<li><a href="http://easyelectronics.ru/arm-uchebnyj-kurs-vneshnie-preryvaniya.html" title="ARM. Учебный курс. Внешние прерывания">ARM. Учебный курс. Внешние прерывания</a></li>
				<li><a href="http://easyelectronics.ru/video-lekcii-po-elektronike.html" title="Видео лекции по электронике">Видео лекции по электронике</a></li>
				<li><a href="http://easyelectronics.ru/hakko-fx-888-obzor-razbor-upgrade.html" title="Паяльная станция Hakko FX-888. Обзор и доработка">Паяльная станция Hakko FX-888. Обзор и доработка</a></li>
				<li><a href="http://easyelectronics.ru/sverlilnyj-stanok-proxxon-tbm-220.html" title="Сверлильный станок PROXXON TBM 220">Сверлильный станок PROXXON TBM 220</a></li>
				<li><a href="http://easyelectronics.ru/instrumentalnaya-melochevka-chast-3.html" title="Инструментальная мелочевка. Часть 3">Инструментальная мелочевка. Часть 3</a></li>
				<li><a href="http://easyelectronics.ru/arm-uchebnyj-kurs-usart.html" title="ARM Учебный курс. USART">ARM Учебный курс. USART</a></li>
				<li><a href="http://easyelectronics.ru/arm-uchebnyj-kurs-systick-sistemnyj-tajmer.html" title="ARM. Учебный Курс. SysTick — Системный таймер">ARM. Учебный Курс. SysTick — Системный таймер</a></li>
				<li><a href="http://easyelectronics.ru/vesti-s-polej-novyj-urozhaj.html" title="Вести с полей. Новый урожай.">Вести с полей. Новый урожай.</a></li>
				</ul>
		</li>					</ul>
				</div><!-- #first .widget-area -->

				<div id="second" class="widget-area">
					<ul class="xoxo">
						<li id="recent-comments-2" class="widget-container widget_recent_comments"><h3 class="widget-title">комментарии</h3><ul id="recentcomments"><li class="recentcomments">Bagonawt к записи <a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1312-2#comment-37894">1.3.12. Условная операция</a></li><li class="recentcomments">Bagonawt к записи <a href="http://easyelectronics.ru/file/yazyk-programmirovaniya-s-spravochnik/1312-2#comment-37893">1.3.12. Условная операция</a></li><li class="recentcomments">DI HALT к записи <a href="http://easyelectronics.ru/hakko-fx-888-obzor-razbor-upgrade.html#comment-37892">Паяльная станция Hakko FX-888. Обзор и доработка</a></li><li class="recentcomments">Hepo к записи <a href="http://easyelectronics.ru/izgotovlenie-pechatnoj-platy-ot-i-do-video-urok.html#comment-37891">Изготовление печатной платы от и до. Видео урок.</a></li><li class="recentcomments">Vitaly к записи <a href="http://easyelectronics.ru/hakko-fx-888-obzor-razbor-upgrade.html#comment-37890">Паяльная станция Hakko FX-888. Обзор и доработка</a></li></ul></li>					</ul>
				</div><!-- #second .widget-area -->

				<div id="third" class="widget-area">
					<ul class="xoxo">
						<li id="most_commented_widget-2" class="widget-container widget_most_commented_widget"><h3 class="widget-title">Обсуждения</h3><ul><li><a href="http://easyelectronics.ru/skorostnoj-avr-usb-programmator-na-ft232rl-bez-vspomogatelnogo-kontrollera.html" title="Скоростной AVR USB программатор на FT232RL без вспомогательного контроллера">Скоростной AVR USB программатор на FT232RL без вспомогательного контроллера</a> (1499)</li><li><a href="http://easyelectronics.ru/usb-programmator-avr-usbasp.html" title="USB программатор AVR — USBAsp">USB программатор AVR — USBAsp</a> (1462)</li><li><a href="http://easyelectronics.ru/avr-shag-pervyj-programmator.html" title="Программатор Громова">Программатор Громова</a> (1039)</li><li><a href="http://easyelectronics.ru/sozdanie-pechatnoj-platy-metodom-lazernogo-utyuga.html" title="Создание печатной платы методом лазерного утюга.">Создание печатной платы методом лазерного утюга.</a> (613)</li><li><a href="http://easyelectronics.ru/avr-uchebnyj-kurs-peredacha-dannyx-cherez-uart.html" title="AVR. Учебный курс. Передача данных через UART">AVR. Учебный курс. Передача данных через UART</a> (589)</li></ul></li>					</ul>
				</div><!-- #third .widget-area -->

				<div id="fourth" class="widget-area">
					<ul class="xoxo">
						<li id="text-5" class="widget-container widget_text"><h3 class="widget-title">Штуки</h3>			<div class="textwidget"><a href="http://easyelectronics.ru/sitemap.xml">Карта сайта</a>


<noindex><p align="center"><a rel="nofollow" href="http://feeds.feedburner.com/easyelectronics" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://feeds.feedburner.com']);"><img src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/easyelectronics.gif" style="border: 0pt none;" alt="" height="26" width="88"></a></p></noindex></div>
		</li><li id="text-11" class="widget-container widget_text"><h3 class="widget-title">Соцсети</h3>			<div class="textwidget"><a href="https://plus.google.com/112890413068316084333" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://plus.google.com']);" rel="publisher">Google+</a></div>
		</li>					</ul>
				</div><!-- #fourth .widget-area -->

			</div><!-- #footer-widget-area -->

			<div id="site-info">
				<a href="http://easyelectronics.ru/" title="Электроника для всех" rel="home">
					Электроника для всех				</a>
<br>
Материалы сайта являются авторскими. Копирование и публикация материалов без активной ссылки на первоисточник запрещено.
			</div><!-- #site-info -->

<p></p><div id="sap">Реклама:<br>
 <a href="http://www.black-baccara.ru/" target="_blank">цветы оптом</a> .  <a href="http://www.kmozer.ru/catalog/bracket" target="_blank">настольные часы</a> 

			

<div id="sap">
Реклама:
 <a href="http://allduino.ru/" target="_blank">купить arduino</a> 
		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->


<!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter926470 = new Ya.Metrika(926470);
             yaCounter926470.clickmap(true);
             yaCounter926470.trackLinks(true);
        
        } catch(e) { }
    });
})(window, 'yandex_metrika_callbacks');
</script></div>
<script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/watch.js" type="text/javascript" defer="defer"></script>
<noscript><div style="position:absolute"><img src="//mc.yandex.ru/watch/926470" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="avr-uchebnyj-kurs-ispolzovanie-avr-twi-dlya-raboty-s-shinoj-iic-i2c_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4236757-2");
pageTracker._trackPageview();
</script>


</div></div><iframe style="display: none; width: 0px; height: 0px;" name="google_osd_static_frame" id="google_osd_static_frame_1652064422237"></iframe></body></html>
<!-- hyper cache: 9537ac57faff75f39b3ff2913925998e 14-02-12 01:16:18 -->